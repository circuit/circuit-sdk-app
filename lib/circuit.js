/**
 *  Copyright 2017 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.1.8700
 */
var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.1.8700'});
var window=window||{},navigator=navigator||{},document=document,Circuit=function(a){"use strict";var b={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?b={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(b={name:process.argv[0]}):b={name:"browser"},window.setTimeout=window.setTimeout||setTimeout,window.clearTimeout=window.clearTimeout||clearTimeout,window.setInterval=window.setInterval||setInterval,window.clearInterval=window.clearInterval||clearInterval,window.location||(window.location={host:b.hostname}),navigator.platform||(navigator.platform=b.name),navigator.userAgent||(navigator.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2125.122 Safari/537.36"),window.navigator||(window.navigator=navigator),window.btoa||(window.btoa=function(a){return new Buffer(a).toString("base64")}),a._runtime=b,a}(Circuit||{}),Circuit=function(a){"use strict";var b=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),c=b.Warning,d={setLevel:function(a){c=a},getLevel:function(){return c},debug:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){c<=b.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){c<=b.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){c<=b.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(a,d){c<=b.Error&&(a=a&&a.stack||a,d=d&&d.stack||d,d?console.error(a,d):console.error(a))},msgSend:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){c<=b.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(a,b,c){switch(a.name){case"DEBUG":this.debug(b,c);break;case"INFO":this.info(b,c);break;case"WARN":case"WARNING":this.info(b,c);break;case"ERROR":this.info(b,c);break;default:this.debug(b,c)}},setExtensionVersion:function(a){console.log("ExtensionVersion = "+a)}};return a.logger=d,a.Enums=a.Enums||{},a.Enums.LogLevel=b,a}(Circuit||{}),Circuit=function(a){"use strict";return a.Error=function(a,b){this.code=a||"UNEXPECTED_ERROR","string"==typeof b?this.message=b:"object"==typeof b&&(this.errObj=b,b.info&&!b.message&&(b.message=b.info)),this.stack=Error().stack},a.Error.prototype=Object.create(Error.prototype),a.Error.prototype.name="Error",a}(Circuit||{}),Circuit=function(a){"use strict";var b={};return b.SIGNATURE="ansibleChromeExtensionSignature",b.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),b.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),b.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager"}),b.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),b.BgLogMsgType=Object.freeze({LOG:"log"}),b.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront"}),b.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),b.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials"}),b.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled"}),b.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut"}),b.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),b.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),a.ChromeExtension=b,"undefined"!=typeof module&&module.exports&&(module.exports=b),a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){var c=j.EMOTICON_MAPPING[b];return c?String.fromCodePoint(c):""}function c(a){if(!a)return"";var b=document.createElement("div"),c=document.createElement("div");a=a.replace(/\$/gm,"$$$$");var d=0;return a=a.replace(/(<span.*?>)|(<\/span>)/gi,function(a,b,c){return b?b.match(/class="mention"/i)?a.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):(d++,b):c?d?(d--,c):"</a></span>":void 0}),b.innerHTML=a,f(b,c).innerHTML.replace(/&nbsp;/gi," ")}function d(){return a.isElectron?g.getCurrentWindow()._domain:window.location&&window.location.origin}function e(a){a=a.replace(/\xA0|&#160;|\x0A|\x0D/gim," ");for(var b=String.fromCharCode(17),c=String.fromCharCode(18),e=String.fromCharCode(19),f=function(a){var f="",g="",h=d(),i=j.isCircuitLink(h,a);return i||(i=a,/^(?:http|https|ftp):\/\//.exec(a)||(i="http://"+i),f=" target="+e+"_blank"+e,g=" rel="+e+"noopener noreferrer"+e),b+"a href="+e+i+e+f+g+c+a+b+"/a"+c},g=a.split(j.URL_SEPARATORS_PATTERN),h=0;h<g.length;h++){var i=g[h],k=j.stripParenthesis(i),l=k;l.search(/http|ftp|https/gim)>=0&&l.search(j.URL_PATTERN)>=0?l=l.replace(j.URL_PATTERN,f):l.search(/www\./gim)>=0&&l.search(j.PSEUDO_URL_PATTERN)>=0?l=l.replace(j.PSEUDO_URL_PATTERN,f):l.search(/\S@\S/gim)>=0&&l.search(j.EMAIL_ADDRESS_INCLUDED_PATTERN)>=0&&(l=l.replace(j.EMAIL_ADDRESS_INCLUDED_PATTERN,b+"a href="+e+"mailto:$&"+e+" target="+e+"_blank"+e+" rel="+e+"noopener noreferrer"+e+c+"$&"+b+"/a"+c)),i=i.replace(k,l),g[h]=i}return a=g.join(""),j.textToHtmlEscaped(a).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")}function f(b,c){if(!b||!b.childNodes||!b.childNodes.length)return b;for(var d,h=0,i=b.childNodes.length;h<i;h++)switch(d=b.childNodes[h],d.nodeType){case 1:if("A"===d.nodeName){var k=a.isElectron?g.getCurrentWindow()._domain:window.location&&window.location.origin;j.isCircuitLink(k,d.href)||(d.target="_blank",d.rel="noopener noreferrer")}f(d,c);break;case 3:for(c.innerHTML=e(d.textContent),h+=c.childNodes.length-1;c.childNodes.length;)b.insertBefore(c.childNodes[0],d);b.removeChild(d),i=b.childNodes.length}return b}a.__server="",a.__domain="",a.isElectron=!("undefined"==typeof process||!process.versions||!process.versions.electron);var g,h=a.logger,i=a.Emoticons;a.isElectron&&(g=require("electron").remote,a.__server=g.getCurrentWindow()._domain);var j={};j.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var k=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi,l="https://embed-proxy.circuitsandbox.net/?target=",m=20;j.standardizeEmoticon=function(a){return a?a.replace(k,b):""},j.isPromise=function(a){return!(!a||"function"!=typeof a.then)},j.convertVersionToNumber=function(a){if("string"!=typeof a)return 0;var b=a.split("."),c=parseInt(b[0],10)||0,d=parseInt(b[1],10)||0;d=Math.min(d,99);var e=parseInt(b[2],10)||0;return e=Math.min(e,9999),e+1e4*d+1e6*c},j.trimTextWithEmoticonsBeforeMatch=function(a,b,c){for(var d="...",e=a.indexOf(b),f=a.slice(e),g=a.slice(0,e),h=String.fromCharCode(17),i=String.fromCharCode(18),j=g.replace(k,function(a,b){return h+b+i}),l=!0,m=j.length-1,n=j.length-1,o=n;g.length-1-m<=c&&n>=0;)18===j.charCodeAt(n)?(j=j.replaceAt(n,">"),l=!1):17===j.charCodeAt(n)&&(j=j.replaceAt(n,"<"),l=!0),o=n,n--,l&&m--;return g=o>0?d+j.slice(o):j,g+f},j.encodeUTF8=function(a){return unescape(encodeURIComponent(a))},j.enhanceEncodeURI=function(a){var b={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(a).replace(/[!\(\)#\{\}]/gi,function(a){return b[a]})},j.decodeUTF8=function(a){return decodeURIComponent(escape(a))},j.urlExists=function(a){var b=new XMLHttpRequest;return b.open("HEAD",a,!1),b.send(),404!==b.status},j.normalizeDn=function(a){return a?a.replace("+",""):""},j.cleanPhoneNumber=function(a){return a?a.replace(/[^\*\#\d\+]/g,""):""},j.isMSDoc=function(a){return a.search(/<\S*?WordDocument>/i)>=0||a.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)>=0||a.search(/<meta[^>]*?Microsoft/i)>=0},j.isXCodeDoc=function(a){return a.search(/<[^>]*?content=[^>]*?Cocoa[^<]+?>/)>=0},j.sanitizer=null,j.sanitize=function(a){if(!a||!j.sanitizer)return a;try{a=a.replace(/^[\s\S]*<!--StartFragment-->/gi,""),a=a.replace(/<!--EndFragment-->[\s\S]*$/gi,""),a=a.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"'),a=a.replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,function(a){return a.indexOf("class=")>0?a.replace(/class=".*?"/gi,function(a){return a.indexOf("rich-text-highlight")>0?a:a.replace(/[^=]\s*(.*)/gi,function(a){return a.slice(0,-1)+" rich-text-highlight"})}):a.replace(">",function(a){return' class="rich-text-highlight" '+a})}),a=a.replace(/<img(?![^>]*class="emoticon-icon)[^>]*>/gi,""),a=a.replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),a=i.normalizeEmoticonHtml(a),a=a.replace(/<font[^>]*>|<\/font>/gi,""),a=a.replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>"),a=a.replace(/(\r\n|\r|\n)+?(?=[^<]*?>)/gi," "),a=a.replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof j.sanitizer&&(a=j.sanitizer(a));var b=a.split(/<\/?div.*?>|<\/?p.*?>/g).filter(function(a){return!!a}),c=b.length,d="";if(c>1)for(var e,f,g=new RegExp("<br>(?![\\s\\S]*<br>)(?=(<[^/][^>]*></[^>]*>)*$|(</[^>]*>)*$|$)","i"),k=0;k<c;k++)e=b[k].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!f||f.endsWith("</ul>")||f.endsWith("</ol>")||g.test(f)||(d+="<br>"),d+=e,f=e;else d=b[0];a=d}catch(b){return h.error("[Utils]: Error sanitizing content. ",b),h.error("[Utils]: Unexpected content: ",a),""}return a},j.toPlainText=function(a,b){if(a&&(!b||"RICH"===b)){a=a.replace(i.HTML_REGEX,"$1");var c=document.createElement("div");return c.innerHTML=a.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;"),c.textContent}return a},j.toPlainTextWithEmoticonHtml=function(a,b){if(a&&(!b||"RICH"===b)){var c=String.fromCharCode(17),d=String.fromCharCode(18);a=a.replace(i.HTML_REGEX,c+"$1"+d);var e=document.createElement("div");e.innerHTML=a.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;");var f=j.textToHtmlEscaped(e.textContent,!0);return f.replace(/\x11([^\x11\x12]*)\x12/gim,function(a,b){return i.getHtmlFromShortcut(b,!1,!0,!0)})}return a},j.truncateFileName=function(a){return!a||a.length<=22?a:a.substring(0,10)+" ..."+a.substring(a.length-8,a.length)},j.convertItemText=function(a,b,c){return a?c?j.toPlainTextWithEmoticonHtml(a,b):j.toPlainText(a,b):""},j.invertHash=function(a){var b={};if(a)for(var c in a)if(c){var d=a[c];d&&(b[d]=c)}return b},j.DEFAULT_HELP_URL="https://www.circuit.com/support",j.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",j.URL_SEPARATORS_PATTERN=/(?=[.,;!?]?\s+|[.,;!?]$)/,j.URL_PATTERN=/(http|ftp|https):\/\/[\w-]+?((\.|:)[\w-]+?)+?([\w.,@?'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,j.EXACT_URL_PATTERN=new RegExp("^"+j.URL_PATTERN.source+"$","i"),j.PSEUDO_URL_PATTERN=/www\.+[\w-]+?(\.[\w-]+?)+?([\w.,@?\'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?\'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,j.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?(?:\.[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]+?)*?(?:\.[a-z]{2,})/gim,j.EMAIL_ADDRESS_PATTERN=new RegExp("^"+j.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),a.isElectron&&g&&(j.SSO_EMAIL_DOMAINS_MAPPING=g.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING,j.SSO_PATTERN="[_a-z0-9-]+?@(("+j.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",j.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(j.SSO_PATTERN,"i")),j.CIRCUIT_CONVERSATION_HASH_PATTERN=/\#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(\&user=(\d)+?)?)))?$/gim,j.CIRCUIT_PROFILE_HASH_PATTERN=/\#\/profile\/[0-9\-a-z]+?$/gim,j.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,j.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,j.PHONE_PAC=/^([\#\*]+[\#\*\d]*)$/,j.matchPhonePattern=function(a){return a&&"string"==typeof a?a.match(j.PHONE_PATTERN):null},j.matchGNFPhonePattern=function(a){return a&&"string"==typeof a?a.match(j.GNF_PHONE_PATTERN):null},j.matchUrlPattern=function(a){return a&&"string"==typeof a?a.match(j.URL_PATTERN)||a.match(j.PSEUDO_URL_PATTERN):null},j.matchEmailPattern=function(a){return a&&"string"==typeof a?a.match(j.EMAIL_ADDRESS_INCLUDED_PATTERN):null},j.matchNames=function(a,b,c){if(!a||"string"!=typeof a||!b)return!1;var d=new RegExp("^"+RegExp.escape(b),c||"i");return d.test(a)||a.split(" ").some(function(a){return d.test(a)})},j.compareStrings=function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;var c=new RegExp("^"+RegExp.escape(a)+"$","i");return c.test(b)},j.rstring=function(){return Math.floor(1e9*Math.random()).toString()},j.randomNumber=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},j.randomBoolean=function(){return.5>Math.random()},j.randomValueOfObject=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return 0===c.length?null:a[c[Math.floor(Math.random()*c.length)]]},j.generateCallId=function(){return"WRTC-"+j.rstring()+"-"+j.rstring()},j.createTransactionId=function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[14]="4",a[19]=b.substr(a[19]&&3||8,1),a[8]=a[13]=a[18]=a[23]="-";var d=a.join("");return d},j.getLegalRegion=function(a){switch(a){case"europe":var b=(navigator.language||navigator.browserLanguage).split("-"),c=b.last();return"de"===c.toLowerCase()?"de":"uk";case"americas":case"apac":return"us";default:return"us"}},j.getBrowserInfo=function(){if("iOS"===window.navigator.platform)return{ios:!0,type:"ios"};if("Android"===window.navigator.platform)return{android:!0,type:"android"};if("node"===window.navigator.platform)return{node:!0,type:"node"};if(Circuit.isElectron)return{chrome:!0,type:"chrome"};var a={},b=navigator.userAgent.toLowerCase(),c=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(b)||/(opera|opr)(?:.*version|)\/([\d.]+)/.exec(b)||/(firefox)\/([\d.]+)/.exec(b)||/version\/([\d.]+).*(safari)/.exec(b)||/(edge)\/([\d.]+)/.exec(b)||/(chrome)\/([\d.]+)/.exec(b)||/(phantomjs)\/([\d.]+)/.exec(b)||[],d=c[1]||"",e=c[2]||0;return"safari"===e?(d=c[2],e=c[1]):"trident"===d?d="msie":"opr"===d?d="opera":"phantomjs"===d&&(d="phantomjs"),a[d]=!0,a.type=d,a.version=e,a},j.checkUserDomain=function(b){return a.isElectron?require("electron").remote.getCurrentWindow()._domain.split(":")[0].endsWith(b):window.location.hostname.endsWith(b)},j.getChannelInfo=function(a){var b=a.stat("googLocalAddress")+":";b+=a.stat("googRemoteAddress");var c=b.split(":"),d=function(a){switch(a){case"local":return"host";case"stun":return"srflx";default:return a}};return{ipl:c[0],ptl:c[1],ipr:c[2],ptr:c[3],lct:d(a.stat("googLocalCandidateType")),rct:d(a.stat("googRemoteCandidateType")),tt:a.stat("googTransportType")}},j.CALL_STATS={bytesReceived:"or",bytesSent:"os",googFrameRateSent:"frs",googJitterReceived:"jr",googRtt:"rtt",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"},j.formatStatsForClientDiagnostics=function(a,b,c,d,e){if(!b||!c)return null;var f,g,h={startTime:a,pcType:d,audio:{},video:{}},i=b.result?b.result():b;if(!Array.isArray(i))return null;if(i.forEach(function(a){if(a){var b=null;if("googCandidatePair"===a.type&&"true"===a.stat("googActiveConnection"))"Channel-audio-1"===a.stat("googChannelId")?(h.audio.rtt=parseInt(a.stat("googRtt"),10),e&&(f=a.stat("localCandidateId"),h.audio.channelInfo=j.getChannelInfo(a))):(h.video.rtt=parseInt(a.stat("googRtt"),10),e&&(g=a.stat("localCandidateId"),h.video.channelInfo=j.getChannelInfo(a,a.stat("localCandidateId"))));else if("ssrc"===a.type){var c={id:a.id,ssrc:a.stat("ssrc")};a.stat("audioInputLevel")?(h.audio.transmit||(h.audio.transmit=c),b=h.audio.transmit):a.stat("audioOutputLevel")?(h.audio.receive||(h.audio.receive=c),b=h.audio.receive):a.stat("googFrameHeightSent")?(h.video.transmit||(h.video.transmit=c),b=h.video.transmit):a.stat("googFrameHeightReceived")&&(h.video.receive||(h.video.receive=c),b=h.video.receive)}if(a.names&&b){var d=a.names()||[];d.forEach(function(c){j.CALL_STATS[c]&&(b[j.CALL_STATS[c]]=parseInt(a.stat(c),10))})}e&&b&&a.stat&&(b.en=a.stat("googCodecName"))}}),e){var k=h.audio.channelInfo?1:0;h.video.channelInfo?k++:0,i.some(function(a){if(a&&"localcandidate"===a.type){if(f===a.id&&h.audio.channelInfo)return h.audio.channelInfo.ni=a.stat("networkType"),--k<=0;if(g===a.id&&h.video.channelInfo)return h.video.channelInfo.ni=a.stat("networkType"),--k<=0}})}return h},j.getRTPStatsForClientDiagnostics=function(a,b,c,d,e){b&&b.getStats?b.getStats(function(f){f?e&&e(null,j.formatStatsForClientDiagnostics(a,f,b,c,d)):e&&e("getStats did not return a response")},e):e&&e("getStats or pc not available")},j.isEmptyObject=function(a){return 0===Object.keys(a).length},j.getBaseObject=function(a,b){if(!a||"object"!=typeof a)return null;if(a instanceof Array)return a;var c=Object.getPrototypeOf(a);return j.isEmptyObject(c)?a:(b!==!1&&Object.getOwnPropertyNames(c).forEach(function(b){"function"!=typeof c[b]&&a.hasOwnProperty(b)&&(c[b]=a[b])}),c)},j.syncBaseObject=function(a){var b=j.getBaseObject(a,!0);b&&b!==a&&Object.getOwnPropertyNames(b).forEach(function(b){a.hasOwnProperty(b)&&delete a[b]})},j.flattenObj=function(a){if(!a||"object"!=typeof a)return a;var b=Object.getPrototypeOf(a);if(j.isEmptyObject(b))return a;var c={};for(var d in a)"function"!=typeof a[d]&&(c[d]=a[d]);return c},j.getNormalizedFileExtension=function(a){var b=a&&(a.fileName||a.name);if(!b)return null;if(/audio/i.test(a.mimeType))return"audio";if(/video/i.test(a.mimeType))return"video";var c=b.split(".").pop();if(c)switch(c.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio"}return"def"},j.getImageFileExtension=function(a){if(a.type)switch(a.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},j.getMimeTypes=function(a){if(!a)return null;var b=a.split(".").pop();if(b)switch(b.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},j.textToHtmlEscaped=function(a,b){if(!a)return"";var c=b?"&nbsp;":"<br>";return a.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,c)},j.escapedHtmlToText=function(a){return a?a.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},j.stripParenthesis=function(a){a=a.trim();for(var b=a.match(/\(/g)||[],c=a.match(/\)/g)||[],d=0;"("===a[d];)d++;return a.slice(d,a.length-Math.abs(b.length-d-c.length))},j.linkifyContent=function(a,b){if(j.isMobile())return"";switch(a=i.addEmoticonsAltAttr(a),b){case"RICH":return c(a);case"PLAIN":return e(a)}return a},j.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],j.hasScrollbar=function(a){if(a&&a.length>0){var b=a[0];return!!b&&b.scrollHeight>b.clientHeight}return!1},j.isDescendantOrEqual=function(a,b){if(a===b)return!0;for(var c=a;c;)if(c=c.parentElement,c===b)return!0;return!1},j.isSupportedImage=function(a){var b=/^image\/(jpeg|gif|bmp|png|svg\+xml)$/i;return b.test(a)},j.isVideoSupportedByBrowser=function(a){var b=/^video\/(quicktime|mp4|webm)$/i;return b.test(a)},j.shallowCopy=function(a){if(!a||"object"!=typeof a)return a;if(Array.isArray(a))return a.slice();var b=j.flattenObj(a),c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c},j.extend=function(a,b){a&&b&&"object"==typeof a&&"object"==typeof b&&Object.keys(b).forEach(function(c){a[c]=b[c]})},j.normalizeLocaleProto=function(a){var b;return a&&a.length>=5&&(b=a.replace(/-/g,"_").toUpperCase()),b},j.normalizeLocale=function(a){var b;return a&&a.length>=5&&(b=a.substr(0,2).toLowerCase()+a.substr(2,a.length-2).replace(/_/g,"-")),b},j.getLocalTime=function(a){var b=new Date;return null===a||void 0===a?b.getTime():(b.setTime(b.getTime()+60*(b.getTimezoneOffset()-a)*1e3),b.getTime())},j.delayOrTimestamp=function(a,b){return a>0?Date.now()+a:b},j.buildAttachmentMetaData=function(a){var b=function(a){return{fileId:a.fileId,fileName:a.fileName,itemId:a.itemId,mimeType:a.mimeType,size:a.size}},c=[],d=[];return a&&a.forEach(function(a){if(a.isThirdParty){var e=b(a);return void d.push({type:a.provider,attachment:e,downloadLocation:a.url,previewLocation:a.url,shareLinkToken:a.shareLinkToken})}c.push(b(a)),a.thumbnail&&c.push(b(a.thumbnail))}),{attachments:c,externalAttachments:d}},j.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.parent=b.prototype},j.isOlderThan=function(a,b){if(!a)return!0;var c=864e5;return b=b||1,Date.now()-a>b*c},j.bytesToSize=function(a,b){if(a=parseInt(a,10),!a)return"0 Bytes";var c=1024,d=["Bytes","KB","MB","GB","TB","PB"],e=Math.floor(Math.log(a)/Math.log(c));return Number((a/Math.pow(c,e)).toPrecision(b||3))+" "+d[e]},j.isMacOs=!(!window.navigator||!window.navigator.userAgent)&&(window.navigator.userAgent.indexOf("Mac")!==-1||window.navigator.userAgent.indexOf("Darwin")!==-1),j.isWindowsOs=!(!window.navigator||!window.navigator.platform)&&"win"===window.navigator.platform.substring(0,3).toLowerCase(),j.daysBetween=function(a,b){if(a instanceof Date&&b instanceof Date){var c=864e5;return Math.floor(Math.abs(b.getTime()-a.getTime())/c)}},j.checkVisibility=function(a,b,c){var d={isVisible:!1,bottomVisibility:{isBottomVisible:!1,bottomHiddenBy:0}};if(!a||!b)return d;c=null!==c&&void 0!==c?c/100:.25;var e=a[0].clientHeight;if(0===e)return d;var f=b[0].clientHeight,g=b.offset().top,h=a.offset().top-g,i=h+e,j=Math.min(m,Math.floor(e*c));h+=j,i-=j;var k=i<=f&&i>=0,l=h>=0&&h<=f,n=l||k||h<0&&i>f,o=i<g,p=!k&&i-f||0;return d={isVisible:n,isAbove:o,bottomVisibility:{isBottomVisible:k,bottomHiddenBy:p}}},j.isMobile=function(){return"iOS"===window.navigator.platform||"Android"===window.navigator.platform},j.formatPIN=function(a,b,c){if(!b)return"";if(c)return(a||"")+b+"#";for(var d,e=4,f=3,g=2,h=[],i=a?f:e,j=0;j<b.length;j+=i)j>0&&(i=f),d=b.substr(j,i),d.length>=g||0===h.length?h.push(d):h[h.length-1]+=d;return a&&h.unshift(a),h.push("#"),h.join(" ")},j.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",
code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],j.CountryCodeToCountryNameResourceMap={},j.CountriesArray.forEach(function(a){j.CountryCodeToCountryNameResourceMap[a.code]=a.name}),j.isCircuitLink=function(b,c){if(b&&c){if(a.isElectron&&0===c.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return!0;if(c.startsWith("#/"))return!0;var d=/^(?:http|https|ftp):\/\//;if(d.exec(b)||(b="https://"+b),b.endsWith("/")||(b+="/"),d.exec(c)||(c="https://"+c),c.length>b.length&&c.startsWith(b)){var e=c.slice(b.length),f=e.match(j.CIRCUIT_CONVERSATION_HASH_PATTERN);return f?f[0].replace(/\/(muted|open)/gim,"/conversation"):(f=e.match(j.CIRCUIT_PROFILE_HASH_PATTERN),f&&f[0])}return!1}},j.throttle=function(a,b,c){var d,e,f,g=null,h=0;c=c||{};var i=function(){h=c.leading===!1?0:Date.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=Date.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0?(g&&(window.clearTimeout(g),g=null),h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=window.setTimeout(i,k)),f}},j.hasEmptyPrototype=function(a){return!(!a||"object"!=typeof a)&&j.isEmptyObject(Object.getPrototypeOf(a))},j.compareElements=function(a,b){if(a===b)return!0;if(!a||!b)return!1;if("object"!=typeof a||"object"!=typeof b)return!1;if(a instanceof Array&&b instanceof Array)return function(a,b){var c=a.length,d=[];if(a===b)return!0;if(a.length!==b.length)return!1;for(var e=0;e<c;++e)for(var f=0;f<c;++f)if(d.indexOf(b[f])===-1&&j.compareElements(a[e],b[f])){d.push(b[f]);break}return d.length===c}(a,b);if(!j.hasEmptyPrototype(a)||!j.hasEmptyPrototype(b))return!1;for(var c in a)if(a.hasOwnProperty(c)&&0!==c.indexOf("$$")&&!j.compareElements(a[c],b[c]))return!1;return!0},j.copyToClipboard=function(a,b,c){var d,e,f;if(a)try{e=document.createRange(),d=window.getSelection(),f=document.createElement("div"),a=a.replace(/\r\n/gi,"<br>"),f.style.backgroundColor="#fff",f.style.font="normal normal 15px Calibri, sans-serif",f.style["white-space"]="pre-wrap",c?f.innerText=a:f.innerHTML=a,document.body.appendChild(f),e.selectNode(f),d.removeAllRanges(),d.addRange(e);var g=document.execCommand("copy");g?b&&b():b&&b("Failed to copy")}catch(a){h.error("[Utils]: Copy to clipboard failed"),b&&b("Internal error")}finally{d&&("function"==typeof d.removeRange?d.removeRange(e):d.removeAllRanges()),f&&document.body.removeChild(f)}},j.openNewWindow=function(a){var b=window.open(a);window.setTimeout(function(){b.close()},100)},j.sslProxify=function(a){return a&&a.startsWith("http:")?l+encodeURIComponent(a):a},j.appIsFocused=function(){return a.isElectron?g.getCurrentWindow().isFocused():document.hidden!==!0},j.validatePreviewProtocol=function(a){return a?a.match(/https:/)?a:a.replace('src="//','src="https://'):""},j.TabSelector=function(a){function b(){Object.keys(d).forEach(function(a){d[a]=!1})}if(Array.isArray(a)&&0!==a.length){var c=this,d={},e="";a.forEach(function(a,f){0===f?(d[a]=!0,e=a):d[a]=!1,Object.defineProperty(c,a,{get:function(){return d[a]},set:function(c){c&&(b(),d[a]=!0,e=a)},enumerable:!0,configurable:!1})}),Object.defineProperty(this,"selected",{get:function(){return e},enumerable:!0,configurable:!1})}},j.getOrigin=d,j.parseQS=function(a){var b={};a=a.substring(1);for(var c=/([^&=]+)=([^&]*)/g,d=c.exec(a);d;)b[decodeURIComponent(d[1])]=decodeURIComponent(d[2]),d=c.exec(a);return b},j.toQS=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},j.extractConfigurableText=function(a,b,c){var d=a&&a.find(function(a){return a.type===b});if(d&&d.texts){var e,f=function(a){return d.texts.find(function(b){return b.language===a})};return c&&(e=f(c),e||(c=c.split("-",1)[0],e=f(c))),e||(e=f("default")),e&&e.translation}},String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return a[c]||b})},String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return null!==a&&void 0!==a&&(a=a.toString(),b=Math.floor(b)||0,this.substr(b,a.length)===a)}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){return null!==a&&void 0!==a&&(b=void 0===b?this.length:Math.min(Math.floor(b)||0,this.length),a=a.toString(),b-=a.length,!(b<0)&&this.substr(b,a.length)===a)}),String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)},Array.prototype.isEmpty||(Array.prototype.isEmpty=function(){return 0===this.length}),Array.prototype.last||(Array.prototype.last=function(){if(this.length>0)return this[this.length-1]}),Array.prototype.shuffle=function(){for(var a=this.length,b=0;b<a;b++){var c=Math.floor(Math.random()*a),d=this[c];this[c]=this[b],this[b]=d}return this},Array.prototype.randomCopy=function(a){var b=this.slice(0);return b.shuffle(),b.splice(0,a)},Array.prototype.move=function(a,b){if(void 0!==a&&void 0!==b){if(b>=this.length)for(var c=b-this.length;c--+1;)this.push(void 0);this.splice(b,0,this.splice(a,1)[0])}},Array.prototype.remove=function(a){if("undefined"!=typeof a&&a){var b=this.indexOf(a);b>-1&&this.splice(b,1)}},Array.prototype.includes||(Array.prototype.includes=function(a){return this.indexOf(a)!==-1}),Array.prototype.contains=function(a){return this.indexOf(a)!==-1},Array.prototype.binaryInsert=function(a,b){if("function"!=typeof b)return!1;for(var c,d,e=0,f=this.length-1,g=!1;e<=f;)if(c=Math.floor((e+f)/2),d=this[c],b(d,a)<0)e=c+1;else{if(!(b(d,a)>0)){g=!0;break}f=c-1}var h=g?c+1:e;return h>=0&&(this.splice(h,0,a),!0)},Array.prototype.empty||(Array.prototype.empty=function(){for(;this.length>0;)this.pop()}),Array.prototype.copy||(Array.prototype.copy=function(a){this.empty(),this.push.apply(this,a)}),Array.prototype.diff||(Array.prototype.diff=function(a){return this.filter(function(b){return!a.contains(b)})}),Array.prototype.findAndRemove=function(a){if("function"==typeof a)for(var b=0;b<this.length;b++)if(a(this[b]))return this.splice(b,1)},Array.prototype.find||(Array.prototype.find=function(a){if(null===this||void 0===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b}),Array.prototype.findIndex||(Array.prototype.findIndex=function(a){if(null===this||void 0===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1}),RegExp.escape=function(a){if(!a)return"";var b=a.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&");return b},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var n={};return n.format=function(a){if("undefined"!=typeof PhoneNumberUtil&&a&&"+"===a.charAt(0))try{var b=PhoneNumberUtil.parseAndKeepRawInput(a,null);a=PhoneNumberUtil.formatInternational(b)}catch(a){}return a},a.Utils=j,a.PhoneNumberFormatter=n,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){try{return d?d[a].apply(d,b):null}catch(a){return null}}var c,d=null;"undefined"!=typeof chrome&&(c=chrome.storage&&chrome.storage.local);try{d=c||window.localStorage||d}catch(a){d=window.sessionStorage||d}var e={getItem:function(a){return b("getItem",[a])},setItem:function(a,c){return b("setItem",[a,c])},removeItem:function(a){return b("removeItem",[a])}};return a.storeManager=e,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.logger,c=a.Utils,d=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS"},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},ExternalUnshareProviderType:{SYNCPLICITY:"SYNCPLICITY"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",GUEST_JOINED:"GUEST_JOINED",GUEST_INVITED:"GUEST_INVITED",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},SearchActionType:{START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{MAINTENANCE:"MAINTENANCE",CLIENT_UPDATE:"CLIENT_UPDATE"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL"},UserActionType:{WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES"},UserEventType:{USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND",UPDATE:"UPDATE"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",
TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING"},OAuthScope:{ALL:"ALL",CALLS:"CALLS",READ_CONVERSATIONS:"READ_CONVERSATIONS",READ_USER:"READ_USER",READ_USER_PROFILE:"READ_USER_PROFILE",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",WRITE_USER_PROFILE:"WRITE_USER_PROFILE"},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",EXPORT_TENANT:"EXPORT_TENANT",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",ASSIGN_PHONE_NUMBER:"ASSIGN_PHONE_NUMBER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",UPDATE_TENANT:"UPDATE_TENANT"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},UploadManifestResponseCode:{UPLOAD_SUCCESS:"UPLOAD_SUCCESS",INVALID_JSON_FORMAT:"INVALID_JSON_FORMAT",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION"},Constraint:{NOT_BLANK:"NOT_BLANK",URL:"URL",BASE64_ICON:"BASE64_ICON"},ExportTenantFormat:{CSV:"CSV",JSON:"JSON"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",HELP_URL:"HELP_URL",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE"},ExtensionState:{ENABLED:"ENABLED",DISABLED:"DISABLED"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_DRIVE:"GOOGLE_DRIVE",SYNCPLICITY:"SYNCPLICITY"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",MOBILE_BREAKOUT:"MOBILE_BREAKOUT"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED"},VotingType:{ACCEPT_DECLINE:"ACCEPT_DECLINE",APPROVE_REJECT:"APPROVE_REJECT",YES_NO:"YES_NO",YES_NO_MAYBE:"YES_NO_MAYBE",A_B:"A_B",ONE_TWO_THREE_FOUR:"ONE_TWO_THREE_FOUR"},LabFeatureName:{ARCHIVE:"ARCHIVE",AUDIO_PLAYER:"AUDIO_PLAYER",CALL_ON_LOCKED_SCREEN:"CALL_ON_LOCKED_SCREEN",CURTAIN:"CURTAIN",ENHANCED_SEARCH:"ENHANCED_SEARCH",EXCHANGE_CONTACTS_CACHE:"EXCHANGE_CONTACTS_CACHE",EXPORT_USER_DATA:"EXPORT_USER_DATA",EXTENSIONS:"EXTENSIONS",FIREBASE_PUSH_NOTIFICATIONS:"FIREBASE_PUSH_NOTIFICATIONS",INVITE_PARTNER:"INVITE_PARTNER",JABRA_CALL_CONTROL:"JABRA_CALL_CONTROL",LEAK_CANARY:"LEAK_CANARY",MANAGE_DEVICE_ACCESS:"MANAGE_DEVICE_ACCESS",MINI_CALL_STAGE:"MINI_CALL_STAGE",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",NEW_CALL_SCREEN:"NEW_CALL_SCREEN",NEW_FAVORITES_EDIT_MODE:"NEW_FAVORITES_EDIT_MODE",OPEN_XCHANGE:"OPEN_XCHANGE",ORGANISE_CONTENT:"ORGANISE_CONTENT",PARTICIPANT_DRAWING:"PARTICIPANT_DRAWING",REVERSE_GEOCODING:"REVERSE_GEOCODING",SCREENSHARE_TAP_INDICATOR:"SCREENSHARE_TAP_INDICATOR",SHARE_VIA_CIRCUIT:"SHARE_VIA_CIRCUIT",STATUS_NOTIFICATION:"STATUS_NOTIFICATION",TELEPHONY_ROUTING_MANAGEMENT:"TELEPHONY_ROUTING_MANAGEMENT",TEXT_TO_SPEECH:"TEXT_TO_SPEECH",VIDEO_PLAYER:"VIDEO_PLAYER",VOTING:"VOTING",WHITEBOARD:"WHITEBOARD"},DraftType:{PRIVATE:"PRIVATE",OPEN:"OPEN",BRIDGE:"BRIDGE",LARGE:"LARGE"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT"}}),e=function(){function a(a){if(!a)return"";var b={};if(e.forEach(function(c){void 0!==a[c]&&null!==a[c]&&(b[c]=a[c])}),c.isEmptyObject(b))return"";var d=JSON.stringify(b);return d=c.textToHtmlEscaped(d),f.replace("%%1",d)}function d(a){if(a&&a.text)try{if(e.forEach(function(b){void 0===a[b]&&(a[b]=null)}),!a.text.content)return;var d=g.exec(a.text.content);if(d&&d[0]){a.text.content=a.text.content.slice(d[0].length);var f=d[1];if(f){f=c.escapedHtmlToText(f);var h=JSON.parse(f);e.forEach(function(b){void 0!==h[b]&&(a[b]=h[b])})}}}catch(a){b.error("[Proto]: Failed to retrieve private data. ",a)}}var e=["voting"],f="||::$$privateData=%%1::||",g=/^\|\|::\$\$privateData=({.*})::\|\|/;return{SUPPORTED_PRIVATE_DATA_FIELDS:e,convertPrivateDataToContent:a,retrievePrivateDataFromContent:d}}(),f={requestNr:0,Request:function(a,b){var c={msgType:d.WSMessageType.REQUEST,request:{requestId:++f.requestNr,type:a}};switch(a){case d.ContentType.CONVERSATION:c.request.conversation=b;break;case d.ContentType.USER:c.request.user=b;break;case d.ContentType.RTC_CALL:c.request.rtcCall=b;break;case d.ContentType.RTC_SESSION:c.request.rtcSession=b;break;case d.ContentType.SEARCH:c.request.search=b;break;case d.ContentType.INSTRUMENTATION:c.request.instrumentation=b;break;case d.ContentType.ADMINISTRATION:c.request.administration=b;break;case d.ContentType.SYSTEM:c.request.system=b;break;case d.ContentType.THIRDPARTYCONNECTORS:c.request.thirdpartyconnectors=b;break;case d.ContentType.GUEST:c.request.guest=b;break;case d.ContentType.USER_TO_USER:c.request.userToUser=b;break;case d.ContentType.VERSION:c.request.version=b;break;case d.ContentType.ACCOUNT:c.request.account=b;break;case d.ContentType.ACTIVITYSTREAM:c.request.activityStream=b;break;case d.ContentType.USER_DATA:c.request.userData=b}return c},ParseEvent:function(a){var b,c={};switch(a.type){case d.ContentType.CONVERSATION:switch(b="Conversation."+a.conversation.type,a.conversation.type){case d.ConversationEventType.CREATE:c=a.conversation.create;break;case d.ConversationEventType.UPDATE:c=a.conversation.update;break;case d.ConversationEventType.ADD_ITEM:c=a.conversation.addItem;break;case d.ConversationEventType.ADD_PARTICIPANT:c=a.conversation.addParticipant;break;case d.ConversationEventType.UPDATE_ITEM:c=a.conversation.updateItem;break;case d.ConversationEventType.READ_ITEMS:c=a.conversation.readItems;break;case d.ConversationEventType.TYPING:c=a.conversation.typing;break;case d.ConversationEventType.DRAFT_MESSAGE_SAVED:c=a.conversation.draftMessage;break;case d.ConversationEventType.DRAFT_MESSAGE_DISCARDED:c=a.conversation.draftMessage;break;case d.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:c=a.conversation.draftMessage;break;case d.ConversationEventType.FLAG_ITEM:c=a.conversation.setFlagItem;break;case d.ConversationEventType.CLEAR_FLAGGED_ITEM:c=a.conversation.clearFlaggedItem;break;case d.ConversationEventType.CONVERSATION_MARKED:c=a.conversation.conversationMarked;break;case d.ConversationEventType.CONVERSATION_UNMARKED:c=a.conversation.conversationUnmarked;break;case d.ConversationEventType.FAVORITE_POSITION_CHANGED:c=a.conversation.favoritePositionChangedEvent;break;case d.ConversationEventType.USER_DATA_CHANGED:c=a.conversation.userDataChangedEvent}c.convId=a.conversation.convId;break;case d.ContentType.USER:switch(b="User."+a.user.type,a.user.type){case d.UserEventType.USER_PRESENCE_CHANGE:c=a.user.presenceChanged;break;case d.UserEventType.USER_UPDATED:c=a.user.userUpdated;break;case d.UserEventType.SESSION_CLOSED:c=a.user.sessionClosed;break;case d.UserEventType.PASSWORD_CHANGED:c=a.user.passwordChanged;break;case d.UserEventType.USER_SETTING_UPDATED:c=a.user.userSettingUpdated;break;case d.UserEventType.TELEPHONY_DATA:c=a.user.telephonyData;break;case d.UserEventType.DEVICE_LIST_CHANGED:c=a.user.deviceListChangedEvent;break;case d.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:c=a.user.notificationSubscriptionChange}c.userId=a.user.userId;break;case d.ContentType.RTC_CALL:switch(b="RTCCall."+a.rtcCall.type,a.rtcCall.type){case d.RTCCallEventType.SDP_ANSWER:c=a.rtcCall.sdpAnswer;break;case d.RTCCallEventType.SDP_FAILED:c=a.rtcCall.sdpFailed;break;case d.RTCCallEventType.INVITE:c=a.rtcCall.invite;break;case d.RTCCallEventType.INVITE_CANCEL:c=a.rtcCall.inviteCancel;break;case d.RTCCallEventType.INVITE_FAILED:c=a.rtcCall.inviteFailed;break;case d.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:c=a.rtcCall.changeMediaRequested;break;case d.RTCCallEventType.PROGRESS:c=a.rtcCall.participantProgress;break;case d.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:c=a.rtcCall.changeMediaTypeForcedEvent;break;case d.RTCCallEventType.ICE_CANDIDATES:c=a.rtcCall.iceCandidates}c.sessionId=a.rtcCall.sessionId,c.instanceId=a.rtcCall.instanceId;break;case d.ContentType.RTC_SESSION:switch(b="RTCSession."+a.rtcSession.type,a.rtcSession.type){case d.RTCSessionEventType.SESSION_STARTED:c=a.rtcSession.sessionStarted;break;case d.RTCSessionEventType.SESSION_TERMINATED:c=a.rtcSession.sessionTerminated;break;case d.RTCSessionEventType.SESSION_UPDATED:c=a.rtcSession.sessionUpdated;break;case d.RTCSessionEventType.SESSION_MOVED:c=a.rtcSession.sessionMoved;break;case d.RTCSessionEventType.PARTICIPANT_JOINED:c=a.rtcSession.participantJoined;break;case d.RTCSessionEventType.PARTICIPANT_LEFT:c=a.rtcSession.participantLeft;break;case d.RTCSessionEventType.PARTICIPANT_UPDATED:c=a.rtcSession.participantUpdated;break;case d.RTCSessionEventType.ACTIVE_SPEAKER:c=a.rtcSession.speaker;break;case d.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:c=a.rtcSession.videoSpeaker;break;case d.RTCSessionEventType.SESSION_RECORDING_INFO:c=a.rtcSession.sessionRecordingInfo;break;case d.RTCSessionEventType.SESSION_RECORDING_STARTED:c=a.rtcSession.sessionRecordingStarted;break;case d.RTCSessionEventType.SESSION_RECORDING_STOPPED:c=a.rtcSession.sessionRecordingStopped;break;case d.RTCSessionEventType.SESSION_RECORDING_FAILED:c=a.rtcSession.sessionRecordingFailed;break;case d.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:c=a.rtcSession.sessionTerminationTimerStarted;break;case d.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:c=a.rtcSession.sessionTerminationTimerCancelled;break;case d.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:c=a.rtcSession.sessionAttributesChangedEvent;break;case d.RTCSessionEventType.QUESTION_EVENT:c=a.rtcSession.questionEvent;break;case d.RTCSessionEventType.INVITE_TO_STAGE_EVENT:c=a.rtcSession.inviteToStageEvent;break;case d.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:c=a.rtcSession.inviteToStageCancelEvent;break;case d.RTCSessionEventType.CURTAIN_EVENT:c=a.rtcSession.curtainEvent}c.sessionId=a.rtcSession.sessionId;break;case d.ContentType.SEARCH:switch(b="Search."+a.search.type,a.search.type){case d.SearchEventType.BASIC_SEARCH_RESULT:c=a.search.basicSearchResult;break;case d.SearchEventType.DETAILED_SEARCH_RESULT:c=a.search.detailSearchResult;break;case d.SearchEventType.SEARCH_STATUS:c=a.search.searchStatus;break;case d.SearchEventType.RECENT_SEARCH_ADDED:c=a.search.recentSearchAdded}c.searchId=a.search.searchId;break;case d.ContentType.SYSTEM:switch(b="System."+a.system.type,a.system.type){case d.SystemEventType.MAINTENANCE:c=a.system.maintenance;break;case d.SystemEventType.CLIENT_UPDATE:c=a.system.update}break;case d.ContentType.ADMINISTRATION:switch(b="Administration."+a.administration.type,a.administration.type){case d.AdministrationEventType.INVITE_MULTIPLE_USERS:c=a.administration.inviteMultipleUsers;break;case d.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:c=a.administration.inviteMultiplePartnerUsers}break;case d.ContentType.THIRDPARTYCONNECTORS:switch(b="ThirdParty."+a.thirdParty.type,a.thirdParty.type){case d.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:c=a.thirdParty.provider;break;case d.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:c=a.thirdParty.provider}break;case d.ContentType.USER_TO_USER:b="UserToUser."+a.userToUser.userToUser.type,c=a.userToUser.userToUser,c.routing=a.userToUser.routing;break;case d.ContentType.ACTIVITYSTREAM:switch(b="ActivityStream."+a.activity.type,a.activity.type){case d.ActivityStreamEventType.ACTIVITY_CREATED:c=a.activity.create.item;break;case d.ActivityStreamEventType.ACTIVITY_DELETED:c=a.activity.delete.item;break;case d.ActivityStreamEventType.ACTIVITY_MARKED_READ:c=a.activity.markRead.itemId;break;case d.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:c=a.activity.markUnread.itemId;break;case d.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:c=a.activity.markAllRead.status}break;case d.ContentType.ACCOUNT:switch(b="Account."+a.account.type,a.account.type){case d.AccountEventType.MIGRATE_MULTIPLE_USERS:c=a.account.migrateMultipleUsers;break;case d.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:c=a.account.telephonyConfigurationUpdated}break;case d.ContentType.CONVERSATION_USER_DATA:switch(b="ConversationUserData."+a.conversationUserData.type,a.conversationUserData.type){case d.ConversationUserDataEventType.LABELS_ADDED:c=a.conversationUserData.labelsAdded;break;case d.ConversationUserDataEventType.LABELS_REMOVED:c=a.conversationUserData.labelsRemoved;break;case d.ConversationUserDataEventType.LABEL_EDITED:c=a.conversationUserData.labelEdited}break;default:return null}return{name:b,data:c}},getMediaType:function(a){if(!a)return{audio:!1,video:!1,desktop:!1};var b={audio:!1,video:!1,desktop:!1};return a.forEach(function(a){switch(a){case d.RealtimeMediaType.AUDIO:b.audio=!0;break;case d.RealtimeMediaType.VIDEO:b.video=!0;break;case d.RealtimeMediaType.DESKTOP_SHARING:b.desktop=!0}}),b}};return a.Constants=d,a.PrivateData=e,a.Proto=f,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,c){this.foundation=1,this.componentId=a?1:2,this.transport="udp",this.priority=1,this.address=b||"0.0.0.0",this.port=c||1,this.typ="host",this.generation=0,this.optional=[]}var c=Object.freeze({TLS_PRIORITY_RANGE_START:0,TLS_PRIORITY_RANGE_END:11e6,TCP_PRIORITY_RANGE_START:12e6,TCP_PRIORITY_RANGE_END:31e6,UDP_PRIORITY_RANGE_START:35e6,UDP_PRIORITY_RANGE_END:6e7});b.prototype.isRtp=function(){return 1===this.componentId},b.prototype.isRtcp=function(){return 2===this.componentId},b.prototype.isTcpTlsRelay=function(){return"relay"===this.typ&&this.priority<c.TCP_PRIORITY_RANGE_END},b.prototype.parse=function(a){a=a.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2");var b=a.split(" ");if(b.length<7)throw new Error("Invalid candidate: "+a);this.foundation=parseInt(b[0],10),this.componentId=parseInt(b[1],10),this.transport=b[2].toLowerCase(),this.priority=parseInt(b[3],10),this.address=b[4],this.port=parseInt(b[5],10),this.typ=b[7];for(var c=8;c<b.length;c+=2)this.optional.push(b[c]),this[b[c]]=b[c+1]},b.prototype.getValue=function(){for(var a=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,b=0;b<this.optional.length;b++){var c=this.optional[b];a+=" "+c+" "+this[c]}return a},b.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},b.prototype.toString=function(){var a="candidate:"+this.getValue();return a};var d=function(){function a(a){var b=a.split(/\s+/);return{username:b[0],id:b[1],version:b[2],nettype:b[3],addrtype:b[4],address:b[5]}}function c(a){var b=a.split(/\s+/);return{nettype:b[0],addrtype:b[1],address:b[2]}}function d(a){var b=/^([^:]+)(?::(.*))?/.exec(a);return{field:b[1],value:b[2]}}function e(a){var b=p.exec(a);return{media:b[1],port:+b[2],portnum:+(b[3]||1),proto:b[4],fmt:b[5]?b[5].split(/\s+/).map(function(a){return+a}):[]}}function f(a,b,c){switch(b){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":a[b]=c;break;default:a[b]?a[b].push(c):a[b]=[c]}}function g(a,b,c){if(void 0!==a[b]){var d=function(a){return b+"="+(q[b]&&q[b](a)||a)+"\r\n"};return Array.isArray(a[b])?a[b].map(d).join(""):d(a[b])}return c?b+"="+c+"\r\n":""}function h(a){return a.filter(function(a){switch(a.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0})}function i(b){for(var g,h=b.split(/\r\n/),i={},j=0;j<h.length&&(g=/^(\w)=(.*)/.exec(h[j]),"m"!==g[1]);++j)"a"===g[1]&&g[2]?f(i,g[1],d(g[2])):f(i,g[1],g[2]);i.m=[];for(var k=null;j<h.length&&(g=/(\w)=(.*)/.exec(h[j]),g);++j)"m"===g[1]?(k=e(g[2]),i.m.push(k)):"a"===g[1]&&g[2]?f(k,g[1],d(g[2])):f(k,g[1],g[2]);return i.s&&""!==i.s.trim()||(i.s="-"),i.o&&(i.o=a(i.o)),i.c&&(i.c=c(i.c)),i.m.forEach(function(a){a.c&&(a.c=c(a.c))}),i}function j(a){var b="string"==typeof a?i(a):a,c=[];return b.m&&b.m.forEach(function(a){"video"===a.media&&a.a.some(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return c.push(a.field),!0}})}),c}function k(a,b){var c="string"==typeof a?i(a):a;b=b||{};var d="sendrecv";return void 0!==b.mLineIndex?(c.m[b.mLineIndex].a.forEach(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":d=a.field}}),d):(b.mediaType&&"both"!==b.mediaType||(b.mediaType="audio"),c.a&&c.a.forEach(function(a){switch(a.field){case"sendonly":case"recvonly":case"inactive":d=a.field}}),c.m&&c.m.forEach(function(a){a.media===b.mediaType&&a.a.forEach(function(a){switch(a.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":d=a.field}})}),d)}function l(a){return!!(a&&a instanceof Array)&&a.some(function(a){return a.indexOf("AS:")!==-1})}function m(a,c,d,e){if(0===a.port)return!0;var f=0,g=!1,h=null,i=null,j=a.a.filter(function(c){if("candidate"!==c.field)return!0;var e=new b;if(e.parse(c.value),"udp"!==e.transport)return!1;if(d&&"video"===a.media){if("relay"!==e.typ)return g=!0,!1;if(!e.isTcpTlsRelay())return o.debug("[SdpParser]: Removed UDP relay candidate: ",c.value),g=!0,!1;!h&&e.isRtp()&&(h=e),!i&&e.isRtcp()&&(i=e)}return f++,!0});return h||!g||e?!(0===f&&!e)&&(a.a=j,i&&a.a.some(function(a){if("rtcp"===a.field)return a.value=i.port+" IN IP4 "+i.address,!0}),h&&(a.port=h.port,a.c&&(a.c.address=h.address)),!0):(o.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),m(a,c,!1))}function n(a,b){var c=-1;return a.m.some(function(a,d){if(a.a.some(function(a){return"mid"===a.field&&a.value===b}))return c=d,!0}),c}var o=Circuit.logger,p=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: (\d+( +\d+)*))?/,q={o:function(a){return[a.username||"-",a.id,a.version,a.nettype||"IN",a.addrtype||"IP4",a.address].join(" ")},c:function(a){return[a.nettype||"IN",a.addrtype||"IP4",a.address].join(" ")},m:function(a){return[a.media||"audio",a.port||"0",a.proto||"RTP/AVP",a.fmt.join(" ")].join(" ")},a:function(a){return a.value?[a.field,a.value].join(":"):a.field}};return{parse:i,stringify:function(a){var b="";return b+=g(a,"v",0),b+=g(a,"o"),b+=g(a,"s","-"),b+=g(a,"i"),b+=g(a,"u"),b+=g(a,"e"),b+=g(a,"p"),b+=g(a,"c"),b+=g(a,"b"),b+=g(a,"t","0 0"),b+=g(a,"r"),b+=g(a,"z"),b+=g(a,"k"),b+=g(a,"a"),a.m.forEach(function(a){b+=g({m:a},"m"),b+=g(a,"i"),b+=g(a,"c"),b+=g(a,"b"),b+=g(a,"k"),b+=g(a,"a")}),b},getConnectionMode:k,getVideoConnectionModes:j,setConnectionMode:function(a,b,c){var d="string"==typeof a?i(a):a,e=b&&"both"!==b?[b]:["audio","video"];return"both"===b&&d.a&&(d.a=h(d.a),d.a.push({field:c})),d.m&&d.m.forEach(function(a){e.indexOf(a.media)!==-1&&(a.a=h(a.a),a.a.push({field:c}))}),d},isHold:function(a){var b=k(a);return"inactive"===b||"sendonly"===b},disableMultiplex:function(a){var b="string"==typeof a?i(a):a;return b.a&&(b.a=b.a.filter(function(a){return"group"!==a.field})),b},hasVideo:function(a){var b="string"==typeof a?i(a):a;return!!b.m&&b.m.some(function(a,c){return"video"===a.media&&0!==a.port&&0!==a.fmt.length&&("inactive"!==k(b,{mLineIndex:c})&&a.a.some(function(a){return"rtpmap"===a.field&&a.value.indexOf("VP8")!==-1}))})},addEmptyVideoLine:function(a){var b="string"==typeof a?i(a):a,c={media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]};return b.m.push(c),b},removeVideo:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){"video"===a.media&&(a.port=0,a.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a.a=a.a.filter(function(a){return"mid"===a.field}),a.a.push({field:"inactive"}))}),b},setVideoBandwidth:function(a,b,c){var d="string"==typeof a?i(a):a;return d.m&&d.m.forEach(function(a){"video"===a.media&&(c?b&&b.valueOf()>0?a.b=["AS:"+b]:l(a.b)&&delete a.b:l(a.b)||f(a,"b","AS:"+b))}),d},setXGoogle:function(a,b){var c="string"==typeof a?i(a):a;return c.m&&b&&c.m.forEach(function(a){if("video"===a.media&&a.a){var c,d=-1;if(a.a=a.a.filter(function(a,b){return"rtpmap"===a.field&&a.value.indexOf("VP8")!==-1&&(c=a.value.split(" ")[0],d=b),("fmtp"!==a.field||a.value&&a.value.indexOf("x-google")===-1)&&"x-google-buffer-latency"!==a.field}),d!==-1){var e=[];b.minBitRate&&b.minBitRate.valueOf()>0&&e.push("x-google-min-bitrate="+b.minBitRate),b.maxBitRate&&b.maxBitRate.valueOf()>0&&e.push("x-google-max-bitrate="+b.maxBitRate),b.startBitRate&&b.startBitRate.valueOf()>0&&e.push("x-google-start-bitrate="+b.startBitRate),b.maxQuantization&&b.maxQuantization.valueOf()>0&&e.push("x-google-max-quantization="+b.maxQuantization),e.length>0&&(e=c+" "+e.join("; "),a.a.splice(d+1,0,{field:"fmtp",value:e}))}}}),c},removeVideoBandwidth:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){"video"===a.media&&(a.b=a.b&&a.b.filter(function(a){return!a.startsWith("AS:")}))}),b},removeAudioLevelAttr:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){"audio"===a.media&&(a.a=a.a&&a.a.filter(function(a){return"extmap"!==a.field||!a.value||a.value.indexOf("ssrc-audio-level")===-1}))}),b},isTrickleIceOption:function(a){var b="string"==typeof a?i(a):a;b.a=b.a||[];var c=b.a.some(function(a){return"ice-options"===a.field&&(a.value=a.value||"",a.value.indexOf("trickle")!==-1)});return c},fixTrickleIceOption:function(a,b){var c="string"==typeof a?i(a):a;c.a=c.a||[];var d=c.a.some(function(a,d){if("ice-options"===a.field)return a.value=a.value||"",b?a.value.indexOf("trickle")===-1&&(a.value+=" trickle"):(a.value=a.value.replace(/trickle\s*/gi,"").trim(),a.value||c.a.splice(d,1)),!0});return b&&!d&&c.a.push({field:"ice-options",value:"trickle"}),c},addEndOfCandidatesLine:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){a.a=a.a||[];var b=a.a.some(function(a){return"end-of-candidates"===a.field});b||a.a.push({field:"end-of-candidates"})}),b},removeEndOfCandidatesLine:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a){a.a&&a.a.some(function(b,c){if("end-of-candidates"===b.field)return a.a.splice(c,1),!0})}),b},removeEmptyAttributeLines:function(a,b){var c="string"==typeof a?i(a):a;if(c.m){var d={};Array.isArray(b)?b.forEach(function(a){d[a]=!0}):d[b]=!0,c.m.forEach(function(a){a.a=a.a&&a.a.filter(function(a){return a.value||!d[a.field]})})}return c},validateIceCandidates:function(a,b,c){var d="string"==typeof a?i(a):a;return!d.m.some(function(a,d){if(!m(a,d,b,c))return!0})},isNoOfferSdp:function(a){return!!a&&""===a.sdp&&"nooffer"===a.type},iceTotalCandidatesCount:function(a){var b=0,c="string"==typeof a?i(a):a;return c.m.forEach(function(a){a.a.forEach(function(a){"candidate"===a.field&&b++})}),b},removeNotNeededSsrc:function(a){var b="string"==typeof a?i(a):a;return b.m.forEach(function(a){a.a.some(function(a){return"recvonly"===a.field})&&(a.a=a.a.filter(function(a){
return"ssrc"!==a.field}))}),b},removeAudioMediaProtocols:function(a,b){var c="string"==typeof a?i(a):a;return b&&b.length?(c.m.some(function(a){if("audio"===a.media&&a.proto){var c=a.proto.split("/");return c=c.filter(function(a){return b.indexOf(a)===-1}),a.proto=c.join("/"),!0}}),c):c},verifyFingerprintInMLines:function(a){var b="string"==typeof a?i(a):a;return b.m&&b.m.forEach(function(a,c){a.a.some(function(a){return"fingerprint"===a.field})||b.a.some(function(b){if("fingerprint"===b.field)return a.a.push(b),!0})||o.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",c)}),b},findMediaLineIndex:function(a,b){if(b){var c="string"==typeof a?i(a):a;return n(c,b)}},setMediaIdAttribute:function(a,b,c,d){var e="string"==typeof a?i(a):a,f=e.m[b];f&&(f.a.some(function(a){if("mid"===a.field)return d&&(a.value=c),!0})||f.a.push({field:"mid",value:c}))},getOrigin:function(a){if("string"==typeof a){var b=/(o=[^\r]+)\r\n/i.exec(a);return b&&b[1]||""}return g(a,"o")}}}();return a.IceCandidate=b,a.sdpParser=d,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){function b(a,b){if("function"==typeof a)try{a(b)}catch(a){c.error(a)}}function f(a,c){b(y.onStateChange,{newState:a,oldState:c})}function g(){b(y.onReconnectFailed)}function h(a){b(y.onMessage,a)}function i(){z&&(z.onopen=null,z.onclose=null,z.onmessage=null,z.onerror=null,z=null)}function j(a){if(a!==C){c.debug("[CONN]: Changed connection state from "+C+" to "+a),c.debug("[CONN]: Raising connectionStateChange event");var b=C;C=a,window.setTimeout(function(){f(a,b)},0)}}function k(a){try{A&&A(a)}catch(a){c.error("[CONN]: Exception on errorCallback. ",a)}finally{A=null,B=null}}function l(){try{c.debug("[CONN]: Registered Successfully"),B&&B()}catch(a){c.error("[CONN]: Exception on successCallback. ",a)}finally{A=null,B=null}}function m(a){if(F&&(window.clearTimeout(F),F=null),G&&(window.clearTimeout(G),G=null),z){c.debug("[CONN]: Disconnecting from server");var b=z;i(),b.close()}a||j(e.Disconnected)}function n(a){a===z&&(c.info("[CONN]: WebSocket is opened"),D=t+d.randomNumber(0,u),E=0,C!==e.Disconnected&&(j(e.Connected),l()),s>0&&(H=window.setInterval(function(){z&&z.send("PING")},s)))}function o(a){if(a===z)switch(c.info("[CONN]: WebSocket is closed"),H&&(window.clearInterval(H),H=null),C){case e.Connected:case e.Reconnecting:if(C===e.Reconnecting&&g(),j(e.Reconnecting),d.isMobile())return void c.warning("[CONN]: Mobile Client - Do not attempt to reconnect from JS");if(x>0&&E>=x)return c.warning("[CONN]: Reached max number of attempts reconnecting to WebSocket"),void m();c.info("[CONN]: Retry to open socket in "+Math.floor(D/1e3)+" seconds"),F=window.setTimeout(function(){F=null,r()},D),D=++E>v?2*D:u,D=Math.min(D,w);break;case e.Connecting:m(),c.error("[CONN]: Failed to open WebSocket connection"),k("Failed to open WebSocket connection")}}function p(a,b){if(a===z)try{if(!b.data||"PING"===b.data)return;var d=b.data;if(!I.doNotParseMessages)try{d=JSON.parse(d)}catch(a){return void c.error("[CONN]: Message discarded (Cannot Parse): ",b.data)}h(d)}catch(a){c.error(a)}}function q(a,b){a===z&&(C!==e.Reconnecting&&C!==e.Connected?(c.error("[CONN]: WebSocket Connection Error"),j(e.Disconnected),i(),k("Failed to open WebSocket connection")):"node"!==window.navigator.platform&&"iOS"!==window.navigator.platform&&"Android"!==window.navigator.platform||(c.error("[CONN]: WebSocket connection error. Force _socket.onclose. ",b),z.onclose()))}function r(){if(C===e.Connecting||C===e.Reconnecting){c.info("[CONN]: Opening WebSocket to ",K);try{switch(window.navigator.platform){case"iOS":z=WebSocket.createWebSocket(J);break;case"node":z=new WebSocket(J,I.cookie);break;default:z=new WebSocket(J)}}catch(a){return c.error("[CONN]: Failed to connect WebSocket. ",a),void k(a)}z.onopen=n.bind(null,z),z.onclose=o.bind(null,z),z.onmessage=p.bind(null,z),z.onerror=q.bind(null,z)}}a=a||{};var s,t,u,v,w,x;a.disablePing||d.isMobile()?(s=-1,t=0,u=0,w=0,x=0,v=0):(s=3e5,t=1e3,u=8e3,w=64e3,x=1350,v=3);var y=this,z=null,A=null,B=null,C=e.Disconnected,D=null,E=0,F=null,G=null,H=null,I=a||{},J=null,K=null;this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return C},this.isConnected=function(){return C===e.Connected},this.setTarget=function(a){J=a,K=J.split("?")[0]},this.connect=function(a,b,d){c.debug("[CONN]: Connect WebSocket to ",a),C!==e.Disconnected&&m(!0),y.setTarget(a),B=b||function(){},A=d||function(){},j(e.Connecting),window.setTimeout(r,0)},this.disconnect=function(){c.debug("[CONN]: Disconnect WebSocket from ",K),m()},this.reconnect=function(a){c.debug("[CONN]: Reconnect WebSocket to ",K),m(!0),a&&y.setTarget(a),j(e.Reconnecting),G=window.setTimeout(function(){G=null,r()},50)},this.sendMessage=function(a,b){return C!==e.Connected?(c.warn("[CONN]: WebSocket is not connected. Cannot send message. ",a),!1):a?(b||c.msgSend("[CONN]: ",a),"string"==typeof a?z.send(a):(delete a.keysToOmitFromLogging,z.send(JSON.stringify(a))),!0):(c.error("[CONN]: Data is missing. Cannot send message."),!1)},this.pingServer=function(){return C!==e.Connected?(c.error("[CONN]: WebSocket is not connected. Cannot ping server."),!1):(d.isMobile()?z.ping():z.send("PING"),!0)}}var c=a.logger,d=a.Utils,e=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected"});return a.ConnectionController=b,a.Enums=a.Enums||{},a.Enums.ConnectionState=e,a}(Circuit),Circuit=function(a){"use strict";var b=a.logger,c=a.TemasysAdapter,d=a.Utils.getBrowserInfo();try{var e=function(a){if(a)try{a.oninactive=null;var c=a.getAudioTracks().concat(a.getVideoTracks());c.length&&c[0].stop?c.forEach(function(a){a.stop()}):a.stop&&a.stop(),b.info("[WebRTCAdapter]: Media stream has been stopped")}catch(a){b.error("[WebRTCAdapter]: Failed to stop media stream. ",a)}},f=function(a){if(a)try{var c=a.getVideoTracks();c?c.forEach(function(a){a.stop&&"video"===a.kind&&!a.remote&&a.stop()}):b.info("[WebRTCAdapter]: No video tracks to be changed")}catch(a){b.error("[WebRTCAdapter]: Failed to disable local video tracks. ",a)}},g=function(a){try{a.close(),b.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(a){b.error(a)}},h=function(a,b){if(b){var c=[],d=[];a&&a.forEach(function(a){"audio"===a.kind?c.push(a):"video"===a.kind&&d.push(a)}),b(c,d,null)}},i=function(){return!!navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},j=function(a){if(a){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){var b=[{kind:"audio",id:"default",label:"",facing:""}],c=[{kind:"video",id:"default",label:"",facing:""}];return void window.setTimeout(function(){a(b,c,null)},0)}navigator.mediaDevices.enumerateDevices().then(function(b){var c=[],d=[],e=[];b&&b.forEach(function(a){var b={id:a.deviceId,groupId:a.groupId,kind:a.kind,label:a.label};switch(Circuit.isElectron&&("default"!==b.id||b.label||(b.label="res_DefaultDeviceLabel")),b.kind){case"audioinput":c.push(b);break;case"audiooutput":d.push(b);break;case"videoinput":e.push(b)}}),0!==d.length&&i()||(d=null),a(c,e,d)})}},k=function(a){if(!a||!a.iceServers)return a;var b=[];return a.iceServers.forEach(function(a){a.url?b.push(a):a.urls&&a.urls.forEach(function(c){b.push({url:c,credential:a.credential,username:a.username})})}),{iceServers:b}},l=function(a){a=a||{};var b={optional:[{googEchoCancellation:!0},{googEchoCancellation2:!0},{googAutoGainControl:!!a.enableAudioAGC},{googAutoGainControl2:!!a.enableAudioAGC},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0},{googDucking:!1},{chromeRenderToAssociatedSink:!0}]};return b},m=function(a){return a&&a.hdVideo?{mandatory:{minAspectRatio:1.76,maxAspectRatio:1.78,maxWidth:1920,minWidth:1280,maxHeight:1080,minHeight:720,minFrameRate:30},optional:[{googNoiseReduction:!0}]}:{mandatory:{minAspectRatio:1.32,maxAspectRatio:1.34},optional:[{googNoiseReduction:!0}]}},n=function(a,b){var c=a&&a.getAudioTracks();return!(!c||!c[0])&&(c[0].enabled=!!b,!0)},o=function(c,d,e){return e=e||function(){},c&&d?c.muted?(b.debug("[WebRTCAdapter]: Do not attach sinkId to muted element"),void e("Audio element muted")):void("undefined"!=typeof c.sinkId&&a.WebRTCAdapter?c.sinkId!==d?a.WebRTCAdapter.getMediaSources(function(a,f,g){var h=g&&g.some(function(a){return a.id===d});h?c.setSinkId(d).then(function(){b.debug("[WebRTCAdapter]: Success, audio output device attached: ",d),e()}).catch(function(a){var c=a.message;"SecurityError"===a.name&&(c="You need to use HTTPS for selecting audio output device."),b.error("[WebRTCAdapter]: Failed to attach output device. ",c),e(c)}):(b.warn("[WebRTCAdapter]: Could not find selected audio output device"),e("Specified device not found"))}):e():e("setSinkId not available")):void e("Invalid parameters")};if(d.chrome)return b.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},a.WebRTCAdapter={enabled:!0,browser:"chrome",MediaStream:webkitMediaStream,PeerConnection:webkitRTCPeerConnection,SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:navigator.webkitGetUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?void j(a):void MediaStreamTrack.getSources(function(b){b=b&&b.map(function(a){return{id:a.id,kind:a.kind,label:a.label,facing:a.facing}}),h(b,a)})},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&b.optional.push({sourceId:a.sourceId}),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:c.max||10},{minFrameRate:c.min||5}]}},audioOutputSelectionSupported:i(),attachSinkIdToAudioElement:o,toggleAudio:n},a;if(d.firefox){b.info("Setting WebRTC APIs for Firefox");var p=function(a){var b=[];return a.forEach(function(a){b.push(new q(a))}),b},q=function(a){switch(this.stats=a,this.id=a.id,a.type){case"inboundrtp":a.isRemote||(this.type="ssrc","audio"===a.mediaType?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=a.jitter):this.stats.googFrameHeightReceived=!0);break;case"outboundrtp":a.isRemote||(this.type="ssrc","audio"===a.mediaType?this.stats.audioInputLevel=!0:this.stats.googFrameHeightSent=!0);break;case"candidatepair":this.type="googCandidatePair","boolean"==typeof a.selected&&(this.googActiveConnection=a.selected?"true":"false");break;default:this.type=a.type}};q.prototype.names=function(){return Object.keys(this.stats)},q.prototype.stat=function(a){return this.stats[a]};var r="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,s="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,t="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;return a.WebRTCAdapter={enabled:!0,browser:"firefox",MediaStream:MediaStream,PeerConnection:function(a,b){var c=new r(a,b);return c.origCreateOffer=c.createOffer,c.createOffer=function(a,b,d){var e={offerToReceiveAudio:1,offerToReceiveVideo:1};return d&&(d.mandatory&&(d.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(e.offerToReceiveAudio=d.mandatory.OfferToReceiveAudio?1:0),d.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(e.offerToReceiveVideo=d.mandatory.OfferToReceiveVideo?1:0)),d.optional&&d.optional.some(function(a){if(a.hasOwnProperty("VoiceActivityDetection"))return e.voiceActivityDetection=!!a.VoiceActivityDetection,!0})),c.origCreateOffer(a,b,e)},c.origGetStats=c.getStats,c.getStats=function(a,b){"function"==typeof a&&c.origGetStats().then(function(b){a(p(b))},b)},c.removeStream=function(){},c.createDTMFSender=function(){},parseInt(d.version,10)>=46&&Object.defineProperty(c,"onaddstream",{enumerable:!0,get:function(){return c.onaddstreamCb},set:function(a){c.onaddstreamCb=a,a?c.ontrack=function(b){a({stream:b&&b.streams&&b.streams[0]})}:c.ontrack=null}.bind(c)}),c},SessionDescription:s,IceCandidate:t,getUserMedia:function(a,b,c){navigator.mediaDevices.getUserMedia(a).then(b).catch(c)},createObjectURL:function(a){return URL.createObjectURL(a)},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:function(a){window.setTimeout(function(){g(a)},500)},getMediaSources:function(a){a&&j(a)},getAudioOptions:function(a){var b=l(a);return a&&a.sourceId&&(b.deviceId=a.sourceId),b},getVideoOptions:function(a){var b=m(a);return a&&a.sourceId&&(b.deviceId=a.sourceId),b},getDesktopOptions:function(a,b){b=b||{};var c=b.frameRate||{};return c.min=c.min||5,c.max=c.max||10,{mozMediaSource:b.mediaSource||"screen",mediaSource:b.mediaSource||"screen",width:{max:2560},height:{max:1600},advanced:[{frameRate:c}]}},audioOutputSelectionSupported:i(),attachSinkIdToAudioElement:o,iceTimeoutSafetyFactor:.5,toggleAudio:n},a}if(d.ios){b.info("Setting WebRTC APIs for iOS client");var u=function(a){this.id=a.id,this.type=a.type,this.timestamp=new Date(a.timestamp);var b={};Object.getOwnPropertyNames(a.values).forEach(function(c){b[c]=a.values[c]}),this.names=function(){return Object.getOwnPropertyNames(b)},this.stat=function(a){return b[a]},a=null},v=function(a){var b=a.map(function(a){return new u(a)});this.result=function(){return b},a=null};return a.WebRTCAdapter={enabled:!0,browser:"ios",PeerConnection:function(a,b){a=k(a);var c=RTCPeerConnection.createRTCPeerConnection(a,b);return c.origGetStats=c.getStats,c.getStats=function(a){"function"==typeof a&&c.origGetStats(function(b){a(new v(b))})},c.addIceCandidate=c.addIceCandidateJS,Object.defineProperties(c,{localDescription:{get:function(){return c.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return c.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return c.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return c.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return c.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),c},SessionDescription:function(a){var b=RTCSessionDescription.createRTCSessionDescription(a);return b},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.streamId+" "+b.trackId:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.streamId+" "+b.trackId:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.trackId:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.trackId:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:l,getVideoOptions:m,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},audioOutputSelectionSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a}if(d.android){b.info("Setting WebRTC APIs for Android client");var w=function(a){this.id=a.id,this.type=a.type,this.timestamp=new Date(a.timestamp);var b={};Object.getOwnPropertyNames(a.values).forEach(function(c){var d=a.values[c];d.name&&(b[d.name]=d.value)}),this.names=function(){return Object.getOwnPropertyNames(b)},this.stat=function(a){return b[a]},a=null},x=function(a){var b=a.map(function(a){return new w(a)});this.result=function(){return b},a=null},y=RTCPeerConnection.bind(RTCPeerConnection);return a.WebRTCAdapter={enabled:!0,browser:"android",PeerConnection:function(a,b){a=k(a);var c=y(a,b);return c.getStats=function(a){"function"==typeof a&&c.origGetStats(function(b){a(new x(b.data))})},c},SessionDescription:function(a){return{type:a.type,sdp:a.sdp}},IceCandidate:function(a){return{sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid,candidate:a.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.id+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.id+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){a&&a([],[])},getAudioOptions:l,getVideoOptions:m,getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a}if(c)return b.info("Setting WebRTC APIs for IE with Temasys plugin"),a.WebRTCAdapter={enabled:!0,browser:"msie",PeerConnection:function(a,b){return a=k(a),c.PeerConnection(a,b)},SessionDescription:c.SessionDescription,IceCandidate:c.IceCandidate,getUserMedia:c.getUserMedia,createObjectURL:function(a,b,d){return c.createObjectURL(a,d)},attachMediaStream:c.attachMediaStream,getAudioStreamTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?a.label+" "+b.id:""},getVideoStreamTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?a.label+" "+b.id:""},getAudioTrackId:function(a){var b=a&&a.getAudioTracks()[0];return b?b.id:""},getVideoTrackId:function(a){var b=a&&a.getVideoTracks()[0];return b?b.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(a){var b=a&&a.getAudioTracks()[0];return b?b.label:""},getVideoTrackLabel:function(a){var b=a&&a.getVideoTracks()[0];return b?b.label:""},stopMediaStream:e,stopLocalVideoTrack:f,closePc:g,getMediaSources:function(a){c.getMediaSources(function(b){h(b,a)})},getAudioOptions:function(a){return!a||!a.sourceId||{optional:[{sourceId:a.sourceId}]}},getVideoOptions:function(a){return!a||!a.sourceId||{optional:[{sourceId:a.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:c.screensharingKey()}]}},audioOutputSelectionSupported:!1,attachSinkIdToAudioElement:o,toggleAudio:n},a;b.info("WebRTC is not supported")}catch(a){b.error("Failed to initialize WebRTCAdapter. ",a)}return a.WebRTCAdapter={enabled:!1,browser:"",PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(a,b,c){c&&c("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(a){a&&a([],[])},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,attachSinkIdToAudioElement:function(a,b,c){c&&c()},toggleAudio:function(){return!1}},a}(Circuit),Circuit=function(a){"use strict";function b(a,g,h){function i(){for(var a=0;a<K;a++)try{var b=new f.PeerConnection(H,I);L.push(b),k(b),c.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(a){c.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",a)}}function j(){J=new f.PeerConnection(H,I),k(J),c.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),e.isMobile()||i()}function k(a){a.onnegotiationneeded=n.bind(null,a),a.onicecandidate=o.bind(null,a),a.onsignalingstatechange=p.bind(null,a),a.onaddstream=q.bind(null,a),a.onremovestream=r.bind(null,a),a.oniceconnectionstatechange=s.bind(null,a)}function l(a){a.onnegotiationneeded=null,a.onicecandidate=null,a.onsignalingstatechange=null,a.onaddstream=null,a.onremovestream=null,a.oniceconnectionstatechange=null}function m(a){if(a===J)return!0;var b=L.some(function(b){if(a===b)return!0});return b}function n(a,b){return c.debug("[RTCPeerConnections]: onnegotiationneeded"),m(a)?void A(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function o(a,b){if(c.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState =",a.iceGatheringState),!m(a))return void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");if(b.candidate){if(a!==J){var d=L.indexOf(a);if(d>=0){var e=new f.IceCandidate({sdpMLineIndex:b.candidate.sdpMLineIndex+d+2,sdpMid:b.candidate.sdpMid,candidate:b.candidate.candidate});b={candidate:e}}}}else{if(N++,N<L.length+1)return;c.debug("[RTCPeerConnections]:  End of candidates - all peer connections"),N=0}B(b)}function p(a,b){return c.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState =",a.signalingState),m(a)?void C(b):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function q(a,b){return c.debug("[RTCPeerConnections]: onaddstream"),m(a)?(c.debug("[RTCPeerConnections]:  Added Remote Stream: ",b.stream),void D(b)):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function r(a,b){return c.debug("[RTCPeerConnections]: onremovestream"),m(a)?(c.warning("[RTCPeerConnections]:  Removed Remote Stream: ",b.stream),void E(b)):void c.debug("[RTCPeerConnections]:  Event is from Old Peer Connection")}function s(a,b){var d=K>0?" - "+(a===J?1:L.indexOf(a)+2):"",e=a.iceConnectionState;if(c.debug("[RTCPeerConnections]: oniceconnectionstatechange"+d+": iceConnectionState =",e),!m(a))return void c.debug("[RTCPeerConnections]: Event is from Old Peer Connection.");if(O!==e){if(K>0){var f;switch(e){case"connected":f=(J.iceConnectionState===e||"completed"===J.iceConnectionState)&&L.every(function(a){return a.iceConnectionState===e||"completed"===a.iceConnectionState});break;case"completed":case"closed":f=J.iceConnectionState===e&&L.every(function(a){return a.iceConnectionState===e});break;case"checking":f="new"===O;break;default:f=!0}if(!f)return}O=e,F(b)}}function t(a,c){b.maxVideoBandwidth>0&&d.setVideoBandwidth(a,b.maxVideoBandwidth,c)}function u(a){if(0===K)return J[a];var b=d.parse(J[a].sdp);1===b.m.length&&"audio"===b.m[0].media&&"remoteDescription"!==a&&d.addEmptyVideoLine(b),L.every(function(c){if(!c[a])return!1;var e=d.parse(c[a].sdp);e=d.verifyFingerprintInMLines(e);var f=e.m.some(function(a){if("video"===a.media)return b.m.push(a),!0});return!!f});var c=new f.SessionDescription({type:J[a].type,sdp:d.stringify(b)});return c}function v(){J.createdLocalSdp=void 0,L.forEach(function(a){a.createdLocalSdp=void 0})}function w(a,b){var c=d.parse(a.sdp);t(c,!0),K&&c.m.forEach(function(a){if("video"===a.media)for(var c=0,d=a.a.length;c<d;c++)if("mid"===a.a[c].field){a.a[c].value="video_"+(b-1);break}});var e=new f.SessionDescription({type:a.type,sdp:d.stringify(c)});return e}function x(a,b){var e=d.parse(a.sdp),g=d.hasVideo(e);if(!g)return a;var h=d.getConnectionMode(e,{mediaType:"video"});c.info("[RTCPeerConnections]: Local description has video with a="+h),"sendonly"!==h||b.video?t(e,!0):(e=d.setConnectionMode(e,"video","inactive"),c.warning("[RTCPeerConnections]:  Set video connection mode to inactive"));var i=new f.SessionDescription({type:a.type,sdp:d.stringify(e)});return i}function y(a){return"pranswer"===a.type&&(a.type="answer"),a}function z(a,b){if("function"==typeof a)try{a(b)}catch(a){c.error(a)}}function A(a){z(G.onnegotiationneeded,a)}function B(a){z(G.onicecandidate,a)}function C(a){z(G.onsignalingstatechange,a)}function D(a){z(G.onaddstream,a)}function E(a){z(G.onremovestream,a)}function F(a){z(G.oniceconnectionstatechange,a)}var G=this,H=a,I=g,J=null,K=h&&h.extraVideoChannels||0,L=[],M={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},N=0,O="new";this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(a,b,d){function e(d,e){if(g++,c.debug("[RTCPeerConnections]: createOffer, count: ",g),d.createdLocalSdp=w(e,g),g>=L.length+1){if(h)b(h);else{var f=u("createdLocalSdp");a(f)}v()}}function f(a){g++,h||(h=a),g>=L.length+1&&b(h)}var g=0,h=null;J.createOffer(e.bind(null,J),f,d),L.forEach(function(a){a.createOffer(e.bind(null,a),f,M)})},this.createAnswer=function(a,b,d,e){function f(d,f){if(h++,c.debug("[RTCPeerConnections]: createAnswer, count: ",h),d===J?d.createdLocalSdp=x(f,e):d.createdLocalSdp=x(f,{video:!1}),h>=L.length+1){if(i)b(i);else{var g=u("createdLocalSdp");a(g)}v()}}function g(a){h++,i||(i=a),h>=L.length+1&&b(i)}var h=0,i=null;J.createAnswer(f.bind(null,J),g),L.forEach(function(a){return a.remoteDescription?void a.createAnswer(f.bind(null,a),g,d):void h++})},this.setLocalDescription=function(a,b,e){function g(){i++,c.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",i),i>=L.length+1&&(j?e(j):b())}function h(a){i++,c.error("[RTCPeerConnections]: setLocalDescription error, count: "+i+"\n",a),j||(j=a),i>=L.length+1&&e(j)}var i=0,j=null,k=d.parse(a.sdp),l=k.m;if(k.m=l.slice(0,2),"answer"===a.type){var m=d.parse(J.remoteDescription.sdp);1===m.m.length&&(c.info("[RTCPeerConnections]: only 1 mline in remote sdp offer"),k.m=k.m.slice(0,1))}var n=new f.SessionDescription({type:a.type,sdp:d.stringify(k)});J.setLocalDescription(n,g,h),L.forEach(function(b,e){return l[e+2]?(k.m=[l[e+2]],n=new f.SessionDescription({type:a.type,sdp:d.stringify(k)}),void b.setLocalDescription(n,g,h)):(i++,void c.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i))})},this.setRemoteDescription=function(a,b,e){function g(){i++,c.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",i),i>=L.length+1&&(j?e(j):b())}function h(a){i++,j||(j=a),i>=L.length+1&&e(j)}var i=0,j=null,k=d.parse(a.sdp),l=k.m;k.m=l.slice(0,2);var m=new f.SessionDescription({type:a.type,sdp:d.stringify(k)});m=y(m),J.setRemoteDescription(m,g.bind(null,J),h),L.forEach(function(b,e){return l[e+2]?(k.m=[l[e+2]],m=new f.SessionDescription({type:a.type,sdp:d.stringify(k)}),m=y(m),void b.setRemoteDescription(m,g.bind(null,b),h)):(i++,void c.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i))})},this.removeStream=function(a){return J.removeStream(a)},this.addStream=function(a){return J.addStream(a)},this.getLocalStreams=function(){return J.getLocalStreams()},this.getRemoteStreams=function(){var a=J.getRemoteStreams().slice(0);return L.forEach(function(b){a.push.apply(a,b.getRemoteStreams())}),a},this.addIceCandidate=function(a){if(!a)return J.addIceCandidate(),void L.forEach(function(a){a.addIceCandidate()});if(a.sdpMLineIndex<=1)return void J.addIceCandidate(new f.IceCandidate(a));var b=a.sdpMLineIndex-2;L[b]&&(a.sdpMLineIndex=0,L[b].addIceCandidate(new f.IceCandidate(a)))},this.close=function(){J.close(),l(J),L.forEach(function(a){a.close(),l(a)})},this.createDTMFSender=function(a){return J.createDTMFSender(a)},Object.defineProperties(this,{localDescription:{get:function(){return u("localDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{remoteDescription:{get:function(){return u("remoteDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{signalingState:{get:function(){return J.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return K>0?O:J.iceConnectionState},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{mainPeerConnection:{get:function(){return J},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return L},enumerable:!0,configurable:!1}}),j()}var c=a.logger,d=a.sdpParser,e=a.Utils,f=a.WebRTCAdapter;return b.maxVideoBandwidth=512,a.RtcPeerConnections=b,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.Constants,c={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Answering:{name:"Answering",ui:"",established:!1,css:"answering"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},d={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},ToggleVideoInProgress:{name:"ToggleVideoInProgress",type:"video",icon:"progress-icon",localize:""},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},e={};return e.createFromUser=function(a,b){if(!a)return null;var d=Object.create(a);return d.pcState=b||c.Idle,d.streamId=null,d.screenStreamId=null,d.videoUrl="",d.mediaType={audio:!1,video:!1,desktop:!1},d.muted=!1,d.activeSpeaker=!1,d.isExternal=!!a.isExternal,d.isActive=e.isActive.bind(null,d),d.actions=[],d.screenSharePointerSupported=!1,
d.hasSameMediaType=e.hasSameMediaType.bind(null,d),d.hasVideoStream=e.hasVideoStream.bind(null,d),d.setActions=e.setActions.bind(null,d),d.toJSON=function(){return this},d.userId=a.userId,d.firstName=a.firstName,d.lastName=a.lastName,d},e.isActive=function(a){switch(a.pcState){case c.Active:case c.Joined:case c.Muted:case c.OnStage:return!0}return!1},e.hasSameMediaType=function(a,b){return!!(a&&b&&a.mediaType&&b.mediaType&&a.mediaType.audio===b.mediaType.audio&&a.mediaType.video===b.mediaType.video&&a.mediaType.desktop===b.mediaType.desktop)},e.hasVideoStream=function(a){return!(!a.videoUrl||!a.streamId&&!a.screenStreamId||!a.mediaType.video&&!a.mediaType.desktop)},e.setActions=function(a,c,e){if(a.actions=[],a.pcState.established)if(a.isMeetingPointInvitee)a.toggleVideoInProgress?a.actions.push(d.ToggleVideoInProgress):a.actions.push(a.mediaType.video?d.StopVideo:d.StartVideo),a.actions.push(a.muted?d.Unmute:d.Mute),a.actions.push(d.Drop);else{var f=!c||c.isModerated,g=c&&c.userIsModerator(e),h=c&&c.userIsModerator(a);a.muted||f&&h&&!g||a.actions.push(d.Mute),f&&!g||(c.type===b.ConversationType.LARGE&&a.isSessionGuest&&g?a.actions.push(d.RemoveFromStage):a.actions.push(d.Drop))}},a.RtcParticipant=e,a.Enums=a.Enums||{},a.Enums.ParticipantState=c,a.Enums.ParticipantAction=d,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a,b){function d(a){g=a.rtcSessionId,m=a.convId,n=a.type,o=a.topic||a.participantFirstNames,p=a.topicEscaped||a.participantFirstNamesEscaped,q=a.creatorId,s=a.type===c.ConversationType.DIRECT,t=a.type===c.ConversationType.LARGE,u=a.isTelephonyConv,v=a.testCall,s?f.peerUser=a.peerUser:delete f.peerUser,f.peerUsers=a.peerUsers,f.numConvParticipants=a.participants.length,f.avatar=a.avatar}if(!a)throw new Error("Cannot create BaseCall object without a conversation");b=!!b;var f=this,g=null,j=null,m=null,n=null,o=null,p=null,q=null,r=null,s=!1,t=!1,u=!1,v=!1,w=l.Idle;Object.defineProperties(this,{isRemote:{value:b,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return g},enumerable:!0,configurable:!1},instanceId:{get:function(){return j},enumerable:!0,configurable:!1},transactionId:{get:function(){return r},enumerable:!0,configurable:!1},state:{get:function(){return w},enumerable:!0,configurable:!1},convId:{get:function(){return m},enumerable:!0,configurable:!1},convType:{get:function(){return n},enumerable:!0,configurable:!1},convTitle:{get:function(){return o||s&&this.peerUser.displayName},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return p||s&&this.peerUser.displayNameEscaped},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some(function(a){return a.participantType===c.RTCParticipantType.SESSION_GUEST||a.participantType===c.RTCParticipantType.EXTERNAL})},enumerable:!1,configurable:!1},ownerId:{get:function(){return q},enumerable:!0,configurable:!1},isDirect:{get:function(){return s},enumerable:!0,configurable:!1},isLarge:{get:function(){return t},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!s},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==l.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==l.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==l.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return u},enumerable:!0,configurable:!1},isTestCall:{get:function(){return v},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.direction=k.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.savedRTPStats=null,this.participants=[],this.participantsHashTable={},this.participantCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.recording={state:c.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:c.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==c.RecordingInfoState.INITIAL},isActive:function(){return this.state===c.RecordingInfoState.STARTED||this.state===c.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===c.RecordingInfoState.START_PENDING}},this.setState=function(a,b){if(a&&a!==w){if(w===l.Terminated)return void e.error("[BaseCall]: The call has already been terminated. Cannot set state to ",a.name);e.debug("[BaseCall]: Changing call state from "+w.name+" to "+a.name),!this.establishedTime&&a.established&&(this.establishedTime=Date.now()),w=a,w!==l.Terminated||b||this.terminate()}},this.checkState=function(a){return Array.isArray(a)?a.some(function(a){return a===w}):a===w},this.updateCall=function(a){return!!a&&(d(a),!0)},this.setPeerUser=function(a,b,c){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||c&&c!==this.peerUser.userId||h.cleanPhoneNumber(a)!==h.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:c||"",firstName:null,lastName:null,displayName:b,phoneNumber:a},"object"==typeof i&&i.extend&&(this.peerUser=i.extend(this.peerUser)),o=b||a,p=h.textToHtmlEscaped(o))},this.setTransactionId=function(a){r=a||h.createTransactionId()},this.setInstanceId=function(a){j=a},this.setCallIdForTelephony=function(a){f.isTelephonyCall&&a&&a!==g&&(e.debug("[BaseCall]: Changing callId from "+g+" to "+a),g=a)},d(a),a=null}var c=a.Constants,d=a.Enums.CstaCallState,e=a.logger,f=a.Enums.ParticipantState,g=a.RtcParticipant,h=a.Utils,i=a.UserProfile,j=a.DefaultAvatars,k=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),l=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Missed:{name:"Missed",ui:"res_MissedCall",established:!1,css:"missed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}});return b.prototype.sameAs=function(a){return!!a&&this.callId===a.callId&&this.isRemote===a.isRemote},b.prototype.terminate=function(){e.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(l.Terminated,!0)},b.prototype.isEstablished=function(){return this.state.established},b.prototype.isPresent=function(){return this.state!==l.Idle&&this.state!==l.Terminated},b.prototype.isHeld=function(){return!1},b.prototype.hasRemoteMedia=function(){return!1},b.prototype.isCallingOut=function(){return this.state===l.Waiting&&this.participants.length>0},b.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop)},b.prototype.updateSecurityStatus=function(a){a!==!0&&a!==!1||(this.secureCall=a)},b.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([l.Active,l.Waiting])},b.prototype.hasRemoteVideo=function(){return!1},b.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},b.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},b.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},b.prototype.isMuted=function(){return!1},b.prototype.mute=function(){return e.warning("[BaseCall]: Mute is not implemented in base object"),!1},b.prototype.unmute=function(){return e.warning("[BaseCall]: Unmute is not implemented in base object"),!1},b.prototype.toggleMute=function(){return e.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},b.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===k.OUTGOING&&this.checkState([l.Declined,l.Busy,l.NotAnswered,l.Failed])},b.prototype.setPeerUsersAsParticipants=function(){if(this.direction===k.OUTGOING&&this.peerUsers){this.participants=this.peerUsers.map(function(a){return g.createFromUser(a,f.Initiated)});for(var a=0;a<this.participants.length;a++)this.participantsHashTable[this.participants[a].userId]=this.participants[a];e.debug("[BaseCall]: Initialized participants: ",this.participants)}},b.prototype.hasParticipant=function(a){return this.participants.some(function(b){return b.userId===a})},b.prototype.getParticipant=function(a){for(var b=0;b<this.participants.length;b++)if(this.participants[b].userId===a)return this.participants[b];return null},b.prototype.addParticipant=function(a,b,c){return a&&a.userId?(e.debug("[BaseCall]: Add participant with userId =",a.userId),this.hasParticipant(a.userId)?c?this.updateParticipant(a,b):(e.warning("[BaseCall]: addParticipant called with existing participant. userId =",a.userId),null):(b&&(a.pcState=b),this.participants.push(a),this.participantsHashTable[a.userId]=a,e.debug("[BaseCall]: Added participant to call: ",a.userId),a)):(e.warning("[BaseCall]: addParticipant called with invalid participant"),null)},b.prototype.updateParticipant=function(a,b){if(!a||!a.userId)return e.warning("[BaseCall]: updateParticipant called with invalid participant"),null;e.debug("[BaseCall]: Update participant with userId =",a.userId);var c=this.getParticipant(a.userId);return c?(c.pcState=b||a.pcState,c.streamId=a.streamId,c.screenStreamId=a.screenStreamId,c.muted=a.muted,c.mediaType=a.mediaType,c.screenSharePointerSupported=a.screenSharePointerSupported,e.debug("[BaseCall]: Updated participant data for ",c.userId),c):(e.warning("[BaseCall]: The given participant is not part of the call"),null)},b.prototype.removeParticipant=function(a){delete this.participantsHashTable[a];for(var b=0;b<this.participants.length;b++)if(this.participants[b].userId===a){var c=this.participants.splice(b,1)[0];return c.videoUrl="",c.mediaType={audio:!1,video:!1,desktop:!1},e.debug("[BaseCall]: Removed participant from call: ",c.userId),c}return null},b.prototype.setParticipantState=function(a,b){b&&this.participants.some(function(c){if(c.userId===a)return c.pcState=b,e.debug("[BaseCall]: Set participant state to "+b.name+", userId =",c.userId),!0})},b.prototype.hasOtherParticipants=function(){return this.isLarge?this.participantCount>1:this.participants.length>0},b.prototype.updateMediaType=function(){var a={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach(function(b){b.mediaType&&(b.mediaType.audio&&(a.audio=!0),b.mediaType.video&&(a.video=!0),b.mediaType.desktop&&(a.desktop=!0))}),e.debug("[BaseCall]: Updating call media type to ",a),this.mediaType=a},b.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},b.prototype.toString=function(){return JSON.stringify(this,null,3)},b.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},b.prototype.setCstaState=function(a){this.atcCallInfo&&(this.atcCallInfo.cstaState=a,this.avatar=this.isHolding()?j.TELEPHONY_HOLD:j.TELEPHONY,this.consultation=this.consultation&&!this.isHolding())},b.prototype.checkCstaState=function(a){if(!this.atcCallInfo)return!1;if(!Array.isArray(a))return a===this.atcCallInfo.cstaState;var b=this;return a.some(function(a){return a===b.atcCallInfo.cstaState})},b.prototype.isHolding=function(){return!!this.atcCallInfo&&this.checkCstaState([d.Holding,d.HoldOnHold,d.ConferenceHolding])},b.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},b.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},b.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},b.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},b.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},b.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},b.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},b.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},b.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},b.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},b.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},b.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},b.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},b.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},b.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},b.prototype.isDtmfAllowed=function(){return!1},b.prototype.getTransferCallFailedCause=function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},b.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},a.BaseCall=b,a.Enums=a.Enums||{},a.Enums.CallDirection=k,a.Enums.CallState=l,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var c=Circuit.logger;if(!a||!a.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");b.parent.constructor.call(this,a,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===d.ActiveRemote},enumerable:!0,configurable:!1}}),this.activeClient=null,a=null,c.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}var c=a.BaseCall,d=a.Enums.CallState,e=a.Proto,f=a.Utils;return f.inherit(b,c),b.prototype.setActiveClient=function(a){a&&(this.activeClient={clientId:a.clientId,clientDisplayName:a.clientDisplayName,mediaType:e.getMediaType(a.mediaTypes)},this.pullNotAllowed=a.pullCall===!1)},a.RemoteCall=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(c,e){function g(){s||(s=new q({isDirectCall:r.isDirect,isTelephonyCall:r.isTelephonyCall,isLargeConference:r.isLarge,isAtcPullCall:e.isAtcPullCall}),s.onMediaUpdate=l,s.onLocalVideoURL=m,s.onRemoteObjectURL=o,s.onScreenSharePointerStatus=n,r.isDirect||s.setExtraVideoChannelsForParticipants(r.numConvParticipants))}function k(){s&&(s.onMediaUpdate=null,s.onLocalVideoURL=null,s.onRemoteObjectURL=null,s.onScreenSharePointerStatus=null)}function l(){d.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",r.callId),r.activeMediaType=s.getActiveMediaType(),d.debug("[LocalCall]: Set active media type to ",r.activeMediaType),r.localMediaType=s.getMediaConstraints(),d.debug("[LocalCall]: Set local media type to ",r.localMediaType),r.updateMediaType(),r.updateCallState()}function m(a){d.debug("[LocalCall]: RtcSessionController - onLocalVideoURL: callId =",r.callId),r.localVideoUrl=a.url,d.debug("[LocalCall]: Set local video URL to",a.url||"<empty>")}function n(a){d.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",a),r.pointer={isSupported:a.isSupported,isEnabled:a.isEnabled}}function o(a){d.debug("[LocalCall]: RtcSessionController - onRemoteObjectURL: callId =",r.callId),r.remoteAudioUrl=a.audioUrl&&a.audioUrl.url||"",d.debug("[LocalCall]: Set remote audio URL to",r.remoteAudioUrl||"<empty>"),r.remoteVideoUrlStreams=a.videoUrl||[],d.debug("[LocalCall]: Set remote video URL streams to",a.videoUrl||"<empty>"),r.participants.forEach(function(a){r.setParticipantRemoteVideoURL(a)}),r.checkForActiveRemoteVideo()}function p(a){a&&a.curtainState&&(B&&(a.lastCurtainState=B.curtainState),B=a,B.curtainClosed=a.curtainState!==i.CurtainState.OPEN)}e=e||{};var q=a.RtcSessionController;if(!c||!c.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");b.parent.constructor.call(this,c,!1);var r=this,s=null,t=!1,u=null,v=!1,w=!1,x=!1,y=!1,z=!1,A=!1,B=null,C=null,D=null,E=null,F=!1,G=15e3,H=9;Object.defineProperties(this,{sessionCtrl:{get:function(){return s},enumerable:!0,configurable:!1},isVdi:{get:function(){return!!s.isRemoteController},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return s.isMuted()},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return w},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return x},enumerable:!0,configurable:!1},isMocked:{get:function(){return z},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return A},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&this.peerUsers.length>0&&this.peerUsers.length<=H)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return H},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return F||this.state===f.Ringing},set:function(a){F=a},enumerable:!0,configurable:!1},curtain:{get:function(){return B||{}},set:function(a){p(a)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return C},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return D},enumerable:!0,configurable:!1},videoDevice:{get:function(){return E},enumerable:!0,configurable:!1}}),this.localVideoUrl="",this.remoteAudioUrl="",this.remoteVideoUrlStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=G,this.pointer={isSupported:!1,isEnabled:!1},this.terminate=function(){t||(d.debug("[LocalCall]: Terminating call with callId =",this.callId),k(),s.terminate(),this.localVideoUrl="",this.remoteAudioUrl="",this.remoteVideoUrlStreams=[],b.prototype.terminate.call(this),this.stopRingingTimer(),t=!0)},this.setMockedCall=function(){d.debug("[LocalCall]: Setting call as mocked"),z=!0,s.setMockedCall();var a=0===s.getNumberOfExtraVideoChannels();if(a){var b;this.participants.forEach(function(a){a.streamId="",(a.mediaType.desktop||!b&&a.mediaType.video)&&(b=a)}),b&&(b.streamId="mock")}else this.participants.forEach(function(a){a.streamId=a.mediaType.video||a.mediaType.desktop?"mock":""});window.setTimeout(function(){this.state!==f.Terminated&&(d.debug("[LocalCall]: Initialize remote mocked streams"),o({audioUrl:"",videoUrl:[{streamId:"mock",url:"content/images/mock/trailer.mp4"}]}),s.onRemoteObjectURL=null)},100)},this.startRingingTimer=function(a){"function"==typeof a&&(d.info("[LocalCall]: Starting ringing timer for callId =",r.callId),u=window.setTimeout(function(){d.info("[LocalCall]: Ringing timeout for callId =",r.callId),u=null,a()},this.ringingTimeout))},this.stopRingingTimer=function(){u&&(d.info("[LocalCall]: Cancelling ringing timer for callId =",r.callId),window.clearTimeout(u),u=null)},this.hasRemoteVideo=function(){return v},this.checkForActiveRemoteVideo=function(){v=!w&&this.participants.some(function(a){return!!a.videoUrl}),d.debug("[LocalCall]: Set hasActiveRemoteVideo to ",v)},this.enableRemoteVideo=function(){w&&(w=!1,this.checkForActiveRemoteVideo(),this.sessionCtrl.enableRemoteVideo(),d.debug("[LocalCall]: Enabled remote video"))},this.disableRemoteVideo=function(){w||(w=!0,v=!1,this.participants.forEach(function(a){a.videoUrl="",r.isDirect&&(a.streamId="")}),this.sessionCtrl.disableRemoteVideo(),d.debug("[LocalCall]: Disabled remote video"))},this.enableRemoteAudio=function(){x&&(x=!1,d.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){x||(x=!0,d.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(a){A=!!a,d.debug("[LocalCall]: Set Circuit Meeting Point state to ",a)},this.setHasUnmutedParticipants=function(){y=this.participants.some(function(a){return!a.muted})},this.hasUnmutedParticipants=function(){return y},this.getUnmutedParticipantIds=function(){var a=[];return this.participants.forEach(function(b){b.muted||a.push(b.userId)}),a},this.getMediaNode=function(){return this.isTestCall?q.mediaNode:null},this.updateMediaDevices=function(){j.getMediaSources(function(a,b,c){if(h.isMobile())C=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),D=Audio.getRecordingDevice&&Audio.getRecordingDevice(),E=Audio.getVideoDevice&&Audio.getVideoDevice();else{var e=function(a,b){return b&&b.find(function(b){return b.id===a})},f=e(q.playbackDeviceId,c);C=f&&f.label,f=e(q.recordingDeviceId,a),D=f&&f.label,f=e(q.videoDeviceId,b),E=f&&f.label}d.debug("[LocalCall]: Updated media devices: recording="+D+" playback="+C+" video="+E+" callId="+r.callId)})},g(),c=null,r.updateMediaDevices(),d.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function c(a,b){if(!b.mediaType.video&&!b.mediaType.desktop)return void(b.streamId="");var c=0===a.sessionCtrl.getNumberOfExtraVideoChannels();if(c){var d;a.participants.some(function(a){if(a.streamId)return d=a,!0}),b.streamId=d&&d.userId!==b.userId?"":"mock"}else b.streamId="mock"}var d=a.logger,e=a.BaseCall,f=a.Enums.CallState,g=a.Enums.ParticipantState,h=a.Utils,i=a.Constants,j=a.WebRTCAdapter,k="SERVER_ENDED:",l=Object.freeze({SERVER_ENDED_PRFX:k}),m="CLIENT_ENDED:",n=Object.freeze({ANOTHER_CLIENT_ANSWERED:m+"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:m+"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:m+"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:m+"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:m+"CALLER_LEFT_CONFERENCE",CLIENT_ENDED_PRFX:m,ENDED_BY_ANOTHER_USER:m+"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:m+"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:m+"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:m+"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:m+"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:m+"SET_REMOTE_SDP_FAILED",USER_ENDED:m+"USER_ENDED"});return h.inherit(b,e),b.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioUrl&&!this.remoteVideoUrlStreams.length)},b.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop&&!this.remoteVideoDisabled},b.prototype.addParticipant=function(a){this.isMocked&&a&&a.mediaType&&c(this,a);var d=b.parent.addParticipant.apply(this,arguments);return d&&(this.setParticipantRemoteVideoURL(d),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),d},b.prototype.updateParticipant=function(a){this.isMocked&&a&&a.mediaType&&c(this,a);var d=b.parent.updateParticipant.apply(this,arguments);return d&&(this.setParticipantRemoteVideoURL(d),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),d},b.prototype.removeParticipant=function(){var a=b.parent.removeParticipant.apply(this,arguments);return a&&this.setHasUnmutedParticipants(),a},b.prototype.setParticipantRemoteVideoURL=function(a){if(a.videoUrl="",this.isDirect&&(a.streamId=""),!this.remoteVideoDisabled){if(a.mediaType&&!a.mediaType.video&&!a.mediaType.desktop)return void d.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video URL. userId = ",a.userId);if(this.isDirect){if(this.remoteVideoUrlStreams&&this.remoteVideoUrlStreams.length){var b=this.remoteVideoUrlStreams[this.remoteVideoUrlStreams.length-1];a.streamId=b.streamId,a.videoUrl=b.url,a.pcState=a.muted?g.Muted:g.Active}}else{if(!a.streamId&&!a.screenStreamId)return void d.info("[LocalCall]: The participant does not have a video streamId. userId = ",a.userId);this.remoteVideoUrlStreams&&this.remoteVideoUrlStreams.length&&this.remoteVideoUrlStreams.some(function(b){if(b.streamId===a.streamId||b.streamId===a.screenStreamId)return a.videoUrl=b.url,a.pcState=a.muted?g.Muted:g.Active,d.debug("[LocalCall]: Set remote video URL for participant: ",a),!0})}a.videoUrl||d.debug("[LocalCall]: We still do not have a video URL for the participant. ",a)}},b.prototype.hasLocalScreenShare=function(){return this.sessionCtrl.hasScreenShare()},b.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},b.prototype.mute=function(a){return this.checkState(f.Terminated)?(d.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(d.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl.mute(a))},b.prototype.unmute=function(a){return this.checkState(f.Terminated)?(d.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(d.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl.unmute(a))},b.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl.isLocalMuteAllowed()},b.prototype.toggleMute=function(){return this.sessionCtrl.isMuted()?this.unmute():this.mute()},b.prototype.setActiveSpeakers=function(a){if(!a)return!1;a instanceof Array||(a=[a]);var b=!1;return this.participants.forEach(function(c){var d=a.indexOf(c.userId)!==-1;c.activeSpeaker!==d&&(c.activeSpeaker=d,b=!0)}),b},b.prototype.updateCallState=function(){if(this.state.established){var a;a=this.sessionCtrl.isHolding()?f.Holding:this.sessionCtrl.isHeld()?f.Held:this.conferenceCall&&!this.hasOtherParticipants()?f.Waiting:f.Active,this.setState(a)}},b.prototype.isDtmfAllowed=function(){return!!this.checkState(f.Active)&&(!!this.sessionCtrl.canSendDTMFDigits()||!!this.atcCallInfo)},a.LocalCall=b,a.Enums.CallServerTerminatedReason=l,a.Enums.CallClientTerminatedReason=n,a}(Circuit||{}),Circuit=function(a){"use strict";var b=a.AppMessagingHandlerSingleton,c=a.ChromeExtension,d=a.Constants,e=a.logger,f=a.Utils,g=a.TemasysAdapter,h=function(){var h=b?b.getInstance():null,i={getScreen:function(a,b){b&&b("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}};if(f.isMobile())return i;var j,k=f.getBrowserInfo();if(a.isElectron)i.getScreen=function(a,b,c){var f=require("electron").ipcRenderer;f.once("screenshare-chooser",function(f,g,h){"share"===g?(e.info("[ScreenSharingController]: Got screen share stream. Stream id: ",h.streamId),c(a,b,h.streamId,null,h.pointer)):"cancel"===g&&(e.info("[ScreenSharingController]: User canceled screen share"),b&&b(d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))}),e.info("[ScreenSharingController]: Request screen in Electron"),f.send("screenshare-chooser","open")},i.isScreensharingAvailable=function(){return!0};else if(a.isVdiApp)i.getScreen=function(a,b,c){h.sendInternalMessage({method:"showwindow"}),window.setTimeout(function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,function(d){h.sendInternalMessage({method:"minimizewindow"}),c(a,b,d)})},0)},i.isScreensharingAvailable=function(){return!0};else if(k.chrome||k.phantomjs){var l,m,n,o=function(a,b,f){var g=f.data;switch(f.suppressLog||e.info("[ScreenSharingController]: Received screenshare event from extension - ",g.type),g.type){case c.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:e.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",g.streamId),q(m),j&&j(a,b,g.streamId);break;case c.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:e.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),q(m),b(d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}},p=function(a,b){if(l)return q(m),m=o.bind(null,a,b),l.addEventListener(c.BgTarget.SCREEN_SHARE,m),m},q=function(a){a&&a===m&&l&&m&&(l.removeEventListener(c.BgTarget.SCREEN_SHARE,m),m=null)};i.getScreen=function(a,b,c){var d=null;return n&&n.isExtensionRunning()?(j=c,d=p(a,b),l.getScreenShareUserMedia(function(a){a&&(e.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",a),q(d),b("res_AccessToExtensionFailed"))})):b("res_AccessToExtensionFailed"),d},i.isScreensharingAvailable=function(){return!!n&&n.isExtensionRunning()},i.installExtension=function(){n&&(e.debug("[ScreenSharingController]: Install Chrome extension"),n.installExtension(!0).then(function(){e.info("[ScreenSharingController]: Chrome extension was successfully installed")}).catch(function(a){e.warn("[ScreenSharingController]: Failed to install Chrome extension. ",a)}))},i.injectExtensionSvc=function(a,b){n=a,l=b},i.unregEvtHandlers=q}else if(k.msie){var r;i.getScreen=function(a,b,c){g&&g.isScreensharingAvailable()?c(a,b):b("NOT_AVAILABLE")},i.isScreensharingAvailable=function(){return!!g&&g.isScreensharingAvailable()},i.installExtension=function(){r&&r.showPopup()},i.injectTemasysSvc=function(a){r=a}}else if(k.firefox){var s=33;i.getScreen=function(a,b,c,d){c(a,b,null,d)},i.isScreensharingAvailable=function(){return parseInt(k.version,10)>=s}}return i}();return a.ScreenSharingController=h,a}(Circuit||{}),Circuit=function(a){"use strict";function b(n){function q(a,b){var c=b&&!Xa?ab:_a,d=c?c.getLocalStreams():[];d.indexOf(a)>=0&&(f.warning("[RtcSessionController]: Local "+(b?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),V(b))}function r(a,b,c){if(c&&c.mediaStream){var d=c.mediaStream;d.oninactive=q.bind(null,d,!0),ja(d,Ta),a()}else Pb=g.getScreen(a,b,u,c)}function s(a,b,c){f.debug("[RtcSessionController]: Get User Media for ",xb),xb.audio||xb.video?t(function(){xb.desktop&&!i.isMobile()?eb&&yb.desktop&&!gb?(ja(ib[Ta],Ta),a()):(r(a,function(a){b(a)},c),gb=!1):(ja(null,Ta),a())},b):xb.desktop?(ja(null,Ta),r(a,b,c)):window.setTimeout(a,0)}function t(a,c){var d=function(){var a=!fb||"msie"===j.browser||"firefox"===j.browser&&!xb.desktop&&yb.desktop;return eb&&a&&"android"!==j.browser&&xb.audio===yb.audio&&xb.video===yb.video&&xb.hdVideo===yb.hdVideo};f.debug("[RtcSessionController]: getUserMediaAudioVideo()");var e=null;try{var g={audio:!1,video:!1};xb.audio&&(g.audio=j.getAudioOptions({enableAudioAGC:b.enableAudioAGC,sourceId:b.recordingDeviceId,playbackDeviceId:b.playbackDeviceId})),xb.video?g.video=j.getVideoOptions({sourceId:b.videoDeviceId,hdVideo:xb.hdVideo}):xb.desktop&&i.isMobile()&&(g.video=j.getDesktopOptions()),f.info("[RtcSessionController]: Calling getUserMedia - constraints = ",g),d()?(ja(ib[Sa],Sa),a()):(e=window.setTimeout(function(){e=null,f.warning("[RtcSessionController]: Failed to access local media: device unresponsive"),c("res_MediaInputDevicesUnresponsive")},Oa),eb&&xb.video&&yb.video&&xb.hdVideo!==yb.hdVideo&&j.stopLocalVideoTrack(ib[Sa]),j.getUserMedia(g,function(b){if(f.info("[RtcSessionController]: User has granted access to local media"),
f.debug("[RtcSessionController]: Local MediaStream: ",b.id),!e)return f.info("[RtcSessionController]: GUM time out already fired"),void ga(b);if(window.clearTimeout(e),e=null,b.oninactive=q.bind(null,b,!1),xb.video&&!b.getVideoTracks().length){if(eb&&!yb.video)return void c("res_CameraAccessRestricted");xb.video=!1,f.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),R("res_AddVideoFailed"),f.info("[RtcSessionController]: New getUserMedia - constraints = ",xb)}ja(b,Sa),a()},function(a){var b=a&&a.name||"Unspecified";f.warning("[RtcSessionController]: Failed to access local media: ",b),e&&(window.clearTimeout(e),e=null);var d;d=b.indexOf("PermissionDeniedError")!==-1?xb.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":xb.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",c(d)}),f.debug("[RtcSessionController]: Requested access to Local Media"))}catch(a){f.error("[RtcSessionController]: Exception while handling getUserMedia: ",a),e&&(window.clearTimeout(e),e=null),c(xb.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}function u(a,c,e,g,h){f.debug("[RtcSessionController]: getUserMediaDesktop()");try{var k={audio:!1},l={mediaSource:g,frameRate:{min:b.sdpParameters.screenShare.minFrameRate,max:b.sdpParameters.screenShare.maxFrameRate}};k.video=j.getDesktopOptions(e,l),f.info("[RtcSessionController]: Calling getUserMedia - constraints = ",k),j.getUserMedia(k,function(b){f.info("[RtcSessionController]: User has granted access for screen capture"),f.debug("[RtcSessionController]: Desktop MediaStream: ",b),W(h),b.oninactive=q.bind(null,b,!0),ja(b,Ta),a()},function(a){var b=a&&a.name||"Unspecified";f.warning("[RtcSessionController]: Failed to access local media: ",b);var e=i.getBrowserInfo();c(e.msie&&"PermissionDeniedError"===b||e.firefox&&("SecurityError"===b||"NotAllowedError"===b)?d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED:"res_AccessToDesktopFailed")}),f.debug("[RtcSessionController]: Requested access for screen capture")}catch(a){f.error("[RtcSessionController]: Exception while handling getUserMedia: ",a),c("res_AccessToDesktopFailed")}}function v(){if(_a)return!0;var c={rtcpMuxPolicy:"negotiate"};cb.length&&!Lb?(c.iceServers=[{urls:cb,credential:db.password,username:db.username}],b.allowOnlyRelayCandidates&&("firefox"===j.browser?c.iceTransportPolicy="relay":c.iceTransports="relay")):c.iceServers=[],Lb=!1,f.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",c);var d={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googIPv6:!1},{googDscp:!0}]};f.debug("[RtcSessionController]: Creating peer connections. constraints:",d);var e={extraVideoChannels:Ib?0:Za};f.debug("[RtcSessionController]: Creating peer connections. options:",e);try{Jb=[],_a=new a.RtcPeerConnections(c,d,e),_a.startTime=Date.now(),f.debug("[RtcSessionController]: Created audio/video peer connections"),b.disableDesktopPc||i.isMobile()||Xa||(ab=new j.PeerConnection(c,d),f.debug("[RtcSessionController]: Created screenshare peer connection"))}catch(a){return _a=null,ab=null,f.error("[RtcSessionController]: Failed to create peer connections.",a),!1}return w(_a),w(ab),!0}function w(a){a&&(a.onicecandidate=y.bind(null,a),a.oniceconnectionstatechange=z.bind(null,a),a.onaddstream=A.bind(null,a),a.onremovestream=B.bind(null,a))}function x(a){a&&(a.onicecandidate=null,a.oniceconnectionstatechange=null,a.onaddstream=null,a.onremovestream=null)}function y(a,b){var c;if(b.candidate){if(f.debug("[RtcSessionController]: New ICE candidate: ",b.candidate),Y()){if(c=a.localDescription,!Y(c.type))return;var d={candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid,sdpMLineIndex:b.candidate.sdpMLineIndex};ca(d)&&(pb!==k.None&&pb!==k.OfferPending&&pb!==k.AnswerPending?ba(d):f.debug("[RtcSessionController]: Ignore ICE candidate in state ",pb))}}else if(f.debug("[RtcSessionController]: End of candidates. Audio/video PC:",a===_a),a.endOfCandidates=!0,_()){if(c=a.localDescription,!c)return void f.error("[RtcSessionController]: End of candidates, but cannot access pc.localDescription");Y(c.type)&&pb!==k.None&&pb!==k.OfferPending&&pb!==k.AnswerPending?F():G(c)}Bb&&Y()&&(pb===k.OfferPending||pb===k.AnswerPending)&&(c=a.localDescription,G(c))}function z(a){var b=a===_a?"audio/video":a===ab?"desktop":a===jb?"old a/v":"old desktop";if(f.debug("[RtcSessionController]: Connection state change ("+b+"): ",a.iceConnectionState),pb!==k.Connected||a!==_a&&a!==ab){if(!Xa&&pb===k.AnswerReceived)switch(a.iceConnectionState){case"connected":case"completed":a.connected=!0,$()&&(Cb&&(window.clearTimeout(Cb),Cb=null),ua(k.Connected));break;case"failed":Cb&&(window.clearTimeout(Cb),Cb=null),ta()}}else switch(a.iceConnectionState){case"failed":ua(k.Disconnected),Ob||(f.debug("[RtcSessionController]: RtcSessionController - Media disconnected: Waiting for signaling events"),Ob=window.setTimeout(function(){ta("res_CallMediaDisconnected")},o))}}function A(a,b){return f.debug("[RtcSessionController]: Added Remote Stream"),eb?void f.debug("[RtcSessionController]: Renegotiation is in progress. Ignore AddStream event."):(ma([b.stream]),void L())}function B(a,b){f.warning("[RtcSessionController]: Removed Remote Stream"),na(b.stream),L()}function C(a,b){f.debug("[RtcSessionController]: RTCDTMFSender - ontonechange: tone =",b.tone),M(b.tone)}function D(a,b){if("function"==typeof a)try{a(b||{})}catch(a){f.error(a)}}function E(a){if(a){var b=aa();f.debug("[RtcSessionController]: Send IceCandidate event"),D(Wa.onIceCandidate,{origin:b,candidates:a})}}function F(){var a=_a||ab,b=[];a.pendingCandidates&&(f.info("[RtcSessionController]: Send all pending candidates."),b=a.pendingCandidates,delete a.pendingCandidates),a.collectCandidatesTimeout&&(window.clearTimeout(a.collectCandidatesTimeout),delete a.collectCandidatesTimeout),a.queuedCandidates&&(f.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(b,a.queuedCandidates),delete a.queuedCandidates),a.relayRtpCandidateTimeout&&(window.clearTimeout(a.relayRtpCandidateTimeout),delete a.relayRtpCandidateTimeout),b.push({candidate:"a=end-of-candidates\r\n"}),E(b)}function G(a){Bb&&(window.clearTimeout(Bb),Bb=null),"offer"===a.type?pb===k.OfferPending&&H(k.OfferSent):pb===k.AnswerPending&&H(k.Connected)}function H(a){var b=Ma();"iOS"===window.navigator.platform&&b&&(f.debug("[RtcSessionController]: For iOS we need to convert the SDP to an actual JSON object"),b={type:b.type,parsedSdp:b.parsedSdp});var c=Y(b.type),d=b.parsedSdp;if(d=h.removeAudioLevelAttr(d),d=h.fixTrickleIceOption(d,c),c?_()&&(d=h.addEndOfCandidatesLine(d)):d=h.removeEndOfCandidatesLine(d),d=h.removeEmptyAttributeLines(d,["ice-ufrag","ice-pwd","ice-options"]),d=h.removeNotNeededSsrc(d),0===h.iceTotalCandidatesCount(d))if(c){var e=xa();f.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+e+" more milliseconds."),Bb=window.setTimeout(ta.bind(null,"res_RestartBrowser"),e)}else ta("res_RestartBrowser");else if(c&&!_()||h.validateIceCandidates(d)){var g={type:b.type,sdp:h.stringify(d)};ab&&(g.screen=Ua,_a&&$a[Sa]&&(g.video=La(Sa))),f.debug("[RtcSessionController]: send SessionDescription event"),D(Wa.onSessionDescription,{sdp:g}),ua(a)}else f.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),ta()}function I(){f.debug("[RtcSessionController]: send SdpConnected event"),D(Wa.onSdpConnected,{})}function J(){f.debug("[RtcSessionController]: send RemoteVideoAdded event"),D(Wa.onRemoteVideoAdded,{})}function K(){f.debug("[RtcSessionController]: send RemoteVideoRemoved event"),D(Wa.onRemoteVideoRemoved,{})}function L(){f.debug("[RtcSessionController]: send RemoteStreamUpdated event"),D(Wa.onRemoteStreamUpdated,{})}function M(a){f.debug("[RtcSessionController]: send DTMFToneChanged event"),D(Wa.onDTMFToneChange,{tone:a})}function N(){f.debug("[RtcSessionController]: send Closed event"),D(Wa.onClosed,{})}function O(a){f.debug("[RtcSessionController]: send Error event"),D(Wa.onRtcError,{error:a})}function P(a){"function"==typeof Wa.onRtcError&&window.setTimeout(function(){O(a)},0)}function Q(a){f.debug("[RtcSessionController]: send Warning event"),D(Wa.onRtcWarning,{warning:a})}function R(a){"function"==typeof Wa.onRtcWarning&&window.setTimeout(function(){Q(a)},0)}function S(){f.debug("[RtcSessionController]: send MediaUpdate event"),D(Wa.onMediaUpdate,{})}function T(){f.debug("[RtcSessionController]: send LocalVideoURL event"),D(Wa.onLocalVideoURL,{url:mb||lb}),S()}function U(){f.debug("[RtcSessionController]: send RemoteObjectURL event"),D(Wa.onRemoteObjectURL,{audioUrl:ob,videoUrl:nb})}function V(a){f.debug("[RtcSessionController]: send LocalStreamEnded event"),D(Wa.onLocalStreamEnded,{isDesktop:a})}function W(a){f.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),D(Wa.onScreenSharePointerStatus,{isSupported:!(!a||!a.isSupported),isEnabled:!(!a||!a.isEnabled)})}function X(a){return a?{audio:!!a.audio,video:!!a.video,hdVideo:!!a.hdVideo,desktop:!!a.desktop}:{audio:!0,video:!1,hdVideo:!1,desktop:!1}}function Y(a){return a?"offer"===a&&zb||"answer"===a&&Ab:zb||Ab}function Z(a,b){if(!Xa)return!0;var c=b&&h.isTrickleIceOption(b);return c&&f.debug("[RtcSessionController]: SDP "+a+" indicates support for Trickle-ICE."),!!c}function $(){return(!_a||_a.connected)&&(!ab||ab.connected)}function _(){return(!_a||_a.endOfCandidates)&&(!ab||ab.endOfCandidates)}function aa(){var a=_a||ab;return a?(a.sdpOrigin||(a.sdpOrigin=h.getOrigin(a.localDescription.sdp)),a.sdpOrigin):""}function ba(a){var b=_a||ab,c=new e;c.parse(a.candidate),"udp"===c.transport&&(b.pendingCandidates||(b.pendingCandidates=[],f.debug("[RtcSessionController]: Start timer to collect candidates before send."),b.collectCandidatesTimeout=window.setTimeout(function(){f.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete b.collectCandidatesTimeout,b.pendingCandidates&&(E(b.pendingCandidates),delete b.pendingCandidates)},m)),b.pendingCandidates.push(a))}function ca(a){var c=_a||ab;if(b.allowAllIceCandidatesScreenShare||a.sdpMid!==Ua||c.hasRelayRtpCandidate||c.sendAllCandidates)return!0;var d=new e;return d.parse(a.candidate),d.isTcpTlsRelay()?(d.isRtp()&&(f.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),c.hasRelayRtpCandidate=!0,delete c.queuedCandidates,c.relayRtpCandidateTimeout&&(window.clearTimeout(c.relayRtpCandidateTimeout),delete c.relayRtpCandidateTimeout)),!0):("udp"===d.transport&&(c.queuedCandidates||(c.queuedCandidates=[],f.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),c.relayRtpCandidateTimeout=window.setTimeout(function(){f.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete c.relayRtpCandidateTimeout,c.queuedCandidates&&(E(c.queuedCandidates),delete c.queuedCandidates),c.sendAllCandidates=!0},p)),c.queuedCandidates.push(a),f.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate")),!1)}function da(a){a&&(x(a),j.closePc(a))}function ea(){f.debug("[RtcSessionController]: Add local streams to existing peer connection");try{var a=_a?_a.getLocalStreams():[];a.isEmpty()&&($a[Sa]&&_a.addStream($a[Sa]),f.debug("[RtcSessionController]: Added local audio/video stream"),!ab&&$a[Ta]&&(_a.addStream($a[Ta]),f.debug("[RtcSessionController]: Added local screenshare stream"))),ab&&(a=ab.getLocalStreams(),a.isEmpty()&&$a[Ta]&&(ab.addStream($a[Ta]),f.debug("[RtcSessionController]: Added local screenshare stream")))}catch(a){return f.error("[RtcSessionController]: Failed to add Local Streams ",a),!1}return!0}function fa(){f.debug("[RtcSessionController]: Remove local streams from existing PeerConnection");try{var a=[_a,ab];a.forEach(function(a){if(a){var b=_a.getLocalStreams();b.length>0&&$a.forEach(function(a,b){a&&(_a.removeStream(a),f.debug("[RtcSessionController]: Removed PeerConnection Stream  #",b))})}})}catch(a){return f.error("[RtcSessionController]: Failed to remove Local Streams ",a),!1}return!0}function ga(a){a&&(a.oninactive=null,j.stopMediaStream(a))}function ha(a){var b=a===ib?$a:ib;a&&a.forEach(function(a){b&&b.indexOf(a)!==-1||ga(a)})}function ia(a){var b=["",""];a&&a.forEach(function(a,c){a&&a.getVideoTracks().length>0&&(b[c]=j.createObjectURL(a))}),lb===b[0]&&mb===b[1]||(lb=b[0],f.debug("[RtcSessionController]: Set local video URL to ",lb||"<empty>"),mb=b[1],f.debug("[RtcSessionController]: Set local desktop URL to ",mb||"<empty>"),T())}function ja(a,b){return b!==Sa&&b!==Ta?void f.error("[RtcSessionController]: setLocalStream invoked with invalid index:",b):void($a[b]!==a&&($a[b]&&ga($a[b]),$a[b]=a,ia($a)))}function ka(){(ob||nb.length)&&(ob=null,nb=[],U())}function la(a){var b=!1;if(!a)return!1;if(a.getVideoTracks().length>0){var c=j.createObjectURL(a,void 0,!0),d=j.getVideoStreamTrackId(a),e=nb.some(function(a){if(a.streamId===d)return a.url!==c&&(a.url=c,b=!0),!0});e||(nb.push({url:c,streamId:d}),b=!0),b&&f.debug("[RtcSessionController]: Updated Remote Video URLs:",nb)}if(a.getAudioTracks().length>0){var g=j.createObjectURL(a),h=j.getAudioStreamTrackId(a);ob&&ob.streamId===h?ob!==g&&(ob.url=g,b=!0):(ob={url:g,streamId:h},b=!0),b&&f.debug("[RtcSessionController]: Updated Remote Audio URL:",ob)}return b}function ma(a,b){if(a){a instanceof Array||(a=[a]);var c=!1;b&&(ob||nb.length)&&(c=!0,ob=null,nb=[]),a.forEach(function(a){Jb.push(a),la(a)&&(c=!0)}),c&&U()}}function na(a){if(a){var b=!1,c=j.getVideoStreamTrackId(a);c&&nb.some(function(a,d){if(a.streamId===c)return nb.splice(d,1),b=!0,!0});var d=j.getAudioStreamTrackId(a);ob&&ob.streamId===d&&(ob=null,b=!0),b&&U()}}function oa(a){var b=!1;$a[Sa]&&(b=j.toggleAudio($a[Sa],a)),wb=!b||!a,ib&&ib[Sa]&&j.toggleAudio(ib[Sa],a)}function pa(a,b){eb=!0,fb=!!a,hb=b||null,jb=_a,kb=ab,x(jb),x(kb),_a=null,ab=null,ib=$a,$a=[null,null],yb=i.shallowCopy(xb),rb=i.shallowCopy(qb),pb=k.None,Mb=null,Nb=null}function qa(a,b){if(hb){try{hb(a,b)}catch(a){f.error(a)}hb=null}}function ra(){f.info("[RtcSessionController]: The media renegotiation was successful"),f.info("[RtcSessionController]: Closing the old RTCPeerConnection"),da(jb),da(kb),jb=null,kb=null,f.info("[RtcSessionController]: Stopping the old MediaStream"),Hb||ea(),ha(ib),ib=null,yb=null,rb=null,f.debug("[RtcSessionController]: Local main PC Streams after Renegotiation: ",_a.getLocalStreams()),f.debug("[RtcSessionController]: Remote main PC Streams after Renegotiation: ",_a.getRemoteStreams()),ab&&(f.debug("[RtcSessionController]: Local screenshare PC Streams after Renegotiation: ",ab.getLocalStreams()),f.debug("[RtcSessionController]: Remote screenshare PC Streams after Renegotiation: ",ab.getRemoteStreams())),ia($a);var a=_a.getRemoteStreams();ab&&(a=a.concat(ab.getRemoteStreams())),ma(a,!0),oa(!wb),ub?tb=!0:vb&&(tb=!1),ub=!1,vb=!1,eb=!1,Db=null,S(),qa(!0)}function sa(a){f.info("[RtcSessionController]: The media renegotiation has failed: ",a),da(_a),da(ab),_a=jb,ab=kb,w(jb),w(kb),jb=null,kb=null,ha($a),$a=ib,ib=null,ia($a),xb=i.shallowCopy(yb),qb=i.shallowCopy(rb),yb=null,rb=null,ub?tb=!1:vb&&(tb=!0),ub=!1,vb=!1,eb=!1,S(),qa(!1,a)}function ta(a,b){return eb?void sa(a):(a===d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?f.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===a?f.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(a=a||"res_RTCError",f.warning("[RtcSessionController]: There was an internal failure. Send error event: ",a)),void(b?b(a):O(a)))}function ua(a){pb!==a&&(f.debug("[RtcSessionController]: Changed SDP status from "+pb+" to "+a),pb=a,_a&&a===k.Connected&&(eb&&ra(),I(),Mb?(f.info("[RtcSessionController]: Process the pending remote description"),Ca(Mb),Mb=null):Nb&&(f.info("[RtcSessionController]: Process the pending changeMedia"),Ea(Nb.mediaType,Nb.cb,Nb.screenConstraint),Nb=null)))}function va(a,c){f.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",xb);var d=!1,e=h.parse(c.sdp);h.disableMultiplex(e),Ya&&h.removeAudioMediaProtocols(e,["UDP","TLS"]),tb?(h.setConnectionMode(e,"both","inactive"),f.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):xb.video||xb.desktop?d=h.hasVideo(e):"answer"===c.type&&(d=h.hasVideo(e),d&&Ib&&(h.removeVideo(e),d=!1)),a===ab?(h.setMediaIdAttribute(e,0,Ua,!0),h.setXGoogle(e,b.xGoogle.screenShare)):d&&h.setXGoogle(e,xb.desktop&&!ab?b.xGoogle.screenShare:b.xGoogle.video),"answer"!==c.type&&(qb={audio:!0,video:d});var g=new j.SessionDescription({type:c.type,sdp:h.stringify(e)});return f.debug("[RtcSessionController]: Modified local SDP: ",g),g}function wa(a,c,d){f.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",xb);var e=!1,g=h.hasVideo(c);if(g){var i=h.getVideoConnectionModes(c);f.info("[RtcSessionController]: Remote description has video modes set to ",i),e=i.every(function(a){return"recvonly"===a}),g=!e;var j=b.sdpParameters.video.maxBw,l=b.xGoogle.video;a===_a?xb.desktop&&!ab&&(j=b.sdpParameters.screenShare.maxBw,l=b.xGoogle.screenShare):(j=b.sdpParameters.screenShare.maxBw,l=b.xGoogle.screenShare),c=h.setVideoBandwidth(c,j,!0),h.setXGoogle(c,l)}var m=sb;return sb=!!h.isHold(c)&&("offer"===d||!tb&&xb.audio),m!==sb&&(sb?f.info("[RtcSessionController]: The client has been held"):f.info("[RtcSessionController]: The client has been retrieved")),"offer"!==d||pb!==k.Connected||tb||sb||(nb.length&&!g?K():!nb.length&&g&&J()),tb||"answer"===d&&e||(qb={audio:!0,video:g}),c}function xa(){var a=b.candidatesTimeout||l;return Za>0&&(a+=a*(j.iceTimeoutSafetyFactor||0)),a}function ya(a){if(a&&Xa)return xa();var c=b.trickleIceTimeout||m;return c}function za(a,b){f.debug("[RtcSessionController]: Successfully created local audio/video description:",a),b&&f.debug("[RtcSessionController]: Successfully created local screenshare description:",b),eb&&fa(),Bb&&(window.clearTimeout(Bb),Bb=null);var c,d=a&&a.type||b&&b.type,e=2,g=!1,h=function(a,b){e--,b?(f.error("[RtcSessionController]: Failed to apply Local "+a+" description:",b.message||b),g||(g=!0,ta())):f.debug("[RtcSessionController]: Local description was successfully applied. PC=",a),!g&&e<=0&&(eb||S(),"offer"===d?(ua(k.OfferPending),zb&&(c=ya(!0),c>0?(f.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Offer."),window.setTimeout(function(){f.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Offer."),pb===k.OfferPending&&H(k.OfferSent)},c)):(f.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Offer."),H(k.OfferSent)))):(ua(k.AnswerPending),Ab&&(c=ya(!1),c>0?(f.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Answer."),window.setTimeout(function(){f.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Answer."),pb===k.AnswerPending&&H(k.Connected)},c)):(f.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Answer."),H(k.Connected)))),(pb===k.OfferPending&&!zb||pb===k.AnswerPending&&!Ab)&&(c=xa(),Bb=window.setTimeout(function(){return Bb=null,f.warning("[RtcSessionController]: Timed out waiting for candidates. Send session description."),_a?void("offer"===d?pb===k.OfferPending&&H(k.OfferSent):pb===k.AnswerPending&&H(k.Connected)):void f.warning("[RtcSessionController]: RTCPeerConnection instance no longer exists.")},c)))};try{if(_a&&a){var i=h.bind(null,"audio/video");a=va(_a,a),_a.setLocalDescription(a,i,i)}else e--;if(ab&&b){var j=h.bind(null,"screenshare");b=va(ab,b),ab.setLocalDescription(b,j,j)}else e--}catch(a){h("unknown",a||"error")}}function Aa(a){(tb||sb)&&a&&(fa(),Hb=!0,f.debug("[RtcSessionController]: Removed Local Stream"))}function Ba(a){return(!Ib||!(!a||!a.video))&&(i.isMobile()||!Kb)}function Ca(a){f.debug("[RtcSessionController]: setRemoteDescription()");try{if(!v())return void ta();var c,d=_a.getLocalStreams(),e=h.parse(a.sdp);if(a.screen){var g=h.findMediaLineIndex(e,a.screen);g!==-1&&(c=e.m[g],e.m.splice(g,1))}switch(a.type){case"offer":Ab=Z(a.type,e)&&!b.disableTrickleIce,Ab&&f.info("[RtcSessionController]: Enabled Trickle-ICE for answer.");break;case"pranswer":ua(k.PrAnswerReceived),zb=Z(a.type,e),zb||f.info("[RtcSessionController]: Disabled Trickle-ICE for offer.");break;case"answer":ua(k.AnswerReceived),zb=Z(a.type,e),zb||f.info("[RtcSessionController]: Disabled Trickle-ICE for offer.")}var i=2,l=!1,m=function(b,e){if(i--,e?(f.error("[RtcSessionController]: Failed to apply Remote "+b+" description:",e.message||e),l||(l=!0,ta())):f.debug("[RtcSessionController]: Remote description was successfully applied. PC=",b),!l&&i<=0)switch(f.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),eb||S(),a.type){case"offer":tb||sb?d.length>0?(fa(),Hb=!0,f.debug("[RtcSessionController]: Removed Local Stream (hold)")):f.debug("[RtcSessionController]: Local Stream has not been set (hold)"):(Hb=!1,ea()),f.debug("[RtcSessionController]: Creating Local Description Answer...");var g={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ba()}},h={audio:xb.audio,video:xb.video||xb.desktop};_a.createAnswer(function(a){if(ab&&c){var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!Ib}};ab.createAnswer(function(b){za(a,b)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),ta()},b)}else za(a)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create Local Description: ",a.message||a),ta()},g,h);break;case"pranswer":f.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),Aa(d.length>0);break;case"answer":Aa(d.length>0),Xa||$()?ua(k.Connected):Cb=window.setTimeout(function(){Cb=null,pb!==k.AnswerReceived||$()||(f.warning("[RtcSessionController]: Timed out waiting for connected state."),ta())},Pa);break;default:f.error("[RtcSessionController]: Invalid SDP Type = ",a.type),ta()}};if(_a){Xa&&!ab&&c&&(bb=e.m[Va.video],bb.port=0,h.setConnectionMode({m:[bb]},"video","inactive"),e.m[Va.video]=c,f.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")),e=wa(_a,e,a.type);var n=new j.SessionDescription({type:a.type,sdp:h.stringify(e)});f.debug("[RtcSessionController]: Modified remote audio/video SDP:",n);var o=m.bind(null,"audio/video");_a.setRemoteDescription(n,o,o),_a.remoteOrigin=h.getOrigin(e).trim()}else i--;if(ab&&c){e.m=[c],e=wa(ab,e,a.type);var p=new j.SessionDescription({type:a.type,sdp:h.stringify(e)});f.debug("[RtcSessionController]: Modified remote screenshare SDP:",p);var q=m.bind(null,"screenshare");ab.setRemoteDescription(p,q,q),ab.remoteOrigin=h.getOrigin(e).trim()}else da(ab),ab=null,i--}catch(a){f.error(a),ta()}}function Da(){if(f.debug("[RtcSessionController]: renegotiateMedia()"),!v())return void ta();tb?f.debug("[RtcSessionController]: Local Stream has not been set (holding)"):ea(),f.debug("[RtcSessionController]: Creating Local Descriptions...");var a={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ba(xb)}};try{_a.createOffer(function(b){!ab||Ib&&!xb.desktop?(ab&&(da(ab),ab=null),za(b)):(a.mandatory.OfferToReceiveVideo=!0,a.mandatory.OfferToReceiveAudio=!1,ab.createOffer(function(a){za(b,a)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),ta()},a))},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create audio/video Local Description: ",a.message||a),ta()},a)}catch(a){f.error(a),ta()}}function Ea(a,b,c){return pb===k.AnswerReceived?(f.warning("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),Nb={mediaType:a,cb:b,screenConstraint:c},!0):!!Ia()&&(pa(!0,b),"boolean"==typeof a.audio&&(xb.audio=a.audio),"boolean"==typeof a.video&&(xb.video=a.video),"boolean"==typeof a.hdVideo&&(xb.hdVideo=a.hdVideo),"boolean"==typeof a.desktop&&(xb.desktop=a.desktop),s(Da,ta,c),!0)}function Fa(){f.debug("[RtcSessionController]: Closing the RTC session controller"),ua(k.None),qb={audio:!1,video:!1},Pb&&g.unregEvtHandlers(Pb),Bb&&(window.clearTimeout(Bb),Bb=null),Cb&&(window.clearTimeout(Cb),Cb=null),Ob&&(window.clearTimeout(Ob),Ob=null),jb&&(f.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),da(jb),jb=null),kb&&(f.debug("[RtcSessionController]: Closing the old screenshare RTCPeerConnection"),da(kb),kb=null),_a&&(f.debug("[RtcSessionController]: Closing the RTCPeerConnection"),da(_a),_a=null),ab&&(f.debug("[RtcSessionController]: Closing the Desktop peer connection"),da(ab),ab=null),ib&&(f.debug("[RtcSessionController]: Stopping the old MediaStream"),ha(ib),ib=null),eb=!1,ub=!1,vb=!1,tb=!1,sb=!1,wb=!1,Db=null,ja(null,Sa),ja(null,Ta),ka(),N()}function Ga(){if(!_a)return f.error("[RtcSessionController]: PeerConnection not setup"),!1;if(Db)return f.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var a=_a.getLocalStreams();if(!(a.length>0))return f.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var b=a[Sa].getAudioTracks();return b.length>0?!!(Db=_a.createDTMFSender(b[0]))&&(Db.ontonechange=C.bind(null,_a),f.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+b[0].label),!0):(f.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function Ha(a){if(f.debug("[RtcSessionController]: startConn()"),a)Ca(a);else{ea(),f.debug("[RtcSessionController]: Creating Local Description...");var b={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Ba(xb)}};_a.createOffer(function(a){if(!ab||Ib&&!xb.desktop)za(a);else{var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}};ab.createOffer(function(b){za(a,b)},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create screenshare Local Description: ",a.message||a),ta()},b)}},function(a){a=a||"Unspecified",f.error("[RtcSessionController]: Failed to create Local Description: ",a.message||a),ta()},b)}}function Ia(){return _a?pb===k.AnswerReceived?(f.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):eb?(f.warning("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==_a.signalingState&&(f.warning("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",_a.signalingState),!Gb)):(f.debug("[RtcSessionController]: isConnStable: There is no connection"),!1)}function Ja(a,b){"function"==typeof a&&window.setTimeout(function(){a(b)},0)}function Ka(a){return i.isMobile()?(f.debug("[RtcSessionController]: Number of extra video channels for mobile clients is 0 (zero)"),!1):Kb?(f.debug("[RtcSessionController]: Number of extra video channels for large conference is 0 (zero)"),!1):Za!==a&&(f.info("[RtcSessionController]: Set number of extra video channels to",a),Za=a,!0)}function La(a){var b,c=$a[a];if(c){var d=c.id+" ",e=c.getVideoTracks()[0];e&&(d+=e.id,b=d)}return b}function Ma(){var a,c;if(_a){var d=_a.localDescription;c=d.type,a=h.parse(d.sdp),!ab&&bb&&(a.m.splice(Va.video,0,bb),bb=null)}if(ab){var e=ab.localDescription.sdp;if(e){c||(c=ab.localDescription.type),e=h.parse(e),e=h.verifyFingerprintInMLines(e);var g=!Xa&&!b.allowAllIceCandidatesScreenShare;f.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",g);var i=Y(c)&&!ab.endOfCandidates;h.validateIceCandidates(e,g,i),a?a.m=a.m.concat(e.m):a=e}}return{type:c,parsedSdp:a}}function Na(a,b,d,e){var g=new c(function(c){i.getRTPStatsForClientDiagnostics(d,a,b,e,function(a,d){a&&f.warning("[RtcSessionController]: getStats error["+b+"]=",a),c(d)})});return g}n=n||{};var Oa=12e4,Pa=15e3,Qa=2,Ra=2,Sa=0,Ta=1,Ua="video_screen_main",Va={audio:0,video:1,screen:2},Wa=this,Xa=!!n.isDirectCall,Ya=!!n.isTelephonyCall,Za=0,$a=[null,null],_a=null,ab=null,bb=null,cb=[],db={},eb=!1,fb=!1,gb=!1,hb=null,ib=null,jb=null,kb=null,lb=null,mb=null,nb=[],ob=null,pb=k.None,qb={audio:!1,video:!1},rb=null,sb=!1,tb=!1,ub=!1,vb=!1,wb=!!n.isLargeConference,xb={audio:!0,video:!1,hdVideo:!1,desktop:!1},yb=null,zb=!1,Ab=!1,Bb=null,Cb=null,Db=null,Eb=!1,Fb=null,Gb=!1,Hb=!1,Ib=!1,Jb=[],Kb=!!n.isLargeConference,Lb=!!n.isAtcPullCall,Mb=null,Nb=null,Ob=null,Pb=null;this.onIceCandidate=null,this.onSessionDescription=null,this.onSdpConnected=null,this.onRemoteVideoAdded=null,this.onRemoteVideoRemoved=null,this.onRemoteStreamUpdated=null,this.onDTMFToneChange=null,this.onClosed=null,this.onRtcError=null,this.onRtcWarning=null,this.onLocalStreamEnded=null,this.onScreenSharePointerStatus=null,this.onMediaUpdate=null,this.onLocalVideoURL=null,this.onRemoteObjectURL=null,this.setTurnCredentials=function(a){db=a||{}},this.setTurnUris=function(a){a&&a.length&&(cb=a)},this.setTrickleIceForAnswer=function(a){Ab=!!a},this.setTrickleIceForOffer=function(a){zb=!!a},this.getTrickleIceForAnswer=function(){return Ab},this.getTrickleIceForOffer=function(){return zb},this.getLocalVideoUrl=function(){return mb||lb},this.getLocalDesktopUrl=function(){return mb},this.getRemoteAudioUrl=function(){return ob},this.getRemoteVideoUrls=function(){return nb},this.getSdpStatus=function(){return pb},this.getWarmedUpSdp=function(){return Fb},this.isHolding=function(){return tb&&!ub||vb},this.isHoldInProgress=function(){return ub},this.isRetrieveInProgress=function(){return vb},this.isHeld=function(){return sb},this.getActiveMediaType=function(){return i.shallowCopy(qb)},this.getMediaConstraints=function(){return i.shallowCopy(xb)},this.getLocalMediaType=function(){return{audio:xb.audio&&qb.audio,video:xb.video&&qb.video,desktop:xb.desktop&&qb.video}},this.hasScreenShare=function(){return!!mb},this.warmup=function(a,b,c,d,e){return h.isNoOfferSdp(b)&&(b=null),a=X(a),c=c||function(){},d=d||function(){},f.info("[RtcSessionController]: Warming up the connection - mediaType = ",a),j.enabled?pb!==k.None?(f.error("[RtcSessionController]: The connection has already been started"),void Ja(d,"res_UnexpectedError")):(xb=a,xb.audio||(wb=!0),void s(function(){b&&(Fb=b),Eb=!0,c()},function(a){ta(a,d)},e)):(f.warning("[RtcSessionController]: WebRTC not supported by browser"),void Ja(d,"res_NoWebRTC"))},this.start=function(a,b){if(a=X(a),f.info("[RtcSessionController]: Start Connection - mediaType =",a),!j.enabled)return f.warning("[RtcSessionController]: WebRTC not supported by browser"),P("res_NoWebRTC"),!1;if(pb!==k.None)return f.error("[RtcSessionController]: The connection has already been started"),P("res_UnexpectedError"),!1;if(f.debug("[RtcSessionController]: Creating Peer Connection..."),Eb){if(b=Fb,Fb=null,wb=!a.audio||Kb,!v())return P("res_RTCError"),!1;if(a.audio===xb.audio&&a.video===xb.video&&a.hdVideo===xb.hdVideo&&a.desktop===xb.desktop)return Ha(b),!0}return v()?(xb=a,s(function(){Ha(b)},ta),!0):(P("res_RTCError"),!1)},this.addIceCandidates=function(a,b){f.info("[RtcSessionController]: Add remote ICE candidates");var c=_a||ab;if(c){var d=c.remoteOrigin;a&&a!==d?(f.warning("[RtcSessionController]: Ignoring remote ICE candidate - origin does not match."),f.debug("[RtcSessionController]: ICE candidate origin: ",a),f.debug("[RtcSessionController]: SDP origin: ",d)):b.forEach(function(a){a=JSON.parse(a),a.candidate&&(a.candidate=a.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),f.debug("[RtcSessionController]: Remote ICE candidate",a),a.candidate&&"end-of-candidates"!==a.candidate?_a.addIceCandidate(a):f.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")})}else f.warning("[RtcSessionController]: Ignoring remote ICE candidate - no peer connection found.");
},this.setRemoteDescription=function(a,b){if(f.info("[RtcSessionController]: Set Remote Description - type: ",a.type),Fb=null,pb===k.AnswerReceived)return f.info("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),Mb=a,!0;if(pb===k.PrAnswerReceived)return"answer"===a.type&&ua(k.Connected),f.info("[RtcSessionController]: PrAnswer SDP already applied. Ignoring any later remote SDPs"),!0;if("offer"===a.type){if(!Ia())return!1;pa(!1,b),s(function(){Ca(a)},ta)}else{if("sdp"===a.sdp||"data"===a.sdp)return eb&&ra(),!0;Ca(a)}return!0},this.renegotiateMedia=function(a){return f.info("[RtcSessionController]: Start Media Renegotiation from client"),!!Ia()&&(pa(!0,a),s(Da,ta),!0)},this.enableRemoteVideo=function(){Ib&&(f.info("[RtcSessionController]: Enable receiving remote video"),Ib=!1)},this.disableRemoteVideo=function(){Ib||(f.info("[RtcSessionController]: Disable receiving remote video"),Ib=!0)},this.addAudio=function(a){return f.info("[RtcSessionController]: Add Audio"),Ea({audio:!0},a)},this.removeAudio=function(a){return f.info("[RtcSessionController]: Remove Audio"),Ea({audio:!1},a)},this.addVideo=function(a){return f.info("[RtcSessionController]: Add Video"),Ea({video:!0},a)},this.removeVideo=function(a){return f.info("[RtcSessionController]: Remove Video"),Ea({video:!1},a)},this.addDesktop=function(a){return f.info("[RtcSessionController]: Add Desktop (screen sharing)"),Ea({desktop:!0},a)},this.removeDesktop=function(a){return f.info("[RtcSessionController]: Remove Desktop (screen sharing)"),Ea({desktop:!1},a)},this.changeMediaType=function(a,b,c,d){return f.info("[RtcSessionController]: Change media type: ",a),a?(gb=!!b,Ea(a,c,d)):(f.warning("[RtcSessionController]: Invalid media type"),!1)},this.holdCall=function(a){return f.info("[RtcSessionController]: Hold Call"),!!Ia()&&(tb?(f.warning("[RtcSessionController]: The call is already held"),!0):(tb=!0,ub=!0,pa(!0,a),s(Da,ta),!0))},this.retrieveCall=function(a){return f.info("[RtcSessionController]: Retrieve Call"),!!Ia()&&(tb?(tb=!1,vb=!0,pa(!0,a),s(Da,ta),!0):(f.warning("[RtcSessionController]: The call is not held"),!0))},this.renegotiationFailed=function(){eb&&(hb||O("res_RTCError"),sa())},this.mute=function(a){f.info("[RtcSessionController]: Mute Call"),oa(!1),a&&window.setTimeout(a,0)},this.unmute=function(a){f.info("[RtcSessionController]: Unmute Call"),oa(!0),a&&window.setTimeout(a,0)},this.isMuted=function(){return wb},this.isLocalMuteAllowed=function(){return wb||$a[Sa]&&$a[Sa].getAudioTracks().length},this.getRTPStatsForClientDiagnostics=function(a,b){if(_a&&_a.mainPeerConnection){b=b||function(){},_a.qosCollected=_a.qosCollected||a;var d=[];d.push(Na(_a.mainPeerConnection,"AUDIO/VIDEO",_a.startTime,a)),_a.groupPeerConnections.forEach(function(b){d.push(Na(b,"AUX_VIDEO",_a.startTime,a))}),ab&&d.push(Na(ab,"SCREEN_SHARE",_a.startTime,a)),c.all(d).then(function(a){a?b(null,a):b("Could not get stats for all peer connections")})}else b("pc not available")},this.isQosDataCollected=function(){return _a&&_a.qosCollected},this.terminate=function(){f.info("[RtcSessionController]: Terminate the RTC session controller"),Fa()},this.canSendDTMFDigits=function(){return!(!Db&&!Ga())&&(Db&&Db.canInsertDTMF)},this.sendDTMFDigits=function(a){return f.info("[RtcSessionController]: Send DTMF Digits - digits=",a),!!Ia()&&(!(!Db&&!Ga())&&(Db.canInsertDTMF?(Db.insertDTMF(a,100,50),!0):(f.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits: "+a),!1)))},this.setMockedCall=function(){Gb=!0},this.getCurrentPeerConnection=function(){return _a.mainPeerConnection},this.setExtraVideoChannelsForParticipants=function(a){var b=0;return a&&a>2&&(b=a-2,b=Math.max(b,Qa),b=Math.min(b,Ra)),Ka(b)},this.setExtraVideoChannels=function(a){return a=a||0,a>0&&(a=Math.max(a,Qa),a=Math.min(a,Ra)),Ka(a)},this.useMaxNumberOfExtraVideoChannels=function(){return Ka(Ra)},this.getNumberOfExtraVideoChannels=function(){return Za},this.hasMaxExtraVideoChannels=function(){return!!i.isMobile()||Za===Ra},this.isConnStable=function(){return Ia()},this.disableIncomingVideo=function(){Jb.forEach(function(a){a.getVideoTracks().length>0&&(a.getVideoTracks()[0].enabled=!1)})},this.enableIncomingVideo=function(){Jb.forEach(function(a){a.getVideoTracks().length>0&&(a.getVideoTracks()[0].enabled=!0)})},this.enableTrickleIce=function(){zb=!b.disableTrickleIce,zb&&f.info("[RtcSessionController]: Enabled Trickle-ICE for offer")},f.debug("[RtcSessionController]: Created new RtcSessionController instance")}var c,d=a.Constants,e=a.IceCandidate,f=a.logger,g=a.ScreenSharingController,h=a.sdpParser,i=a.Utils,j=a.WebRTCAdapter,k=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"});"undefined"!=typeof window.Promise&&(c=window.Promise);var l=2e3,m=200,n=!0,o=2e3,p=5e3,q={video:{maxBw:512},screenShare:{maxBw:300,maxFrameRate:5,minFrameRate:3}},r={video:{minBitRate:60},screenShare:{minBitRate:60,maxBitRate:100,startBitRate:60,maxQuantization:20}};return b.DEFAULT_CANDIDATES_TIMEOUT=l,b.DEFAULT_TRICKLE_ICE_TIMEOUT=m,b.DEFAULT_ENABLE_AUDIO_AGC=n,b.DEFAULT_SDP_PARAMS=q,b.DEFAULT_XGOOGLE=r,b.candidatesTimeout=l,b.trickleIceTimeout=m,b.enableAudioAGC=n,b.allowAllIceCandidatesScreenShare=!0,b.disableTrickleIce=!1,b.allowOnlyRelayCandidates=!1,b.mediaNode=null,b.playbackDeviceId=null,b.recordingDeviceId=null,b.videoDeviceId=null,b.sdpParameters=q,b.xGoogle=r,b.disableDesktopPc=!1,b.overridePromise=function(a){c=a},a.RtcSessionController=b,a.Enums=a.Enums||{},a.Enums.SdpStatus=k,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b,c;c=a.height,b=a.width,c/b>j/k?a.height>j&&(b=b*j/c,c=j):b>k&&(c=c*k/b,b=k);var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b,d.height=c,e.fillStyle=h,e.fillRect(0,0,d.width,d.height),e.drawImage(a,0,0,a.width,a.height,0,0,b,c),d.toDataURL("image/jpeg")}function c(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/jpeg"})}function d(a){return new f(function(d){var e=new FileReader;e.onload=function(e){var f=new Image;f.onload=function(){var e=b(this),f=c(e);f.name=l+(a.modifiedName||a.name),f.lastModified=Math.round(Date.now()/1e3),d(f)},f.src=e.target.result},e.readAsDataURL(a)})}function e(a){function b(a){a&&a.forEach(function(a){var b=new XMLHttpRequest;b.withCredentials=!0,b.open("DELETE",a),b.send()})}function c(a,b,c,d,e){var g=function(){j[a]&&(j[a].xhr=null)};return new f(function(f,h){var i=b.modifiedName||b.name,k=new XMLHttpRequest;k.withCredentials=!0,k.open("POST",d+"/fileapi?itemid="+(c||"NULL"),!0),k.setRequestHeader("Content-Type",b.type),k.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(i)+'"'),"function"==typeof e&&(k.upload.onprogress=function(a){a.total>0&&e(a.loaded,a.total,i)}),k.onload=function(){g(),200===k.status?f(k.response):h({filename:i,status:k.status,statusText:k.statusText,response:k.response,responseText:k.responseText})},k.onerror=function(){g(),h({filename:i,status:500,statusText:"Connection Failed"})},k.onabort=function(){g(),h({filename:i,status:0,statusText:"abort"})},j[a].xhr=k,k.send(b)})}var e=a?a.domain:null,h=1,j={};this.uploadFiles=function(a,b,k,l){if(!f)throw new Error("Promise support is required to use FileUpload");if(a.length>i)return f.reject("Exceeded maximum of 10 files per message");b=b||e;var m=b?"https://"+b:"",n=[],o=h++;j[o]={xhr:null,deleteUrls:[]};var p=[];a.forEach(function(a){g.isSupportedImage&&g.isSupportedImage(a.type)&&p.push(d(a))});var q=f.all(p).then(function(b){return Array.prototype.push.apply(a,b),k=k||null,a.reduce(function(a,b){return a.then(function(){return c(o,b,k,m,l).then(function(a){var c=JSON.parse(a)[0];k=k||c.id;var d=c.fileid[c.fileid.length-1],e=b.modifiedName||b.name,f={fileId:d,fileName:e,itemId:k,mimeType:c.mimeType||b.type,size:b.size,url:m+"/fileapi?fileid="+d+"&itemid="+k,deleteUrl:m+"/fileapi?fileid="+d+"&itemid="+k};return n.push(f),j[o].deleteUrls.push(f.deleteUrl),n})})},f.resolve())}).then(function(a){return delete j[o],f.resolve(a)},function(a){return delete j[o],f.reject(a)});return q.__uploadId=o,q},this.abort=function(a){if(a&&a.__uploadId&&j[a.__uploadId]){var c=j[a.__uploadId];delete j[a.__uploadId],c.xhr&&c.xhr.abort(),b(c.deleteUrls)}}}var f,g=a.Utils,h="#f0f0f0",i=10,j=312,k=484,l="tHuMbNaIl___";return"undefined"!=typeof Promise&&(f=Promise),e.COMPRESSED_IMG_PREFIX=l,e.overridePromise=function(a){f=a},a.FileUpload=e,a}(Circuit||{}),Circuit=function(a){"use strict";function b(a){var b={};this.dispatch=function(c){var d=c&&c.type;return d?void(b[d]?b[d].forEach(function(b){try{b(c)}catch(b){a&&a.error(b)}}):a&&a.debug("[EventTarget]: There is no listener for "+d)):void(a&&a.error("[EventTarget]: Attempted to dispatch a bad event"))},this.addEventListener=function(c,d){return c&&"function"==typeof d?(b[c]||(b[c]=[]),b[c].indexOf(d)>=0?void(a&&a.warning("[EventTarget]: Attempted to add duplicate event listener")):(b[c].push(d),void(a&&a.debug("[EventTarget]: Added event listener for "+this.name+", type = "+c+", count = "+b[c].length)))):void(a&&a.error("[EventTarget]: addEventListener invoked with invalid arguments"))},this.removeEventListener=function(c,d){if(b[c]){var e=b[c].indexOf(d);e>=0&&b[c].splice(e,1),a&&a.debug("[EventTarget]: Removed event listener for "+this.name+", type = "+c+", count = "+b[c].length)}},this.hasEventListener=function(a){return!!b[a]&&b[a].length>0},this.removeAllListeners=function(){b={}}}return b.prototype.constructor=b,b.prototype.createEvent=function(a){return{type:a}},b.prototype.dispatchEvent=function(a){var b=this.createEvent(a);this.dispatch(b)},a.BaseEventTarget=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(d){function i(){var a={};return y&&(a.accessToken=y),z&&h.extend(a,z),"wss://"+x+w+(Object.keys(a).length?"?"+h.toQS(a):"")}function j(a,b,d){if(b){var e=window.setTimeout(function(a){if(c.error("[ConnectionHandler]: Timeout waiting for request response. RequestId:",a),u[a]){delete u[a],b(f.ReturnCode.REQUEST_TIMEOUT);var d=Object.keys(u).length;c.debug("[ConnectionHandler]: Remaining callbacks pending: ",d),0===d&&m()}},q,a);u[a]={cb:b,timer:e,keysToOmitFromResponse:d}}}function k(a){var b;switch(a.msgType){case f.WSMessageType.RESPONSE:if(!a.response||!a.response.code)return null;if(a.response.user){var d;"GET_STUFF"===a.response.user.type?d=a.response.user.getStuff.user:"GET_LOGGED_ON"===a.response.user.type&&(d=a.response.user.getLoggedOn.user),d&&(d.clientId=a.clientId,d.apiVersion=a.apiVersion)}if(u[a.response.requestId])return b=u[a.response.requestId],delete u[a.response.requestId],b.timer&&window.clearTimeout(b.timer),b.keysToOmitFromResponse&&(a.keysToOmitFromLogging=b.keysToOmitFromResponse),{type:"ack",cb:b.cb,data:a.response};c.debug("[ConnectionHandler]: No callback for response with requestId=",a.response.requestId);break;case f.WSMessageType.EVENT:var e=g.ParseEvent(a.event);if(e&&e.name){if(t[e.name])return b=t[e.name],c.debug("[ConnectionHandler]: Parsed event: ",e.name),s.ommitKeysFromLog&&b.keysToOmitFromEvent&&(a.keysToOmitFromLogging=b.keysToOmitFromEvent),{type:"evt",cbList:b,name:e.name,data:e.data}}else c.error("[ConnectionHandler]: Failed to parse event: ",a.event);c.debug("[ConnectionHandler]: No registered callback for event ",e.name);break;default:c.error("[ConnectionHandler]: Unexpected message type: ",a.msgType)}return null}function l(a){c.debug("[ConnectionHandler]: Raising event",a.name),a.cbList.forEach(function(b){try{b(a.data)}catch(a){c.error("[ConnectionHandler]: Error raising event. ",a)}})}function m(){v.length>0&&(c.debug("[ConnectionHandler]: Raise all delayed events"),v.forEach(function(a){window.clearTimeout(a.timeoutId),l(a)}),v=[])}function n(a){if(c.debug("[ConnectionHandler]: WebSocket connection state changed to ",a.newState),c.debug("[ConnectionHandler]: Raising connectionStateChange event"),a.newState!==e.Connected&&Object.keys(u).length){var b=u;u={},window.setTimeout(function(){Object.keys(b).forEach(function(a){var c=b[a];c.timer&&window.clearTimeout(c.timer),c.cb(f.ReturnCode.DISCONNECTED)}),m()},0)}var d=s.createEvent("connectionStateChange");d.newState=a.newState,d.oldState=a.oldState,s.dispatch(d)}function o(){c.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var a=s.createEvent("reconnectFailed");s.dispatch(a)}function p(a){var b=k(a);if(b)if(c.msgRcvd("[ConnectionHandler]: ",a),"evt"===b.type)Object.keys(u).length>0?(c.debug("[ConnectionHandler]: Delay event:",b.name),b.timeoutId=window.setTimeout(function(){l(b);var a=v.indexOf(b);a!==-1&&v.splice(a,1)},r),v.push(b)):l(b);else{var d=Object.keys(u).length;c.debug("[ConnectionHandler]: Remaining callbacks pending: ",d),b.cb(null,b.data),0===d&&m()}}b.parent.constructor.call(this,c);var q=6e4,r=500,s=this,t={},u={},v=[],w="/api",x=window.location.host,y=null,z=null,A=Object.keys(f.DeviceType),B={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0},C=new a.ConnectionController(d);C.onStateChange=n,C.onReconnectFailed=o,C.onMessage=p,this.ommitKeysFromLog=!0,this.onMessage=p,this.setRelativeUrl=function(a){w=a,c.debug("[ConnectionHandler]: Set relative URL to ",w)},this.setTarget=function(a){x=a||window.location.host,c.debug("[ConnectionHandler]: Set target to ",x)},this.setClientInfo=function(a){if(a){if(!a.deviceSubtype||A.indexOf(a.deviceType)===-1)return void c.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",a);z={},Object.keys(a).forEach(function(b){B[b]&&(z[b]=a[b])}),c.debug("[ConnectionHandler]: Set clientInfo to ",z)}else c.debug("[ConnectionHandler]: Clear clientInfo"),z=null},this.setToken=function(a){y=a},this.getUrl=i,this.getState=function(){return C.getState()},this.connect=function(a,b){c.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),C.connect(i(),a,b)},this.disconnect=function(){c.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),C.disconnect()},this.reconnect=function(){c.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server"),C.reconnect(i())},this.sendMessage=function(a,b,d){return a&&a.request&&a.request.requestId?(c.debug("[ConnectionHandler]: Sending "+a.request.type+" request"),C.sendMessage(a)?(b&&j(a.request.requestId,b,d),!0):(c.error("[ConnectionHandler]: Failed to send message"),b&&window.setTimeout(function(){b(f.ReturnCode.FAILED_TO_SEND)},0),!1)):(c.error("[ConnectionHandler]: Cannot send message. Invalid message: ",a),b&&window.setTimeout(function(){b(f.ReturnCode.INVALID_MESSAGE)},0),!1)},this.pingServer=function(){return C.pingServer()},this.on=function(a,b,c){a&&b&&(t[a]=t[a]||[],t[a].push(b),c&&(t[a].keysToOmitFromEvent=c))}}var c=a.logger,d=a.BaseEventTarget,e=a.Enums.ConnectionState,f=a.Constants,g=a.Proto,h=a.Utils;return h.inherit(b,d),b.prototype.name="ConnectionHandler",a.ConnectionHandler=b,a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(a,b,d,e,f){var h=g.Request(a,b);return A?f=null:e&&(h.keysToOmitFromLogging=e),z.sendMessage(h,function(a,b){try{d(a,b)}catch(a){c.error("[ClientApiHandler]: Exception: ",a)}},f),h.request.requestId}function j(a,b){Circuit.Error&&(q=new Circuit.Error(a),b&&(q.errObj=b,q.message=b.info))}function k(a,b,c,d){if(q=null,a)return j(a),c(a),!1;if(b.code===e.ReturnCode.NO_RESULT)return d?c(null,[]):(j(e.ReturnCode.NO_RESULT),c(e.ReturnCode.NO_RESULT)),!1;var f,g=b.code;switch(b.code){case e.ReturnCode.OK:case e.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case e.ReturnCode.SERVICE_EXCEPTION:b.errorInfo&&b.errorInfo.errorCode&&(g=b.errorInfo.errorCode,g===e.ErrorCode.THIRDPARTY_ERROR&&b.errorInfo.thirdpartyError&&(g=b.errorInfo.thirdpartyError.type),f=b.errorInfo)}return g=g||e.ReturnCode.UNEXPECTED_RESPONSE,j(g,f),c(g),!1}function l(a,b,c){b&&j(b),a&&a!==x&&window.setTimeout(function(){a(b,c)},0)}function m(a){var b=[];return a?(a.audio&&b.push(e.RealtimeMediaType.AUDIO),a.video&&b.push(e.RealtimeMediaType.VIDEO),a.desktop&&b.push(e.RealtimeMediaType.DESKTOP_SHARING)):b.push(e.RealtimeMediaType.AUDIO),b}function n(a){return{convId:a.convId,rtcSessionId:a.rtcSessionId,ownerId:a.ownerId,sdp:a.sdp,mediaType:m(a.mediaType),callOut:!!a.callOut,handover:!!a.handover,sendInviteCancel:!!a.sendInviteCancel,peerUserId:a.peerUserId||void 0,replaces:a.replaces,from:a.fromDn||a.fromName?{phoneNumber:a.fromDn,displayName:a.fromName,resolvedUserId:a.fromUserId}:void 0,to:a.dialedDn?{phoneNumber:a.dialedDn,displayName:a.toName,resolvedUserId:a.toUserId}:void 0,isTelephonyConversation:!!a.isTelephonyConversation,displayName:a.displayName,transactionId:a.transactionId,screenSharePointerSupported:a.screenSharePointerSupported}}function o(a){a=a||x,c.debug("[ClientApiHandler]: getApiVersion...");var d={type:e.VersionActionType.GET_VERSION};b(e.ContentType.VERSION,d,function(b,d){if(b||d.code!==e.ReturnCode.OK)B=0;else{var f=d.version.getVersion.version;c.info("[ClientApiHandler]: Setting client API version to ",f),B=h.convertVersionToNumber(f)}a()})}function p(a,d){d=d||x,c.debug("[ClientApiHandler]: getStuff..."),a&&a.length||(a=[e.GetStuffType.USER,e.GetStuffType.ACCOUNTS,e.GetStuffType.FIRST_WEB_LOGIN,e.GetStuffType.PRESENCE_STATE,e.GetStuffType.RECENT_SEARCHES,e.GetStuffType.SETTINGS,e.GetStuffType.SUPPORT_CONVERSATION_ID,e.GetStuffType.TELEPHONY_CONVERSATION_ID,e.GetStuffType.GLOBAL_PROPERTIES,e.GetStuffType.TENANT,e.GetStuffType.NOTIFICATION_SUBSCRIPTIONS]);var f={type:e.UserActionType.GET_STUFF,getStuff:{types:a}},g=["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"];b(e.ContentType.USER,f,function(a,b){if(k(a,b,d)){var c=b.user.getStuff;c.user.userPresenceState=c.userPresenceState,c.user.accounts=c.accounts||[],B=h.convertVersionToNumber(c.user.apiVersion),r=c.user.clientId,s=c.user.userId,d(null,c)}},null,g)}var q,r,s,t=2070004,u=2080003,v=2080014,w=2080018,x=function(){},y=this,z=new d(a),A=!1,B=0;Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return r},set:function(a){"simulatedDirect"===a&&(r=a)}},clientApiVersion:{enumerable:!0,get:function(){return B}}}),this.getLastError=function(){return q},this.connect=function(a,b,c){c&&z.setTarget(c),z.connect(a,b)},this.disconnect=z.disconnect.bind(z),this.reconnect=z.reconnect.bind(z),this.pingServer=z.pingServer.bind(z),this.setTarget=z.setTarget.bind(z),this.setClientInfo=z.setClientInfo.bind(z),this.setToken=z.setToken.bind(z),this.setRelativeUrl=z.setRelativeUrl.bind(z),this.addEventListener=z.addEventListener.bind(z),this.removeEventListener=z.removeEventListener.bind(z),this.setDevelopmentMode=function(a){A=!!a,z.ommitKeysFromLog=!a},this.on=function(a,b){var c;switch(a){case"Account.TELEPHONY_CONFIGURATION_UPDATED":c=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"Conversation.ADD_ITEM":c=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":c=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":c=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":c=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"User.USER_PRESENCE_CHANGE":c=["event.user.presenceChanged.newState.longitude","event.user.presenceChanged.newState.latitude","event.user.presenceChanged.newState.locationText","event.user.presenceChanged.newState.statusMessage"];break;case"Search.BASIC_SEARCH_RESULT":c=["event.search.basicSearchResult.searchResults"]}z.on(a,b,c)},this.isSecurityTabSupported=function(){return B>t},this.isRoutingRulesSupported=function(){return B>t},this.isUpdateRtcAttachmentsSupported=function(){return B>t},this.newConversationSortingSupported=function(){return B>t},this.isTenantSettingsVdiEnabledSupported=function(){return B>t},this.isUpdateTenantSupported=function(){return B>u},this.isLabelsSupported=function(){return B>u},this.isNewRecordingEventingSupported=function(){return B>v},this.isTelephonyRoutingSupported=function(){return B>v},this.isPlantronicsIntegrationSupported=function(){return B>v},this.isSdkUserToUserSupported=function(){return B>w},this.logout=function(a){a=a||x,c.debug("[ClientApiHandler]: logout...");var d={type:e.UserActionType.LOGOUT,logoff:{invalidate:!0}};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null)})},this.getUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getUser...");var f={type:e.UserActionType.GET_USER_BY_ID,getById:{userId:a}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.getById.user)})},this.updateUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: updateUser...");var f={type:e.UserActionType.UPDATE,update:a};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.updateResult.user)})},this.getLoggedOnUser=function(a){a=a||x,c.debug("[ClientApiHandler]: getLoggedOnUser...");var d={type:e.UserActionType.GET_LOGGED_ON},f=["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"];b(e.ContentType.USER,d,function(b,c){var d,e;k(b,c,a)&&(e=c.user.getLoggedOn,d=e.user,e.userPresenceState=e.userPresenceState||d.userPresenceState,d.userPresenceState=e.userPresenceState,d.accounts=e.accounts||[],B=h.convertVersionToNumber(d.apiVersion),r=d.clientId,s=d.userId,a(null,e))},null,f)},this.getStuff=function(a,b){o(p.bind(this,a,b))},this.setPresence=function(a,d){d=d||x,c.debug("[ClientApiHandler]: setPresence...");var f={type:e.UserActionType.SET_PRESENCE,presence:{state:a.state,inTransit:a.inTransit,longitude:a.longitude,latitude:a.latitude,locationText:a.locationText,isAccurate:a.isAccurate,timeZoneOffset:a.timeZoneOffset,mobile:a.mobile,dndUntil:a.dndUntil,statusMessage:a.statusMessage||""}},g=["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],h=["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"];b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null)},g,h)},this.getPresence=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: getPresence...");var g=["response.user.getPresence.states.[].longitude","response.user.getPresence.states.[].latitude","response.user.getPresence.states.[].locationText","response.user.getPresence.states.[].statusMessage"],h={type:e.UserActionType.GET_PRESENCE,getPresence:{userIds:a,full:!!d}};b(e.ContentType.USER,h,function(a,b){k(a,b,f)&&f(null,b.user.getPresence.states)},null,g)},this.subscribePresence=function(a,d){d=d||x,c.debug("[ClientApiHandler]: subscribePresence...");var f=["response.user.subscribePresence.states.[].longitude","response.user.subscribePresence.states.[].latitude","response.user.subscribePresence.states.[].locationText","response.user.subscribePresence.states.[].statusMessage"],g={type:e.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:a}};b(e.ContentType.USER,g,function(a,b){if(k(a,b,d)){var c=b.user&&b.user.subscribePresence&&b.user.subscribePresence.states;d(null,c)}},null,f)},this.unsubscribePresence=function(a,d){d=d||x,c.debug("[ClientApiHandler]: unsubscribePresence...");var f={type:e.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:a}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null)})},this.updateStatusSubscription=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",d);var g;g=d?{type:e.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:a,notificationSubscriptionType:e.NotificationSubscriptionType.ONLINE_STATUS}}:{type:e.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:a,notificationSubscriptionType:e.NotificationSubscriptionType.ONLINE_STATUS}},b(e.ContentType.USER,g,function(a,b){k(a,b,f)&&f(null)})},this.changePassword=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: changePassword...");var g={type:e.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:a,newPassword:d}},h=["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"];b(e.ContentType.USER,g,function(a,b){k(a,b,f)&&f(null,b.user.changePasswordResult.changeResult)},h)},this.setPassword=function(a,d){d=d||x,c.debug("[ClientApiHandler]: setPassword...");var f={type:e.UserActionType.SET_PASSWORD,setPassword:{password:a}},g=["request.user.setPassword.password"];b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.setPasswordResult.resultSetPassword)},g)},this.getLdapTechnicalUserPresence=function(a){a=a||x,c.debug("[ClientApiHandler]: getLdapTechnicalUserPresence...");var d={type:e.UserActionType.GET_LDAP_TECHNICAL_USER_PRESENCE};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null,c.user.getLdapTechnicalUserPresenceResult.state)})},this.subscribeDevices=function(a){a=a||x,c.debug("[ClientApiHandler]: subscribeDevices...");var d={type:e.UserActionType.SUBSCRIBE_DEVICES};b(e.ContentType.USER,d,function(b,c){if(k(b,c,a)){var d=c.user&&c.user.subscribeDevices&&c.user.subscribeDevices.devices;a(null,d)}})},this.unsubscribeDevices=function(a){a=a||x,c.debug("[ClientApiHandler]: unsubscribeDevices...");var d={type:e.UserActionType.UNSUBSCRIBE_DEVICES};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null)})},this.requestEmailChange=function(a,d,f){c.debug("[ClientApiHandler]: requestEmailChange");var g={type:e.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:a,emailAddress:d}};b(e.ContentType.USER,g,function(a,b){k(a,b,f)&&f(null)})},this.getUsersByIds=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getUsersByIds...");var f={type:e.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:a,complete:!0}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.usersByIds.user)})},this.getPartialUsersByIds=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getPartialUsersByIds...");var f={type:e.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:a,complete:!1}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.usersByIds.user)})},this.renewToken=function(a,d){d=d||function(a){a?c.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",a):c.debug("[ClientApiHandler]: Successfully renewed token.")},c.debug("[ClientApiHandler]: renewToken");var f={type:e.UserActionType.RENEW_TOKEN};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.renewToken)})},this.getUserSettings=function(a,d){d=d||x,a=a||e.UserSettingArea.ALL,c.debug("[ClientApiHandler]: getUserSettings...");var f={type:e.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:a}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.getUserSettings.settings)})},this.setUserSettings=function(a,d){d=d||x,c.debug("[ClientApiHandler]: setUserSettings...");var f={type:e.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:a}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null)})},this.getUserByEmail=function(a,c){c=c||x;var d={type:e.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:a,excludeRoles:[e.UserRole.SUPPORT,e.UserRole.SYSTEM_ADMIN]}};b(e.ContentType.USER,d,function(a,b){k(a,b,c)&&c(null,b.user.getUserByMail.user)})},this.getUsersByEmails=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getUsersByEmails...");var f={type:e.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:a,excludeRoles:[e.UserRole.SUPPORT,e.UserRole.SYSTEM_ADMIN]}};b(e.ContentType.USER,f,function(a,b){k(a,b,d,!0)&&d(null,b.user.getUsersByMails.users)})},this.changeUserEmail=function(a,c,d){d=d||x;var f={type:e.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:a,emailAddress:c}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null,b.user.emailUpdate)})},this.goToSleep=function(a,d){d=d||x,c.debug("[ClientApiHandler]: goToSleep...");var f={type:e.UserActionType.GO_TO_SLEEP,userId:a};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null)})},this.wakeUp=function(a){a=a||x,c.debug("[ClientApiHandler]: wakeUp...");var d={type:e.UserActionType.WAKE_UP};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null)})},this.getDevices=function(a){a=a||x,c.debug("[ClientApiHandler]: getDevices...");var d={type:e.UserActionType.GET_DEVICES};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null,c.user.getDevices.devices)})},this.getTelephonyData=function(a){a=a||x,c.debug("[ClientApiHandler]: getTelephonyData...");var d={type:e.UserActionType.GET_TELEPHONY_DATA};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null,c.user.getTelephonyData.data)})},this.getUserExtensions=function(a){a=a||x,c.debug("[ClientApiHandler]: getUserExtensions...");var d={type:e.UserActionType.GET_USER_EXTENSIONS};b(e.ContentType.USER,d,function(b,c){k(b,c,a,!0)&&a(null,c.user.getUserExtensions.extensions)})},this.setUserExtensionState=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: setUserExtensionState...");var g={type:e.UserActionType.SET_USER_EXTENSION_STATE,setUserExtensionState:{extensionId:a,state:d}};b(e.ContentType.USER,g,function(a,b){k(a,b,f)&&f(null,b.user.setUserExtensionStateResult.extensionConfigurationUrl)})},this.getConnectedApps=function(a){a=a||x,c.debug("[ClientApiHandler]: getConnectedApps...");var d={type:e.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};b(e.ContentType.USER,d,function(b,c){k(b,c,a,!0)&&a(null,c.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)})},this.revokeAccessToken=function(a,d){d=d||x,c.debug("[ClientApiHandler]: revokeAccessToken...");var f={type:e.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:a}};b(e.ContentType.USER,f,function(a,b){k(a,b,d)&&d(null)})},this.revokeAllManagedDevices=function(a){a=a||x,c.debug("[ClientApiHandler]: revokeAllManagedDevices...");var d={type:e.UserActionType.REVOKE_MANAGED_DEVICES};b(e.ContentType.USER,d,function(b,c){k(b,c,a)&&a(null)})},this.startBasicSearch=function(a,d,f,g){f=f||x,c.debug("[ClientApiHandler]: startBasicSearch...");var h={type:e.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:a,priorizedConvs:d||void 0,newSearch:g||void 0}};b(e.ContentType.SEARCH,h,function(a,b){k(a,b,f)&&f(null,b.search.startSearchResult.searchId)})},this.startDetailSearch=function(a,d,f,g,h){h=h||x,c.debug("[ClientApiHandler]: startDetailSearch...");var i={type:e.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:a,convId:d,searchId:f||void 0,resultSetLimit:g||0}};b(e.ContentType.SEARCH,i,function(a,b){k(a,b,h)&&h(null,b.search.startSearchResult.searchId)})},this.cancelSearch=function(a,d){d=d||x,c.debug("[ClientApiHandler]: cancelSearch...");var f={type:e.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:a}};b(e.ContentType.SEARCH,f,function(a,b){k(a,b,d)&&d(null)})},this.getRecentSearches=function(a){a=a||x;var c={type:e.SearchActionType.GET_RECENT_SEARCHES
};b(e.ContentType.SEARCH,c,function(b,c){k(b,c,a,!0)&&a(null,c.search.getRecentSearch.recentSearches)})},this.addRecentSearch=function(a,c){c=c||x;var d={type:e.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:a}};b(e.ContentType.SEARCH,d,function(a,b){k(a,b,c)&&c(null)})},this.startUserSearch=function(a,c){c=c||x;var d={type:e.SearchActionType.START_USER_SEARCH,startUserSearch:{query:a.query,reversePhoneNumberLookup:!!a.reversePhoneNumberLookup}};b(e.ContentType.SEARCH,d,function(a,b){k(a,b,c)&&c(null,b.search.startSearchResult.searchId)})},this.createConversation=function(a,d){d=d||x,c.debug("[ClientApiHandler]: createConversation...");var f=a.type;f||(f=a.participants.length>2?e.ConversationType.GROUP:e.ConversationType.DIRECT);var g={type:e.ConversationActionType.CREATE,create:{type:f,topic:a.topic,description:a.description||void 0,participants:a.participants,invitations:a.emailAddresses,locale:a.locale}},h=["request.conversation.create.topic","request.conversation.create.description"],i=["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"];b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,d)&&d(null,b.conversation.create.conversation,b.code===e.ReturnCode.ENTITY_ALREADY_EXISTS)},h,i)},this.updateConversation=function(a,d){d=d||x,c.debug("[ClientApiHandler]: updateConversation...");var f={type:e.ConversationActionType.UPDATE,update:{convId:a.conversationId,topic:a.topic,description:a.description}},g=["request.conversation.update.topic","request.conversation.update.description"],h=["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"];b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.update.conversation)},g,h)},this.addTextItem=function(a,d){d=d||x,c.debug("[ClientApiHandler]: addTextItem...");var g=a.content&&h.sanitize(a.content)||"";g=f.convertPrivateDataToContent(a)+g;var i={type:e.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:a.convId,parentId:a.parentId,contentType:a.contentType,subject:a.subject,content:g,attachmentMetaData:a.attachmentMetaData,externalAttachmentMetaData:a.externalAttachmentMetaData,preview:a.preview,mentionedUsers:a.mentionedUsers}};i.addTextItem.preview&&i.addTextItem.preview.description&&(i.addTextItem.preview.description=i.addTextItem.preview.description.substr(0,255));var j=["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],l=["response.conversation.addTextItem.item.text"];b(e.ContentType.CONVERSATION,i,function(a,b){k(a,b,d)&&d(null,b.conversation.addTextItem.item)},j,l)},this.updateTextItem=function(a,d){d=d||x,c.debug("[ClientApiHandler]: updateTextItem...");var g=a.content&&h.sanitize(a.content)||"";g=f.convertPrivateDataToContent(a)+g;var i={itemId:a.itemId,convId:a.convId,parentId:a.parentId,contentType:e.TextItemContentType.RICH,subject:a.subject,content:g,attachmentMetaData:a.attachmentMetaData,preview:a.preview||{},clustered:a.clustered,externalAttachmentMetaData:a.externalAttachmentMetaData,mentionedUsers:a.mentionedUsers};a.unshareProviders&&(i.unshareProviders=a.unshareProviders),i.preview.description&&(i.preview.description=i.preview.description.substr(0,255)),i.externalAttachmentMetaData&&0!==i.externalAttachmentMetaData.length||(i.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),i.attachmentMetaData&&0!==i.attachmentMetaData.length||(i.attachmentMetaData=[{}]);var j={type:e.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:i},l=["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],m=["response.conversation.updateTextItem.item.text"];b(e.ContentType.CONVERSATION,j,function(a,b){k(a,b,d)&&d(null,b.conversation.updateTextItem.item)},l,m)},this.deleteTextItem=function(a,d){if(d=d||x,!a||!a.itemId)return c.warn("[ClientApiHandler]: No request parameters were provided"),void l(d,e.ReturnCode.INVALID_MESSAGE);c.debug("[ClientApiHandler]: deleteTextItem...");var f={type:e.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:a.itemId}};a.unshareProviders&&(f.deleteTextItem.unshareProviders=a.unshareProviders),b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.deleteTextItem.item)})},this.deleteRecording=function(a,d){d=d||x,c.debug("[ClientApiHandler]: deleteRecording...");var f={type:e.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.deleteRecording.item)})},this.updateRtcItemAttachments=function(a,d,f){if(f=f||x,c.debug("[ClientApiHandler]: updateRtcItemAttachments..."),!y.isUpdateRtcAttachmentsSupported())return c.warn("[ClientApiHandler]: The updateRtcItemAttachments operation is not supported by the backend"),void l(f,e.ReturnCode.OPERATION_NOT_SUPPORTED);var g={type:e.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:a,attachments:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.updateRtcItemAttachmentsResult.item)})},this.getOpenConversations=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: getOpenConversations...");var g={type:e.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:a,numberOfItems:d}},h=["response.conversation.getOpenConversations.conversations"];b(e.ContentType.CONVERSATION,g,function(a,b){if(k(a,b,f,!0)){var c=b.conversation.getOpenConversations;f(null,c.conversations,c.lastItemIndex)}},null,h)},this.getAllOpenConversations=function(a,d,f,g){g=g||x,c.debug("[ClientApiHandler]: getAllOpenConversations...");var h={type:e.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:a,numberOfItems:d,ownIncluded:!0,sorting:f}},i=["response.conversation.getOpenConversations.conversations"];b(e.ContentType.CONVERSATION,h,function(a,b){if(k(a,b,g,!0)){var c=b.conversation.getOpenConversations;g(null,c.conversations,c.lastItemIndex)}},null,i)},this.joinOpenConversation=function(a,d){d=d||x,c.debug("[ClientApiHandler]: JoinOpenConversation...");var f={type:e.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.joinOpenConversation.conv)})},this.getConversationFeed=function(a,d,f,g,h,i,j){j=j||x,c.debug("[ClientApiHandler]: getConversationFeed...");var l={type:e.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:a,timestamp:d||void 0,minTotalItems:f||void 0,maxTotalUnread:g||void 0,commentsPerThread:h||void 0,maxUnreadPerThread:i||void 0}},m=["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"];b(e.ContentType.CONVERSATION,l,function(a,b){if(k(a,b,j,!0)){var c=b.conversation.getConversationFeedResult;j(null,c.conversationThreads,c.hasOlderThreads)}},null,m)},this.getThreadComments=function(a,d,f,g,h,i,j){j=j||x,c.debug("[ClientApiHandler]: getThreadComments...");var l={type:e.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:a,threadId:d,timestamp:f||void 0,timestampFilter:g||e.TimestampFilter.CREATION,direction:h||void 0,totalComments:i||void 0}},m=["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"];b(e.ContentType.CONVERSATION,l,function(a,b){if(k(a,b,j,!0)){var c=b.conversation.getThreadCommentsResult;j(null,c.comments,c.hasMoreComments)}},null,m)},this.getThreadsByItemIds=function(a,d){if(c.debug("[ClientApiHandler]: getThreadsByItemIds..."),d=d||x,!a)return c.warn("[ClientApiHandler]: No request parameters were provided"),void l(d,e.ReturnCode.INVALID_MESSAGE);if(!a.convId)return c.warn("[ClientApiHandler]: No conversation id was provided"),void l(d,e.ReturnCode.INVALID_MESSAGE);if(!a.threadParams)return c.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void l(d,e.ReturnCode.INVALID_MESSAGE);var f=["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"],g={type:e.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:a.convId,threadParams:a.threadParams,timestampFilter:a.timestampFilter||void 0,orderBy:a.orderBy||void 0}};b(e.ContentType.CONVERSATION,g,function(a,b){if(k(a,b,d,!0)){var c=b.conversation.getThreadsByItemIdsResult;d(null,c&&c.conversationThreadContext)}},null,f)},this.getThreadsByIds=function(a,d){if(c.debug("[ClientApiHandler]: getThreadsByIds..."),d=d||x,!a)return c.warn("[ClientApiHandler]: No request parameters were provided"),void l(d,e.ReturnCode.INVALID_MESSAGE);if(!a.convId)return c.warn("[ClientApiHandler]: No conversation id was provided"),void l(d,e.ReturnCode.INVALID_MESSAGE);if(!(a.threadIds instanceof Array&&a.threadIds.length>0))return c.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void l(d,e.ReturnCode.INVALID_MESSAGE);var f=["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"],g={type:e.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:a.convId,threadIds:a.threadIds,orderBy:a.orderBy||e.SortingType.TIMESTAMP_ASC,commentsPerThread:a.commentsPerThread||void 0}};b(e.ContentType.CONVERSATION,g,function(a,b){if(k(a,b,d,!0)){var c=b.conversation.getThreadsByIdsResult;d(null,c&&c.conversationThreads)}},null,f)},this.getConversations=function(a,d,f,g,h,i){i=i||x,c.debug("[ClientApiHandler]: getConversations...");var j=f?e.SearchDirection.BEFORE:e.SearchDirection.AFTER,l={type:e.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:a,modificationDate:d||void 0,direction:j,number:g||void 0,filter:h||e.ConversationFilter.ALL}};this.newConversationSortingSupported()&&(l.getConversations.sortByLastItem=!!f);var m=["response.conversation.getConversations.conversations"];b(e.ContentType.CONVERSATION,l,function(a,b){k(a,b,i,!0)&&i(null,b.conversation.getConversations.conversations)},null,m)},this.getSupportConversation=function(a){a=a||x,c.debug("[ClientApiHandler]: getSupportConversation...");var d={type:e.ConversationActionType.GET_SUPPORT_CONVERSATION};b(e.ContentType.CONVERSATION,d,function(b,c){k(b,c,a)&&a(null,c.conversation.getSupportConversation.conversation)})},this.getSupportConversationId=function(a){a=a||x,c.debug("[ClientApiHandler]: getSupportConversationId...");var d={type:e.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};b(e.ContentType.CONVERSATION,d,function(b,c){k(b,c,a)&&a(null,c.conversation.getSupportConversationId.conversationId)})},this.getTelephonyConversationId=function(a){a=a||x,c.debug("[ClientApiHandler]: getTelephonyConversationId...");var d={type:e.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};b(e.ContentType.CONVERSATION,d,function(b,c){k(b,c,a)&&a(null,c.conversation.getTelephonyConversationId.conversationId)})},this.getMarkedConversationsList=function(a){a=a||x,c.debug("[ClientApiHandler]: getMarkedConversationsList...");var d={type:e.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};b(e.ContentType.CONVERSATION,d,function(b,c){i.removeItem("favorites"),k(b,c,a)&&a(null,c.conversation.getMarkedConversationsList)})},this.markConversation=function(a,c){c=c||x;var d={type:e.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:a.convId,filter:a.markType}};b(e.ContentType.CONVERSATION,d,function(a,b){k(a,b,c)&&c(null)})},this.unmarkConversation=function(a,c){c=c||x;var d={type:e.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:a.convId,filter:a.markType}};b(e.ContentType.CONVERSATION,d,function(a,b){k(a,b,c)&&c(null)})},this.getConversationUserData=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getConversationUserData..."),a instanceof Array||(a=[a]);var f={type:e.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.getConversationUserData.userData)})},this.getConversationItems=function(a,d,f,g,h,i){i=i||x,c.debug("[ClientApiHandler]: getConversationItems...");var j={type:e.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:a,modificationDate:d||void 0,creationDate:f||void 0,direction:g||void 0,number:h||void 0}},l=["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"];b(e.ContentType.CONVERSATION,j,function(a,b){k(a,b,i,!0)&&i(null,b.conversation.getItemsByConversation.items)},null,l)},this.getConversationAttachments=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: getConversationAttachments..."),d.type===e.AttachmentOrderType.FILEEXTENSION&&B<=v&&(d.type=e.AttachmentOrderType.MIMETYPE);var g={type:e.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:a,startPage:d.page||void 0,pageSize:d.size||void 0,orderType:d.type||void 0,orderDirection:d.direction||void 0}};b(e.ContentType.CONVERSATION,g,function(a,b){if(k(a,b,f)){var c=b.conversation.getAttachments.attachments||[],d=b.conversation.getAttachments.nextPage.hasMoreAttachments?b.conversation.getAttachments.nextPage.lastIndex:null;f(null,c,d)}})},this.getItemsByConversationItemId=function(a,d,f,g,h,i){i=i||x,c.debug("[ClientApiHandler]: getItemsByConversationItemId...");var j={type:e.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:a,itemId:d,direction:f||void 0,number:g||void 0,orderType:h||void 0}},l=["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"];b(e.ContentType.CONVERSATION,j,function(a,b){k(a,b,i,!0)&&i(null,b.conversation.getItemsByConversationItemId.items)},null,l)},this.getConversationById=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getConversationById...");var f={type:e.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:a}},g=["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"];b(e.ContentType.CONVERSATION,f,function(a,b){if(k(a,b,d)){var e=b.conversation.getConversationById.conversation;e&&e.participants&&c.info("[ClientApiHandler]: Retrieved conversation has "+e.participants.length+" participant(s)"),d(null,e)}},null,g)},this.getItemById=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getItemById...");var f={type:e.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:a}},g=["response.conversation.getItemById.item.text"];b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.getItemById.item)},null,g)},this.setReadPointer=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: setReadPointer...");var g={type:e.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:a,lastReadTimestamp:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null)})},this.getConversationByUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getConversationByUser...");var f={type:e.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:a}},g=["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"];b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.getConversationByUser.conversation)},null,g)},this.subscribe=function(a,d){d=d||x,c.debug("[ClientApiHandler]: subscribe...");var f={type:e.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null)})},this.unsubscribe=function(a,d){d=d||x,c.debug("[ClientApiHandler]: unsubscribe...");var f={type:e.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null)})},this.typing=function(a,d,f,g){g=g||x,c.debug("[ClientApiHandler]: typing...");var h={type:e.ConversationActionType.TYPING,typing:{conversationId:a,isTyping:d,parentItemId:f}};b(e.ContentType.CONVERSATION,h,function(a,b){k(a,b,g)&&g(null)})},this.addParticipant=function(a,d){d=d||x,c.debug("[ClientApiHandler]: addParticipant...");var f={type:e.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:a.convId,userId:a.userId,invitations:a.emailAddresses,locale:a.locale}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.addParticipant)})},this.removeParticipant=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: removeParticipant..."),!d||d instanceof Array||(d=[d]);var g={type:e.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:a,userId:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.removeParticipant.conversation)})},this.getConversationParticipants=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: getConversationParticipants..."),d=d||{};var g={type:e.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:a,searchCriterias:d.searchCriterias||void 0,searchPointer:d.searchPointer||void 0,pageSize:d.pageSize||25,includePresence:!!d.includePresence}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.getConversationParticipantsResult)})},this.getJoinDetails=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: getJoinDetails...");var g={type:e.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:a,recreate:!!d}},h=["response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"];b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.getJoinDetails)},null,h)},this.setFlagItem=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: setFlagItem..."),!a)return c.warn("[ClientApiHandler]: No request parameters were provided"),void l(d,e.ReturnCode.INVALID_MESSAGE);var f={type:e.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:a.convId,conversationItemId:a.itemId,conversationItemCreationTime:a.creationTime,conversationParentId:a.parentId}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null)})},this.clearFlagItem=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: clearFlagItem...");var g={type:e.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:a,conversationItemId:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null)})},this.getFlaggedItems=function(a){a=a||x,c.debug("[ClientApiHandler]: getFlaggedItems...");var d={type:e.ConversationActionType.GET_FLAGGED_ITEMS};b(e.ContentType.CONVERSATION,d,function(b,c){k(b,c,a,!0)&&a(null,c.conversation.getFlaggedItem.flaggedItems)})},this.likeTextItem=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: likeTextItem...");var g={type:e.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:a,userId:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null)})},this.unlikeTextItem=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: unlikeTextItem...");var g={type:e.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:a,userId:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null)})},this.setConvAvatar=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: setConvAvatar...");var g={type:e.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:a,imageS:d.s,imageL:d.b}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.setConversationAvatar.conversation)})},this.deleteConvAvatar=function(a,d){d=d||x,c.debug("[ClientApiHandler]: deleteConvAvatar...");var f={type:e.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:a,imageS:"",imageL:""}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.setConversationAvatar.conversation)})},this.moderateConversation=function(a,d){d=d||x,c.debug("[ClientApiHandler]: moderateConversation...");var f={type:e.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.moderateResult)})},this.unmoderateConversation=function(a,d){d=d||x,c.debug("[ClientApiHandler]: unmoderateConversation...");var f={type:e.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.moderateResult)})},this.updateGuestAccess=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: updateGuestAccess...");var g={type:e.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:a,guestAccessDisabled:!!d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.updateGuestAccessResult)})},this.getConversationSummary=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getConversationSummary...");var f={type:e.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.getConversationSummary.conversationSummary)})},this.grantModeratorRights=function(a,d,f){f=f||x,d instanceof Array||(d=[d]),c.debug("[ClientApiHandler]: grantModeratorRights...");var g={type:e.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:a,userId:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.grantModeratorRightsResult)})},this.dropModeratorRights=function(a,d,f){f=f||x,d instanceof Array||(d=[d]),c.debug("[ClientApiHandler]: dropModeratorRights...");var g={type:e.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:a,userId:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.dropModeratorRightsResult)})},this.addJournalEntry=function(a,d){d=d||x,c.debug("[ClientApiHandler]: addJournalEntry...");var f={type:e.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:a.convId,starter:a.starter,source:a.source,destination:a.destination,startTime:a.startTime,duration:a.duration,type:a.type,participants:a.participants,missedReason:a.missedReason}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null)})},this.setFavoritePosition=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: setFavoritePosition...");var g={type:e.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:a,position:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b)})},this.addLabels=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: addLabels..."),!y.isLabelsSupported())return c.warn("[ClientApiHandler]: The addLabels operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.ConversationActionType.ADD_LABELS,addLabels:{labels:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.addLabelsResult.labels)})},this.assignLabels=function(a,d,f){if(f=f||x,c.debug("[ClientApiHandler]: assignLabels..."),!y.isLabelsSupported())return c.warn("[ClientApiHandler]: The assignLabels operation is not supported by the backend"),void l(f,e.ReturnCode.OPERATION_NOT_SUPPORTED);var g={type:e.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:a,labelIds:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f)&&f(null,b.conversation.assignLabelsResult.labelIds)})},this.unassignLabels=function(a,d,f){if(f=f||x,c.debug("[ClientApiHandler]: unassignLabels..."),!y.isLabelsSupported())return c.warn("[ClientApiHandler]: The unassignLabels operation is not supported by the backend"),void l(f,e.ReturnCode.OPERATION_NOT_SUPPORTED);var g={type:e.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:a,labelIds:d}};b(e.ContentType.CONVERSATION,g,function(a,b){k(a,b,f,!0)&&f(null,b.conversation.unassignLabelsResult.labelIds)})},this.getAllLabels=function(a){if(a=a||x,c.debug("[ClientApiHandler]: getAllLabels..."),!y.isLabelsSupported())return c.warn("[ClientApiHandler]: The getLabels operation is not supported by the backend"),void l(a,e.ReturnCode.OPERATION_NOT_SUPPORTED);var d={type:e.ConversationActionType.GET_LABELS};b(e.ContentType.CONVERSATION,d,function(b,c){k(b,c,a,!0)&&a(null,c.conversation.getLabelsResult.labels)})},this.removeLabels=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: removeLabels..."),!y.isLabelsSupported())return c.warn("[ClientApiHandler]: The removeLabels operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d,!0)&&d(null,b.conversation.removeLabelsResult.labelIds)})},this.editLabel=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: editLabel..."),!y.isLabelsSupported())return c.warn("[ClientApiHandler]: The editLabel operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.ConversationActionType.EDIT_LABEL,editLabel:{label:a}};b(e.ContentType.CONVERSATION,f,function(a,b){k(a,b,d)&&d(null,b.conversation.editLabelResult.label)})},this.joinRtcCall=function(a,d){d=d||x,c.debug("[ClientApiHandler]: joinRtcCall...");var f={type:e.RTCCallActionType.JOIN,join:n(a)};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.answerRtcCall=function(a,d){d=d||x,c.debug("[ClientApiHandler]: answerRtcCall...");var f={type:e.RTCCallActionType.ANSWER,answer:n(a)};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.sendIceCandidates=function(a,d){d=d||x,c.debug("[ClientApiHandler]: sendIceCandidates...");var f={type:e.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:a.rtcSessionId,userId:a.userId,origin:a.origin,candidates:a.candidates}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.leaveRtcCall=function(a,d){d=d||x,c.debug("[ClientApiHandler]: leaveRtcCall...");var f={type:e.RTCCallActionType.LEAVE,leave:{rtcSessionId:a}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.terminateRtcCall=function(a,d){d=d||x,c.debug("[ClientApiHandler]: terminateRtcCall...");var f={type:e.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:a}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.declineRtcCall=function(a,d){d=d||x,c.debug("[ClientApiHandler]: declineRtcCall...");var f={type:e.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:a.convId,rtcSessionId:a.rtcSessionId,cause:a.cause,transactionId:a.transactionId}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.changeMediaType=function(a,d){d=d||x,c.debug("[ClientApiHandler]: changeMediaType...");var f={type:e.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:a.rtcSessionId,sdp:a.sdp,mediaTypes:m(a.mediaType),transactionId:a.transactionId,screenSharePointerSupported:a.screenSharePointerSupported}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.changeMediaAccept=function(a,d){d=d||x,c.debug("[ClientApiHandler]: changeMediaAccept...");var f={type:e.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:a.rtcSessionId,sdp:a.sdp,transactionId:a.transactionId}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.changeMediaReject=function(a,d){d=d||x,c.debug("[ClientApiHandler]: changeMediaReject...");var f={type:e.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:a.rtcSessionId,transactionId:a.transactionId}};b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null)})},this.prepareSession=function(a,d){d=d||x,c.debug("[ClientApiHandler]: prepareSession... ");var f={type:e.RTCCallActionType.PREPARE,prepare:{convId:a.convId,rtcSessionId:a.rtcSessionId,ownerId:a.ownerId,mediaNode:a.mediaNode,isTelephonyConversation:a.isTelephonyConversation}},g=["response.rtcCall.prepare.servers.[].password"];b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null,b.rtcCall.prepare.servers,b.rtcCall.prepare.newRtcSessionId)},null,g)},this.renewTurnCredentials=function(a,d){d=d||x,c.debug("[ClientApiHandler]: renewTurnCredentials... ");var f={type:e.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:a}},g=["response.rtcCall.renewTurnCredentials.servers.[].password"];b(e.ContentType.RTC_CALL,f,function(a,b){k(a,b,d)&&d(null,b.rtcCall.renewTurnCredentials.servers)},null,g)},this.sendProgress=function(a,d,f,g){g=g||x,c.debug("[ClientApiHandler]: sendProgress... ");var h={type:e.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:a,userId:f,invitingUser:d||"",type:e.RTCProgressType.ALERTING}};b(e.ContentType.RTC_CALL,h,function(a,b){k(a,b,g)&&g(null)})},this.lockRtcSession=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: lockRtcSession...");var g={type:e.RTCSessionActionType.LOCK,lock:{rtcSessionId:a,locked:!!d}};b(e.ContentType.RTC_SESSION,g,function(a,b){
k(a,b,f)&&f(null)})},this.muteRtcSession=function(a,d){d=d||x,c.debug("[ClientApiHandler]: muteRtcSession...");var f={type:e.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:a.rtcSessionId,muted:!!a.muted,excludedUserIds:a.excludedUserIds||void 0}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.muteParticipant=function(a,d){d=d||x,c.debug("[ClientApiHandler]: muteParticipant...");var f={type:e.RTCSessionActionType.MUTE,mute:{rtcSessionId:a.rtcSessionId,muted:!!a.muted,userIds:a.usersIds||void 0}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.addParticipantToRtcSession=function(a,d){d=d||x,c.debug("[ClientApiHandler]: addParticipantToRtcCall...");var f={type:e.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:a.rtcSessionId,userId:a.userId,from:a.from,to:a.to,mediaType:m(a.mediaType)}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.removeSessionParticipant=function(a,d){d=d||x,c.debug("[ClientApiHandler]: removeSessionParticipant...");var f={type:e.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:a.rtcSessionId,userId:a.userId}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.getActiveSessions=function(a){a=a||x,c.debug("[ClientApiHandler]: getActiveSessions...");var d={type:e.RTCSessionActionType.GET_ACTIVE_SESSIONS};b(e.ContentType.RTC_SESSION,d,function(b,c){k(b,c,a,!0)&&a(null,c.rtcSession.activeSessions.session)})},this.getSession=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getSession...");var f={type:e.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:a}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null,b.rtcSession.getSession.session)})},this.moveRtcSession=function(a,d){d=d||x,c.debug("[ClientApiHandler]: moveRtcSession...");var f={type:e.RTCSessionActionType.MOVE,move:{oldRtcSessionId:a.sessionId,oldConversationId:a.conversationId,newConversationId:a.newConversationId,newRtcSessionId:a.newSessionId}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.startRecording=function(a,d){d=d||x,c.debug("[ClientApiHandler]: startRecording...");var f={type:e.RTCSessionActionType.START_RECORDING,startRecording:{convId:a.convId,rtcSessionId:a.rtcSessionId,mediaTypes:m(a.mediaTypes)}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.stopRecording=function(a,d){d=d||x,c.debug("[ClientApiHandler]: stopRecording...");var f={type:e.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:a.convId,rtcSessionId:a.rtcSessionId}};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.raiseQuestion=function(a,d){d=d||x,c.debug("[ClientApiHandler]: raiseQuestion...");var f={type:e.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null,b.rtcSession.raiseQuestion.questionNumber)})},this.inviteToStage=function(a,d){d=d||x,c.debug("[ClientApiHandler]: inviteToStage..."),a.allowedMediaTypes=m();var f={type:e.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.inviteToStageAnswer=function(a,d){d=d||x,c.debug("[ClientApiHandler]: inviteToStageAnswer...");var f={type:e.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.inviteToStageCancel=function(a,d){d=d||x,c.debug("[ClientApiHandler]: inviteToStageCancel...");var f={type:e.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.removeFromStage=function(a,d){d=d||x,c.debug("[ClientApiHandler]: removeFromStage...");var f={type:e.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.getQuestions=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getQuestions...");var f={type:e.RTCSessionActionType.GET_QUESTIONS,getQuestions:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null,b.rtcSession.getQuestions.questions)})},this.updateQuestionState=function(a,d){d=d||x,c.debug("[ClientApiHandler]: updateQuestionState...");var f={type:e.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.openCurtain=function(a,d){d=d||x,c.debug("[ClientApiHandler]: openCurtain...");var f={type:e.RTCSessionActionType.OPEN_CURTAIN,openCurtain:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.closeCurtain=function(a,d){d=d||x,c.debug("[ClientApiHandler]: closeCurtain...");var f={type:e.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d)&&d(null)})},this.getNodeState=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getNodeState...");var f={type:e.RTCSessionActionType.GET_NODE_STATE,getNodeState:a};b(e.ContentType.RTC_SESSION,f,function(a,b){k(a,b,d,!0)&&d(null,b.rtcSession.getNodeState.nodeData)})},this.submitClientData=function(a,d){d=d||x,c.debug("[ClientApiHandler]: submitClientData...");var f={type:e.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:a}};b(e.ContentType.INSTRUMENTATION,f,function(a,b){if(k(a,b,d)){var c=b.instrumentation&&b.instrumentation.submitClientData&&b.instrumentation.submitClientData.submitDataResult;d(null,c||e.SubmitDataResult.OK)}})},this.submitQOSData=function(a,d){d=d||x,c.debug("[ClientApiHandler]: submitQOSData...");var f={type:e.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{dataSets:a}};b(e.ContentType.INSTRUMENTATION,f,function(a,b){k(a,b,d)&&d(null)})},this.getNotifications=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: getNotifications...");var g={type:e.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:a,numberOfItems:d}};b(e.ContentType.ACTIVITYSTREAM,g,function(a,b){if(k(a,b,f,!0)){var c=b.activityStream.getActivitiesByUserResult;f(null,c)}})},this.toggleReadUnread=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: toggleReadUnread...");var g={type:e.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:a,read:d}};b(e.ContentType.ACTIVITYSTREAM,g,function(a,b){if(k(a,b,f)){var c=b.activityStream.updateResult;f(null,c.updatedItem)}})},this.markAllNotificationsAsRead=function(a){a=a||x,c.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var d={type:e.ActivityStreamActionType.MARK_ALL_READ};b(e.ContentType.ACTIVITYSTREAM,d,function(b,c){if(k(b,c,a)){var d=c.activityStream.markAllReadResult;a(null,d)}})},this.getTenant=function(a){a=a||x,c.debug("[ClientApiHandler]: getTenant...");var d={type:e.AdministrationActionType.GET_TENANT};b(e.ContentType.ADMINISTRATION,d,function(b,c){k(b,c,a)&&a(null,c.administration.getTenant.tenant)})},this.addUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: addUser...");var f={type:e.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:a.emailAddress,lastName:a.lastName,firstName:a.firstName,locale:a.locale},password:a.password,packageId:a.packageId,accountTemplateId:a.accountTemplateId}},g=["request.administration.addUser.password"];b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.addUserResult.user)},g)},this.addMeetingPointV2=function(a,d){d=d||x,c.debug("[ClientApiHandler]: addMeetingPointV2...");var f={type:e.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:a.emailAddress,lastName:a.lastName,firstName:a.firstName,locale:a.locale,location:a.location,registrationCodeTtl:a.timeout},packageId:a.packageId}},g=["response.administration.addMeetingPointV2Result.registrationCode"];b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.addMeetingPointV2Result)},null,g)},this.updateMeetingPointV2=function(a,d){d=d||x,c.debug("[ClientApiHandler]: updateMeetingPointV2...");var f={type:e.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:a.id,registrationCodeTtl:a.timeout}},g=["response.administration.updateMeetingPointV2Result.registrationCode"];b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.updateMeetingPointV2Result.registrationCode)},null,g)},this.regenerateApiKey=function(a,d){d=d||x,c.debug("[ClientApiHandler]: regenerateApiKey...");var f={type:e.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:a}},g=["response.administration.regenerateApiKey.apiKey"];b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.regenerateApiKey.apiKey)},null,g)},this.deleteUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: deleteUser...");var f={type:e.AdministrationActionType.DELETE_USER,deleteUser:{userId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.inviteUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: inviteUser...");var f={type:e.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:a.userAttributes.emailAddress,lastName:a.userAttributes.lastName,firstName:a.userAttributes.firstName},packageId:a.packageId,accountTemplateId:a.accountTemplateId}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.inviteUser.resultType)})},this.inviteMultipleUsers=function(a,d){d=d||x,c.debug("[ClientApiHandler]: inviteMultipleUsers...");var f={type:e.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:a};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.invitePartnerUsers=function(a,d){d=d||x,c.debug("[ClientApiHandler]: invitePartnerUsers...");var f={type:e.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.resendInvite=function(a,d){d=d||x,c.debug("[ClientApiHandler]: resendInvite...");var f={type:e.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.resendUserInvitation.resultType)})},this.checkInvalidTenant=function(a,d){d=d||x,c.debug("[ClientApiHandler]: checkInvalidTenant...");var f={type:e.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.checkInvalidTenants.tenantIds)})},this.setTelephonyTrunkData=function(a,d){d=d||x,c.debug("[ClientApiHandler]: setTelephonyTrunkData...");var f={type:e.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d()})},this.getTelephonyTrunkStatus=function(a){a=a||x,c.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var d={type:e.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};b(e.ContentType.ADMINISTRATION,d,function(b,c){k(b,c,a)&&a(null,c.administration.getTelephonyTrunkStatus)})},this.getTenantBridgeNumbers=function(a){a=a||x,c.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var d={type:e.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};b(e.ContentType.ADMINISTRATION,d,function(b,c){if(k(b,c,a)){var d=c.administration.getTenantBridgeNumbers;a(null,d&&d.bridgeNumbers||[])}})},this.setTenantBridgeNumbers=function(a,d){d=d||x,c.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var f={type:e.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d()})},this.exportUserList=function(a,d){d=d||x,c.debug("[ClientApiHandler]: exportUserList..."),a&&!Array.isArray(a)&&(a=[a]);var f={type:e.AdministrationActionType.EXPORT_TENANT,exportTenant:{exportFormats:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.addAutoConfigurableTrunk=function(a){a=a||x,c.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var d={type:e.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};b(e.ContentType.ADMINISTRATION,d,function(b,c){k(b,c,a)&&a(null,c.administration.addTrunk.configuration)})},this.getTenantTelephonyConfiguration=function(a){a=a||x,c.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var d={type:e.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};b(e.ContentType.ADMINISTRATION,d,function(b,c){k(b,c,a)&&a(null,c.administration.getTenantTelephonyConfiguration.configuration)})},this.getTelephonyRoutingRules=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: getTelephonyRoutingRules..."),!y.isRoutingRulesSupported())return c.warn("[ClientApiHandler]: The getTelephonyRoutingRules operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:a.pageSize,pagePointer:a.pagePointer}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.getTelephonyRoutingRulesResult)})},this.addTelephonyRoutingRule=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: addTelephonyRoutingRule..."),!y.isRoutingRulesSupported())return c.warn("[ClientApiHandler]: The addTelephonyRoutingRule operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:a.routePosition,condition1:a.condition1,gtcUserId:a.gtcUserId,operator:a.operator||void 0,condition2:a.condition2||void 0,application:a.application||void 0}}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.updateTelephonyRoutingRule=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: updateTelephonyRoutingRule..."),!y.isRoutingRulesSupported())return c.warn("[ClientApiHandler]: The updateTelephonyRoutingRule operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:a.routePosition,condition1:a.condition1,gtcUserId:a.gtcUserId,routeId:a.routeId||void 0,operator:a.operator||void 0,condition2:a.condition2||void 0,application:a.application||void 0}}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.removeTelephonyRoutingRule=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: removeTelephonyRoutingRule..."),!y.isRoutingRulesSupported())return c.warn("[ClientApiHandler]: The removeTelephonyRoutingRule operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.testTelephonyRoutingRules=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: testTelephonyRoutingRule..."),!y.isRoutingRulesSupported())return c.warn("[ClientApiHandler]: The testTelephonyRoutingRule operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:a.destination,origin:a.origin||void 0,application:a.application||void 0,considerTelephonyConnectorsStates:!!a.considerTelephonyConnectorsStates}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.testTelephonyRoutingRulesResult)})},this.updateTenantTelephonyConfiguration=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration..."),!y.isRoutingRulesSupported())return c.warn("[ClientApiHandler]: The updateTenantTelephonyConfiguration operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.setTrunkPassword=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: setTrunkPassword...");var g={type:e.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:a,password:d}},h=["request.administration.setTrunkPassword.password"];b(e.ContentType.ADMINISTRATION,g,function(a,b){k(a,b,f)&&f(null)},h)},this.setTenantSettings=function(a,d){d=d||x,c.debug("[ClientApiHandler]: setTenantSettings...");var f={type:e.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.updateTenantName=function(a,d){if(d=d||x,c.debug("[ClientApiHandler]: updateTenantName..."),!y.isUpdateTenantSupported())return c.warn("[ClientApiHandler]: The updateTenantName operation is not supported by the backend"),void l(d,e.ReturnCode.OPERATION_NOT_SUPPORTED);var f={type:e.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.uploadExtensionConfiguration=function(a,d){d=d||x,c.debug("[ClientApiHandler]: uploadExtensionConfiguration...");var f={type:e.AdministrationActionType.UPLOAD_EXTENSION_CONFIGURATION,uploadExtensionConfiguration:{configuration:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.uploadExtensionConfiguration)})},this.getTenantExtensions=function(a){a=a||x,c.debug("[ClientApiHandler]: getTenantExtensions...");var d={type:e.AdministrationActionType.GET_TENANT_EXTENSIONS};b(e.ContentType.ADMINISTRATION,d,function(b,c){k(b,c,a,!0)&&a(null,c.administration.getTenantExtensions.extensions)})},this.deleteExtension=function(a,d){d=d||x,c.debug("[ClientApiHandler]: deleteExtension...");var f={type:e.AdministrationActionType.DELETE_EXTENSION,deleteExtension:{extensionId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null,b.administration.deleteExtensionResult.extensionConfigurationUrl)})},this.setExtensionState=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: setExtensionState...");var g={type:e.AdministrationActionType.SET_EXTENSION_STATE,setExtensionState:{extensionId:a,state:d}};b(e.ContentType.ADMINISTRATION,g,function(a,b){k(a,b,f)&&f(null,b.administration.setExtensionStateResult.extensionConfigurationUrl)})},this.getExchangeSettings=function(a){a=a||x,c.debug("[ClientApiHandler]: getExchangeSettings...");var d={type:e.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:e.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}},f=["response.thirdpartyconnectors.getSettings.exchange"];b(e.ContentType.THIRDPARTYCONNECTORS,d,function(b,c){k(b,c,a)&&a(null,c.thirdpartyconnectors.getSettings.exchange)},null,f)},this.saveExchangeSettings=function(a,d){d=d||x,c.debug("[ClientApiHandler]: saveExchangeSettings..."),A&&(a.encryptionKey=String(Date.now()));var f={type:e.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:e.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:a}},g=["request.thirdpartyconnectors.saveSettings.exchange"],h=["response.thirdpartyconnectors.saveSettings.exchange"];b(e.ContentType.THIRDPARTYCONNECTORS,f,function(a,b){k(a,b,d)&&d(null,b.thirdpartyconnectors.saveSettings.exchange)},g,h)},this.saveOpenXchangeSettings=function(a,d){d=d||x,c.debug("[ClientApiHandler]: saveOpenXchangeSettings...");var f={type:e.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:e.ThirdPartyConnectorType.OPEN_XCHANGE,openXchange:a}},g=["request.thirdpartyconnectors.saveSettings.openXchange"],h=["response.thirdpartyconnectors.saveSettings.openXchange"];b(e.ContentType.THIRDPARTYCONNECTORS,f,function(a,b){k(a,b,d)&&d(null,b.thirdpartyconnectors.saveSettings.openXchange)},g,h)},this.connectToThirdParty=function(a,d){d=d||x,c.debug("[ClientApiHandler]: connectToThirdParty "+a+"...");var f;switch(a){case e.ThirdPartyConnectorType.BOX:case e.ThirdPartyConnectorType.SYNCPLICITY:case e.ThirdPartyConnectorType.GOOGLE_DRIVE:f={type:e.ThirdPartyConnectorsActionType.CONNECT,connect:{type:a}};break;default:return void l(d,e.ThirdPartyError.UNSUPPORTED_PROVIDER)}b(e.ContentType.THIRDPARTYCONNECTORS,f,function(a,b){k(a,b,d)&&(b.thirdpartyconnectors.connect?d(null,b.thirdpartyconnectors.connect.authorizeUrl):d(e.ThirdPartyError.UNSUPPORTED_PROVIDER))})},this.getFolderItems=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getFolderItems for ",a.provider);var f;switch(a.provider){case e.ThirdPartyConnectorType.BOX:case e.ThirdPartyConnectorType.OPEN_XCHANGE:f={type:e.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:a.provider,id:a.folderId,index:a.indexCursor,pageSize:a.pageSize}};break;case e.ThirdPartyConnectorType.GOOGLE_DRIVE:case e.ThirdPartyConnectorType.SYNCPLICITY:f={type:e.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:a.provider,syncpointId:a.syncpointId||void 0,id:a.folderId,cursor:a.indexCursor,pageSize:a.pageSize}};break;default:return void l(d,e.ThirdPartyError.UNSUPPORTED_PROVIDER)}b(e.ContentType.THIRDPARTYCONNECTORS,f,function(b,c){k(b,c,d)&&d(null,{folder:a.folderId,items:c.thirdpartyconnectors.getFolderItemsResult})})},this.getConnectionStatus=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getConnectionStatus "+a+"...");var f={type:e.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:a}};b(e.ContentType.THIRDPARTYCONNECTORS,f,function(a,b){k(a,b,d)&&d(null,b.thirdpartyconnectors.getConnectionStatus.connected)})},this.disconnectFromThirdParty=function(a,d){d=d||x,c.debug("[ClientApiHandler]: disconnectFromThirdParty "+a+"...");var f;switch(a){case e.ThirdPartyConnectorType.BOX:case e.ThirdPartyConnectorType.OPEN_XCHANGE:case e.ThirdPartyConnectorType.SYNCPLICITY:case e.ThirdPartyConnectorType.GOOGLE_DRIVE:f={type:e.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:a}};break;default:return void l(d,e.ThirdPartyError.UNSUPPORTED_PROVIDER)}b(e.ContentType.THIRDPARTYCONNECTORS,f,function(a,b){k(a,b,d)&&d(null)})},this.getSharedItems=function(a,d){if(d=d||x,!a)return void l(d,e.ReturnCode.MISSING_REQUIRED_PARAMETER);var f=a.provider,g=a.itemsData;c.debug("[ClientApiHandler]: getSharedItems "+f+"...");var h;switch(f){case e.ThirdPartyConnectorType.BOX:case e.ThirdPartyConnectorType.OPEN_XCHANGE:case e.ThirdPartyConnectorType.GOOGLE_DRIVE:case e.ThirdPartyConnectorType.SYNCPLICITY:h={type:e.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:f,shareItems:g,conversationId:a.convId}};break;default:return void l(d,e.ThirdPartyError.UNSUPPORTED_PROVIDER)}b(e.ContentType.THIRDPARTYCONNECTORS,h,function(a,b){k(a,b,d)&&d(null,b.thirdpartyconnectors.shareFolderItems)})},this.unshareItems=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: ushareItems "+a+"...");var g;switch(a){case e.ThirdPartyConnectorType.OPEN_XCHANGE:case e.ThirdPartyConnectorType.SYNCPLICITY:g={type:e.ThirdPartyConnectorsActionType.UNSHARE_FOLDER_ITEMS,unshareFolderItems:{type:a,fileId:d}};break;default:return void l(f,e.ThirdPartyError.UNSUPPORTED_PROVIDER)}b(e.ContentType.THIRDPARTYCONNECTORS,g,function(a,b){k(a,b,f)&&f(null)})},this.getEditUrl=function(a,d){c.debug("[ClientApiHandler]: getEditUrl "+a.provider);var f;switch(a.provider){case e.ThirdPartyConnectorType.OPEN_XCHANGE:f={type:e.ThirdPartyConnectorsActionType.GET_EDIT_URL,getEditUrl:{externalAttachment:{type:a.provider,downloadLocation:a.uri,previewLocation:a.uri,attachment:{fileId:a.fileId,fileName:a.fileName,size:a.size,mimeType:a.mimeType}}}};break;default:return void l(d,e.ThirdPartyError.UNSUPPORTED_PROVIDER)}b(e.ContentType.THIRDPARTYCONNECTORS,f,function(a,b){k(a,b,d)&&d(null,b.thirdpartyconnectors.getEditUrlResult.url)})},this.getStorageAuthenticationData=function(a,d,f){if(f=f||x,c.debug("[ClientApiHandler]: getStorageAuthenticationData..."),a!==e.ThirdPartyConnectorType.SYNCPLICITY)return void l(f,e.ThirdPartyError.UNSUPPORTED_PROVIDER);var g={type:e.ThirdPartyConnectorsActionType.CONNECT_STORAGE,connectStorage:{type:e.ThirdPartyConnectorType.SYNCPLICITY,endpointUrls:d}};b(e.ContentType.THIRDPARTYCONNECTORS,g,function(a,b){k(a,b,f)&&f(null,b.thirdpartyconnectors.connectStorageResult.storageAuthenticationData)})};this.getGlobalProperty=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getGlobalProperty...");var f={type:e.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:a}};b(e.ContentType.SYSTEM,f,function(a,b){k(a,b,d)&&d(null,b.system.getGlobalPropertyResult.property)})};this.getGlobalProperties=function(a,d){d=d||x,a instanceof Array||(a=[a]),c.debug("[ClientApiHandler]: getGlobalProperties...");var f={type:e.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:a}};b(e.ContentType.SYSTEM,f,function(a,b){k(a,b,d)&&d(null,b.system.getGlobalPropertiesResult.property)})},this.validateSessionInvite=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: validateSessionInvite...");var g={type:e.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:a},configurableTextsLanguage:d||void 0}},h=["response.guest.validateSessionInviteToken.convTopic"];b(e.ContentType.GUEST,g,function(a,b){k(a,b,f)&&f(null,b.guest.validateSessionInviteToken)},null,h)},this.registerSessionGuest=function(a,d){d=d||x,c.debug("[ClientApiHandler]: registerSessionGuest...");var f={type:e.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:a.token},firstName:a.firstName,lastName:a.lastName,forTestCall:a.testCall,locale:a.locale}},g=["response.guest.registerSessionGuestResult.guestContext"];b(e.ContentType.GUEST,f,function(a,b){if(k(a,b,d)){var c=b.guest.registerSessionGuestResult;B=h.convertVersionToNumber(c.apiVersion),r=c.clientId,s=c.userId,d(null,c)}},null,g)},this.sendUserToUserRequest=function(a,d,f){if(f=f||x,c.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+a+", data: ",d),a===e.UserRoutingMessageType.SDK&&!y.isSdkUserToUserSupported())return c.warn("[ClientApiHandler]: The sendUserToUserRequest operation of type SDK is not supported by the backend"),void l(f,e.ReturnCode.OPERATION_NOT_SUPPORTED);var g={type:e.ContentType.USER_TO_USER,userToUser:{type:a,routing:{destUserId:d.destUserId,srcUserId:s,destClientId:d.destClientId,srcClientId:r},data:JSON.stringify(d.content)}},h=["request.userToUser.userToUser.data"];b(e.ContentType.USER_TO_USER,g,function(a,b){k(a,b,f)&&f(null,b.userToUser)},h)},this.getPackages=function(a){a=a||x,c.debug("[ClientApiHandler]: getPackages...");var d={type:e.AccountActionType.GET_ASSIGNED_PACKAGES};b(e.ContentType.ACCOUNT,d,function(b,c){k(b,c,a)&&a(null,c.account.getAssignedPackages.packages||[])})},this.getAccounts=function(a,d){d=d||x,c.debug("[ClientApiHandler]: getAccounts...");var f={type:e.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:a.searchCriterias,sorting:a.sorting,ordering:a.ordering,searchPointer:a.searchPointer,pageSize:a.pageSize,excludedTags:a.excludedTags}},g=["response.administration.getAccounts.accounts"];b(e.ContentType.ACCOUNT,f,function(a,b){k(a,b,d)&&d(null,b.account.getAccounts)},null,g)},this.migrateAccount=function(a,d){d=d||x,c.debug("[ClientApiHandler]: migrateAccount...");var f={type:e.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:a.accountId,accountTemplateId:a.accountTemplateId}};b(e.ContentType.ACCOUNT,f,function(a,b){k(a,b,d)&&d(null,b.account.migrateAccount)})},this.migrateMultipleUsers=function(a,d){d=d||x,c.debug("[ClientApiHandler]: migrateMultipleUsers...");var f={type:e.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:a.accountIds,accountTemplateId:a.accountTemplateId}};b(e.ContentType.ACCOUNT,f,function(a,b){k(a,b,d)&&d(null,b)})},this.suspendAccount=function(a,d){d=d||x,c.debug("[ClientApiHandler]: suspendAccount...");var f={type:e.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:a}};b(e.ContentType.ACCOUNT,f,function(a,b){k(a,b,d)&&d(null)})},this.unsuspendAccount=function(a,d){d=d||x,c.debug("[ClientApiHandler]: unsuspendAccount...");var f={type:e.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:a}};b(e.ContentType.ACCOUNT,f,function(a,b){k(a,b,d)&&d(null)})},this.suspendUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: suspendUser...");var f={type:e.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.unsuspendUser=function(a,d){d=d||x,c.debug("[ClientApiHandler]: unsuspendUser...");var f={type:e.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:a}};b(e.ContentType.ADMINISTRATION,f,function(a,b){k(a,b,d)&&d(null)})},this.assignTelephonyConfiguration=function(a,d,f){f=f||x,c.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var g={type:e.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:a,configuration:{phoneNumber:h.cleanPhoneNumber(d.phoneNumber),callerId:h.cleanPhoneNumber(d.callerId),reroutingPhoneNumber:h.cleanPhoneNumber(d.reroutingPhoneNumber),onsSipAuthenticationHash:d.onsSipAuthenticationHash||"",ondSipAuthenticationHash:d.ondSipAuthenticationHash||"",associatedTelephonyUserID:d.associatedTelephonyUserID||"",associatedTelephonyUserType:d.associatedTelephonyUserType||void 0}}},i=["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"];b(e.ContentType.ACCOUNT,g,function(a,b){k(a,b,f)&&f(null)},i)},this.getTechnicalAdminUserId=function(a){a=a||x,c.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var d={type:e.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};b(e.ContentType.ACCOUNT,d,function(b,c){k(b,c,a)&&a(null,c.account.getTechnicalAdminUserIdResult.technicalAdminUserId)})},this.getUserData=function(a){a=a||x,c.debug("[ClientApiHandler]: getUserData...");var d={type:e.UserDataActionType.GET_USER_DATA};b(e.ContentType.USER_DATA,d,function(b,c){k(b,c,a)&&a(null,c.userData)})}}var c=a.logger,d=a.ConnectionHandler,e=a.Constants,f=a.PrivateData,g=a.Proto,h=a.Utils,i=a.storeManager;return b.prototype.constructor=b,b.prototype.name="ClientApiHandler",a.ClientApiHandler=b,a}(Circuit),Circuit=function(a){"use strict";return a.ClientApiHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.ClientApiHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(a,b){if(b){var c=window.setTimeout(function(a){e.error("[UserToUserHandler]: Timeout waiting for request response. RequestId:",a),k[a]&&(delete k[a],b(d.ReturnCode.REQUEST_TIMEOUT),e.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(k).length))},j,a);k[a]={cb:b,timer:c}}}function g(a){a&&window.setTimeout(function(){a(d.ReturnCode.INVALID_MESSAGE)},0)}function h(a,c,h){return c&&c.content&&c.content.type?(e.debug("[UserToUserHandler]: Sending request "+a+"."+c.content.type),c.content.requestId=c.content.requestId||f.createTransactionId(),k[c.content.requestId]?(e.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void g(h)):void m.sendUserToUserRequest(a,c,function(f){return f?(e.error("[UserToUserHandler]: Failed to send request: ",f),void(h&&h(f))):void(a===d.UserRoutingMessageType.SDK?h&&h():b(c.content.requestId,h))})):(e.error("[UserToUserHandler]: Invalid UserToUser request data - ",c),void g(h))}function i(a,b){try{if(b.routing&&b.routing.srcClientId===m.clientId)return void e.info("[UserToUserHandler]: Ignore own UserToUser event");var c;try{c=JSON.parse(b.data)}catch(a){return void e.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(c.requestId){var f=k[c.requestId];if(f)return f.timer&&window.clearTimeout(f.timer),delete k[c.requestId],f.cb&&f.cb(null,c),void e.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(k).length);var g=a+"."+c.type,h=l[g];h&&0!==h.length?(a===d.UserRoutingMessageType.SDK&&(c=c.message),h.forEach(function(a){
a.cb(c,b.routing)})):e.info("[UserToUserHandler]: There is no registered event handler for ",g)}}catch(a){e.error("[UserToUserHandler]: Exception handling UserToUser event. ",a)}}var j=2e4,k={},l={},m=a||c.getInstance();m.on("UserToUser.ATC",function(a){e.debug("[UserToUserHandler]: Received UserToUser.ATC event: ",a.data),i(d.UserRoutingMessageType.ATC,a)}),m.on("UserToUser.DESKTOP_APP",function(a){e.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",a.data),i(d.UserRoutingMessageType.DESKTOP_APP,a)}),m.on("UserToUser.CONTACT_CARD",function(a){e.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",a.data),i(d.UserRoutingMessageType.CONTACT_CARD,a)}),m.on("UserToUser.CMP",function(a){e.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",a.data),i(d.UserRoutingMessageType.CMP,a)}),m.on("UserToUser.MOBILE_BREAKOUT",function(a){e.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",a.data),i(d.UserRoutingMessageType.MOBILE_BREAKOUT,a)}),m.on("UserToUser.SDK",function(a){e.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",a.data),i(d.UserRoutingMessageType.SDK,a)}),this.cancelReqCallback=function(a){var b=k[a];b&&(b.cb=null)},this.sendAtcRequest=function(a,b){h(d.UserRoutingMessageType.ATC,a,b)},this.sendContactCardRequest=function(a,b){h(d.UserRoutingMessageType.CONTACT_CARD,a,b)},this.sendDesktopAppRequest=function(a,b){h(d.UserRoutingMessageType.DESKTOP_APP,a,b)},this.sendMeetingPointRequest=function(a,b){h(d.UserRoutingMessageType.CMP,a,b)},this.sendMobileBreakoutEvent=function(a,b){h(d.UserRoutingMessageType.MOBILE_BREAKOUT,a,b)},this.sendSdkRequest=function(a,b){a&&a.content&&delete a.content.requestId,h(d.UserRoutingMessageType.SDK,a,b)},this.on=function(a,b){if(a&&"function"==typeof b){l[a]=l[a]||[];var c=l[a].some(function(a){return a.cb===b});c||l[a].push({cb:b})}},this.off=function(a,b){if(a||b)if(b){if(a&&"function"==typeof b){var c=l[a];c&&c.some(function(a,d){if(a.cb===b)return c.splice(d,1),!0})}}else delete l[a];else l={}}}var c=a.ClientApiHandlerSingleton,d=a.Constants,e=a.logger,f=a.Utils,g=Object.freeze({CSTA:"CSTA",PRIMARYCLIENT:"PRIMARYCLIENT",INFO:"INFO"}),h=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",GET_GTC_VERSION_RESPONSE:"GET_GTC_VERSION_RESPONSE"}),i=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE"}),j=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED"}),k=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",START_HD_VIDEO_REQUEST:"START_HD_VIDEO_REQUEST",START_HD_VIDEO_RESPONSE:"START_HD_VIDEO_RESPONSE"}),l=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED"}),m=Object.freeze({DIAL:"DIAL"});return b.prototype.constructor=b,b.prototype.name="UserToUserHandler",a.UserToUserHandler=b,a.Enums=a.Enums||{},a.Enums.AtcInfoMessage=h,a.Enums.AtcMessage=g,a.Enums.ContactCardMessage=i,a.Enums.ContactCardResponseCode=j,a.Enums.MeetingPointMessage=k,a.Enums.MeetingPointResponseCode=l,a.Enums.MobileBreakoutMessage=m,a}(Circuit),Circuit=function(a){"use strict";return a.UserToUserHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.UserToUserHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";function b(){function a(a,b){a=a||function(){};var c=++s,f=window.setTimeout(function(){r[c]&&(e.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",c),delete r[c],a(d.ResponseError.TIMEOUT))},b||m);return r[c]={cb:a,timer:f},c}function c(a){return!(!a||!r[a])&&(delete r[a],!0)}function g(a){var b;if(a.target===d.BgTarget.INTERNAL)switch(a.data.type){case d.BgInternalMsgType.INIT_MSG:e.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),t=!0,i({target:d.BgTarget.INTERNAL,data:{type:d.BgInternalMsgType.INIT_MSG_ACK}}),e.info("[ExtensionConnHandler]: Dispatching event: extensionInitialized"),b=q.createEvent("extensionInitialized"),b.data=a.data,q.dispatch(b);break;case d.BgInternalMsgType.EXTENSION_DISCONNECTED:e.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),k();break;default:e.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type from ansible-content:",a.data.type)}else if(a.target===d.BgTarget.HEADSET_APP)switch(a.data.type){case d.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:e.info("[ExtensionConnHandler]: Dispatching event: headsetAppLaunched"),b=q.createEvent("headsetAppLaunched"),b.data=a.data,q.dispatch(b);break;case d.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:e.info("[ExtensionConnHandler]: Dispatching event: headsetAppUninstalled"),b=q.createEvent("headsetAppUninstalled"),b.data=a.data,q.dispatch(b);break;default:e.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type from ansible-content:",a.data.type)}else a.suppressLog||e.info("[ExtensionConnHandler]: Dispatching event:",a.target),b=q.createEvent(a.target),b.data=a.data,b.suppressLog=a.suppressLog,a.reqId&&a.type===d.BgMsgType.REQUEST&&(b.reqId=a.reqId),q.dispatch(b)}function h(a){if(r[a.reqId]){var b=r[a.reqId];b.timer&&window.clearTimeout(b.timer),delete r[a.reqId],a.data&&a.data.error?(b.cb(a.data.error),a.data.error===d.ResponseError.UNREGISTERED&&k()):b.cb(null,a.data),a.suppressLog||e.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(r).length)}else e.info("[ExtensionConnHandler]: No registered callback for reqId =",a.reqId)}function i(a,b,c,d){return a?q.isExtensionRunning()?j(a,b,c,d):(e.info("[ExtensionConnHandler]: Chrome extension is not running"),b&&window.setTimeout(function(){b("Extension not running")},0),!1):(e.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),b&&window.setTimeout(function(){b("Invalid message")},0),!1)}function j(b,c,f,g){b.type===d.BgMsgType.REQUEST&&(b.reqId=a(c,f)),g||e.msgSend("[ExtensionConnHandler]: ",b),b.suppressLog=g;var h=new CustomEvent(d.DOMEvent.TO_EXTENSION,{detail:JSON.stringify(b)});try{document&&document.dispatchEvent(h)}catch(a){return e.warning("[ExtensionConnHandler]: Error sending message: "+h,a),!1}return b.reqId}function k(){e.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),t=!1,e.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var a=q.createEvent("extensionUnregistered");q.dispatch(a)}function l(a){var b=null;try{b=JSON.parse(a.detail)}catch(a){return void e.warning("[ExtensionConnHandler]: Error parsing JSON object",a)}if(b.target===d.BgTarget.LOG)return void e.logMsg(b.data.log.level,b.data.log.messages);switch(b.suppressLog||e.msgRcvd("[ExtensionConnHandler]: ",b),b.type){case d.BgMsgType.REQUEST:case d.BgMsgType.EVENT:g(b);break;case d.BgMsgType.RESPONSE:h(b);break;default:e.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",b.type)}}b.parent.constructor.call(this,e);var m=5e3,n=65e3,o=18e4,p=18e4,q=this,r={},s=0,t=!1;this.isExtensionRunning=function(){return t},this.getScreenShareUserMedia=function(a){i({target:d.BgTarget.SCREEN_SHARE,type:d.BgMsgType.REQUEST,data:{type:d.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},a)},this.exchangeConnect=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.CONNECT,object:{settings:a}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},b,o)},this.exchangeDisconnect=function(a){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.DISCONNECT,object:{}}},a,n)},this.exchangeGetConnectionStatus=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},b,n)},this.exchangeGetCapabilities=function(a){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.GET_CAPABILITIES}},a,n)},this.exchangeCancelReqCallback=function(a){return e.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",a),c(a)},this.exchangeSearchContacts=function(a,b,c,e){return i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:b,resultCount:c}},keysToOmitFromLogging:["data.key"]},e,n)},this.exchangeResolveContact=function(a,b,c){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.RESOLVE_CONTACT,object:b},keysToOmitFromLogging:["data.key"]},c,n)},this.exchangeGetContact=function(a,b,c){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_CONTACT,object:{email:b}},keysToOmitFromLogging:["data.key"]},c,n)},this.exchangeStoreCredentials=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{method:d.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:a},keysToOmitFromLogging:["data.object"]},b,n)},this.getAllPersonalContacts=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},b,n)},this.getAppointments=function(a,b,c,e,f){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_APPOINTMENTS,startDate:b,endDate:c,resCount:e},keysToOmitFromLogging:["data.key"]},f,n)},this.syncAllPersonalContacts=function(a,b,c){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:b},keysToOmitFromLogging:["data.key","data.syncState"]},c,n)},this.getStoredCredentials=function(a,b){i({target:d.BgTarget.EXCHANGE_CONNECTOR,type:d.BgMsgType.REQUEST,data:{key:a,method:d.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},b,n)},this.getHeadsetIntegrationAppStatus=function(a,b){i({target:d.BgTarget.HEADSET_APP,type:d.BgMsgType.REQUEST,data:{type:d.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:a}},b,m)},this.launchHeadsetIntegrationApp=function(a,b,c){i({target:d.BgTarget.HEADSET_APP,type:d.BgMsgType.REQUEST,data:{type:d.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:a,localizedStrings:b}},c,p)},this.bringToFront=function(a){i({target:d.BgTarget.INTERNAL,type:d.BgMsgType.REQUEST,data:{type:d.BgInternalMsgType.BRING_TO_FRONT}},a)},f.getBrowserInfo().chrome&&document&&document.addEventListener(d.DOMEvent.FROM_EXTENSION,l)}var c=a.BaseEventTarget,d=a.ChromeExtension,e=a.logger,f=a.Utils;return f.inherit(b,c),b.prototype.name="ExtensionConnHandler",a.ExtensionConnHandler=b,a}(Circuit),Circuit=function(a){"use strict";return a.ExtensionConnHandlerSingleton=function(){var b;return{getInstance:function(){return b||(b=new a.ExtensionConnHandler),b}}}(),a}(Circuit),Circuit=function(a){"use strict";return a.Enums.CallStateName={},Object.getOwnPropertyNames(a.Enums.CallState).forEach(function(b){a.Enums.CallStateName[b]=b}),a.Enums.ConversationItemType=a.Constants.ConversationItemType,a.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},a.Enums.PresenceState=a.Constants.PresenceState,a.Enums.RTCItemType=a.Constants.RTCItemType,a.Enums.RTCParticipantType=a.Constants.RTCParticipantType,a.Enums.SystemItemType=a.Constants.SystemItemType,a.Enums.TextItemContentType=a.Constants.TextItemContentType,a.Enums.UserType=a.Constants.UserType,a.Enums.UserState=a.Constants.UserState,a.Enums.SearchDirection=a.Constants.SearchDirection,a.Enums.ParticipantCriteria=a.Constants.GetConversationParticipantCriteria,a.Enums.ConversationParticipantType=a.Constants.ConversationParticipantType,a}(Circuit||{}),Circuit=function(a){"use strict";function b(b,d,e){function f(){return null}function g(){if(!b.localUser||!b.localUser.accounts||!b.localUser.accounts[0])return!1;var a=b.localUser,c=b.localUser.accounts[0],d=a.callerId;return c.telephonyConfiguration?(a.phoneNumber=c.telephonyConfiguration.phoneNumber||null,c.telephonyConfiguration.associatedTelephonyUserType===k.GtcTrunkType.ATC_TRUNK_TYPE?(a.callerId=c.telephonyConfiguration.phoneNumber,a.cstaNumber=m.cleanPhoneNumber(c.telephonyConfiguration.phoneNumber)):(a.callerId=c.telephonyConfiguration.callerId||a.phoneNumber||p,a.cstaNumber=null)):(a.phoneNumber=null,a.callerId=p,a.cstaNumber=null),d!==a.callerId}function h(){return new Promise(function(a,b){r.getTelephonyData(function(c,d){c?b(c):(q=d,p=q.defaultCallerId||null,a(d))})})}function i(){return new Promise(function(a,b){r.getTelephonyConversationId(function(c,d){c||!d?b("Telephony conversation not found"):n.getConversationById(d,null,function(c,d){c||!d?b(c||"Error retrieving telephony conversation"):(j=d,d.isTelephonyConv=!0,a(d))})})})}var j,k=a.Constants,l=a.Conversation,m=a.Utils,n=this,o={},p=null,q={},r=a.ClientApiHandlerSingleton.getInstance();return this.addConversationToCache=function(a){a&&a.convId&&(o[a.convId]=l.extend(a))},this.setLocalUser=function(a){a&&(b.localUser=a,g())},this.getConversationPromise=function(a){return new Promise(function(b,c){if(!a)return void c();var d=o[a];d?b(d):n.getConversationById(a,null,function(a,d){a||!d?c("Conversation not found"):b(d)})})},this.getConversationById=function(a,b,c){"function"==typeof c&&r.getConversationById(a,function(a,b){var d=l.extend(b);d&&(o[b.convId]=d),c(a,d)})},this.getConversationByRtcSession=function(a){e.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",a);for(var b in o)if(o.hasOwnProperty(b)&&o[b].rtcSessionId===a)return o[b];return null},this.getConversationFromCache=function(a){return e.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",a),o[a]||null},this.getTelephonyConversation=function(a){if("function"==typeof a){if(j)return void window.setTimeout(function(){a(null,j)});h().then(g).then(i).then(function(b){a(null,b)}).catch(a)}},this.getTelephonyData=h,this.getTelephonyConversationPromise=function(){e.warn("[SdkHelperSvc]: getTelephonyConversationPromise - NOT SUPPORTED")},this.updateLastCallTime=function(){},this.sendQOSData=function(a,b,c){e.debug("[SdkHelperSvc]: sendQOSData - call stats: ",c)},this.getSetting=function(){return null},this.getUserIdleState=function(){return c.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.getUserFromCache=f,this.getUser=f,this.getUserById=function(a,b){b&&b(k.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(a,b){b&&b(null)},this}var c=Object.freeze({Idle:"Idle",Active:"Active"});return a.Enums=a.Enums||{},a.Enums.IdleState=c,a.SdkHelperSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b,d){return d.debug("New Service: UtilSvc"),this.promisify=function(a,c){return function(){var d=Array.prototype.slice.call(arguments);return new b(function(b,e){d.push(function(a){if(a)return e(a);var c=Array.prototype.slice.call(arguments);switch(c.shift(),c.length){case 0:b();break;case 1:b(c[0]);break;default:b(c)}}),a.apply(c,d)})}},this.getFaqUrl=function(b){if(a.localUser&&a.localUser.helpUrl&&c.DEFAULT_HELP_URL!==a.localUser.helpUrl)return a.localUser.helpUrl;var d="https://www.circuit.com/unifyportalfaqdetail"+(b?"?articleId="+b:"");return d},this}var c=a.Utils,d={AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",TELEPHONY:"103733"};return a.UtilSvcImpl=b,a.Enums=a.Enums||{},a.Enums.FaqArticle=d,a}(Circuit),Circuit=function(a){"use strict";function b(a){function b(b,c){try{c=c instanceof Array?c:[c],b.apply(null,c||[])}catch(b){a.error(b)}}function c(a,c,d){a[c]&&a[c].slice(0).forEach(function(a){b(a,d)})}function d(a,c){c=c?Array.prototype.slice.call(c):[],c.unshift(a),k.slice(0).forEach(function(a){b(a,c)})}function e(a,b,c){a[b]||(a[b]=[]),a[b].indexOf(c)===-1&&a[b].push(c)}function f(a,b,c){if(a[b]){var d=a[b].indexOf(c);d>=0&&a[b].splice(d,1)}}function g(a){k.indexOf(a)===-1&&k.push(a)}function h(a){var b=k.indexOf(a);b>=0&&k.splice(b,1)}a.debug("New Service: PubSubSvc");var i={},j={},k=[];return this.publish=function(b,e){(i[b]||j[b])&&(a.debug("[PubSubSvc]: Publishing "+b+" event"),c(i,b,e),c(j,b,e),d(b,e),delete j[b])},this.subscribe=function(a,b){e(i,a,b)},this.unsubscribe=function(a,b){f(i,a,b)},this.subscribeOnce=function(a,b){e(j,a,b)},this.unsubscribeOnce=function(a,b){f(j,a,b)},this.subscribeAll=function(a){g(a)},this.unsubscribeAll=function(a){h(a)},this.resetSubscriptions=function(){i={},j={},k=[]},this}return a.PubSubSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,f,g,h,i,j,k){function l(){if(b.browser&&b.browser.chrome){if(C="https://chrome.google.com/webstore/detail/",b.siemensAGUser)return D=!1,C+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",void i.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link");D=!0;var a=g.location.hostname;switch(a){case r:C+="jafbhekoolndfieffjkikfbmekjppnec",i.info("[ExtensionSvc]: Set URL to Beta-Circuit extension. ",C);break;case q:C+="ogdfpjnhdggplglemglldmioiblhkadm",i.info("[ExtensionSvc]: Set URL to Sandbox-Circuit extension. ",C);break;case t:C+="gdgfgnopapmocggkadgfkjekdlcohmdl",i.info("[ExtensionSvc]: Set URL to T&I-Circuit extension. ",C);break;case s:C+="mdgbjijndgkkllljdaoohenhhaenilam",i.info("[ExtensionSvc]: Set URL to T-Systems extension. ",C);break;default:C+="mhkbaognlahkdimlfcfhbeihldmjofgg",i.info("[ExtensionSvc]: Set URL to Circuit extension. ",C)}}}function m(){b.isChromeExtRunning=y.isExtensionRunning(),l()}function n(a,c,d){return i.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",a),z?z.isExtensionRunning()?(d&&(c=c||[],c.push(function(a,c){b.$apply(function(){d(a,c)})})),z[a].apply(z,c)):(i.debug("[ExtensionSvc]: Chrome extension is not running"),void(d&&f(function(){d("Extension not running")},0))):(i.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(d&&f(function(){d("No ExtensionConnHandler")},0)))}function o(){i.info("[ExtensionSvc]: Validate the installed extension version: ",A),A!==w&&(B=e.convertVersionToNumber(A)>=v,B||i.warn("[ExtensionSvc]: The installed extension version ("+A+") is not supported. Minimum version is "+u))}function p(a){return b.browser&&b.browser.chrome?E||F?(i.warn("[ExtensionSvc]: The first extension installation attempt failed. Redirect the user to web store page. Url: ",C),a&&k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[C]}),E?x.INSTALL_ALREADY_IN_PROGRESS:x.INSTALL_FAILED):B?null:(i.warn("[ExtensionSvc]: We are running an outdated extension:",A),a&&k.error({message:"res_UnsupportedExtensionVersion"}),x.UNSUPPORTED_EXT_VERSION):x.UNSUPPORTED_BROWSER}i.debug("New Service: ExtensionSvc");var q="circuitsandbox.net",r="beta.circuit.com",s="de.circuit.com",t="tandi.circuitsandbox.net",u="1.1.6500",v=e.convertVersionToNumber(u),w="electron",x=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",INSTALL_ALREADY_IN_PROGRESS:"INSTALL_ALREADY_IN_PROGRESS",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INSTALL_FAILED:"INSTALL_FAILED",INTERNAL_ERROR:"INTERNAL_ERROR"}),y=this,z="object"==typeof c?c.getInstance():null,A="",B=!0,C="",D=!1,E=!1,F=!1;return d.injectExtensionSvc(this,z),z&&z.addEventListener("extensionInitialized",function(a){b.$apply(function(){A=a.data.version,o(),B&&(E=!1,b.isChromeExtRunning=!0,i.setExtensionVersion(A),i.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),j.publish("/chromeExt/initialized"))})}),z&&z.addEventListener("extensionUnregistered",function(){b.$apply(function(){b.isChromeExtRunning=!1,i.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),j.publish("/chromeExt/unregistered")})}),z&&z.addEventListener("headsetAppLaunched",function(a){b.$apply(function(){var b=a.data&&a.data.data;i.debug("[ExtensionSvc]: Publish /chromeExt/headsetAppLaunched event: ",b),j.publish("/chromeExt/headsetAppLaunched",[b])})}),z&&z.addEventListener("headsetAppUninstalled",function(a){b.$apply(function(){var b=a.data&&a.data.data;i.debug("[ExtensionSvc]: Publish /chromeExt/headsetAppUninstalled event: ",b),j.publish("/chromeExt/headsetAppUninstalled",[b])})}),this.isExtensionRunning=function(){return z&&z.isExtensionRunning()&&B},this.getExtensionVersion=function(){return A},this.isExtensionVersionSupported=function(){return B},this.installExtension=function(a){return new h(function(b,c){if(y.isExtensionRunning())return void b();if(!k)return i.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void c(x.INTERNAL_ERROR);var d=p(a);if(d)return void c(d);var e={message:"res_ActionInstallExtensionText",controller:"ChromeExtensionInstallDialogCtrl",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0};k.confirm(e).result.then(b).catch(function(b){a&&b===x.INSTALL_FAILED&&(i.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",C),k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[C]})),c(b||x.USER_CANCELLED_INSTALL)})})},this.inlineInstallation=function(a){return new h(function(c,d){try{var e=p(a);if(e)return void d(e);if(i.debug("[ExtensionSvc]: Extension URL = ",C),!D)return i.debug("[ExtensionSvc]: Extension does not support inline installation. Open store link."),g.open(C),void c();chrome.webstore.install(C,function(){b.$apply(function(){i.debug("[ExtensionSvc]: Circuit extension was successfully installed"),E=!0,c()})},function(c){i.error("[ExtensionSvc]: There was an error installing the Circuit extension. ",c),b.$apply(function(){"User cancelled install"!==c?(F=!0,a&&(i.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",C),k.error({message:"res_ExtensionCannotBeInstalled",messageParams:[C]})),d(x.INSTALL_FAILED)):d(x.USER_CANCELLED_INSTALL)})})}catch(a){i.error("[ExtensionSvc]: There was an exception installing the Circuit extension. ",a),F=!0,d(x.INSTALL_FAILED)}})},this.addEventListener=function(a,b){z&&z.addEventListener(a,b)},this.exchangeGetConnectionStatus=function(a,b){return n("exchangeGetConnectionStatus",[a],b)},this.exchangeConnect=function(a,b){return n("exchangeConnect",[a],b)},this.exchangeSearchContacts=function(a,b,c,d){return n("exchangeSearchContacts",[a,b,c],d)},this.exchangeGetCapabilities=function(a){return n("exchangeGetCapabilities",[],a)},this.exchangeResolveContact=function(a,b,c){return n("exchangeResolveContact",[a,b],c)},this.exchangeGetContact=function(a,b,c){return n("exchangeGetContact",[a,b],c)},this.exchangeDisconnect=function(a){return n("exchangeDisconnect",[],a)},this.storeExchCredentials=function(a,b){return n("exchangeStoreCredentials",[a],b)},this.getStoredCredentials=function(a,b){return n("getStoredCredentials",[a],b)},this.getAllPersonalContacts=function(a,b){return n("getAllPersonalContacts",[a],b)},this.syncAllPersonalContacts=function(a,b,c){return n("syncAllPersonalContacts",[a,b],c)},this.exchangeCancelReqCallback=function(a){return n("exchangeCancelReqCallback",[a])},this.getAppointments=function(a,b,c,d,e){return n("getAppointments",[a,b,c,d],e)},this.supportsGetAppointments=function(){return y.isExtensionRunning()?A===w||e.convertVersionToNumber(A)>=1017800:!(!b.browser||!b.browser.chrome)},this.supportsExchangeAutodiscover=function(){return!!y.isExtensionRunning()&&(A===w||e.convertVersionToNumber(A)>=1017903)},this.launchHeadsetIntegrationApp=function(a,b,c){return n("launchHeadsetIntegrationApp",[a,b],c)},this.getHeadsetIntegrationAppStatus=function(a,b){return n("getHeadsetIntegrationAppStatus",[a],b)},this.bringToFront=function(b){if(!a.isElectron)return n("bringToFront",[],b);var c=require("electron").remote.getCurrentWindow();c.minimize(),c.show(),c.focus()},m(),this}var c=a.ExtensionConnHandlerSingleton,d=a.ScreenSharingController,e=a.Utils;return a.ExtensionSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(b,o,p,q,r,s,t,u,v,w,x){function y(){if(Gb){var a=1e3*(Gb.ttl||0);a=Math.max(a-ib,0),Gb.expirationTimestamp=Date.now()+a}}function z(a){return new r(function(c){var d=Gb&&Gb.expirationTimestamp||0;if(Date.now()<d){var e=new Date(d);return s.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+e),void c(Gb)}s.debug("[CircuitCallControlSvc]: Get new TURN credentials"),mb.renewTurnCredentials(a,function(a,d){b.$apply(function(){a?s.warn("[CircuitCallControlSvc]: Error renewing TURN credentials. Reusing old credentials."):d&&d.length&&(d=d[0],s.info("[CircuitCallControlSvc]: Received new TURN credentials:",d.turnServer),Gb=d,y()),c(Gb)})})})}function A(a,c){return new r(function(e,f){var g={convId:a.convId,rtcSessionId:c?c.callId:a.rtcSessionId,ownerId:a.creatorId,mediaNode:c.getMediaNode(),isTelephonyConversation:a.isTelephonyConv};mb.prepareSession(g,function(a,g,h){b.$apply(function(){if(a){if(a===d.ErrorCode.RTC_CONCURRENT_INCOMING_CALL)return s.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."),void f(a);if(a===d.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return s.warn("[CircuitCallControlSvc]: No media nodes available, call not possible."),void f(a);if(a===d.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE)return s.warn("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."),void f(a);s.warn("[CircuitCallControlSvc]: Error retrieving start session data. Reusing old credentials.")}else g&&g.length&&(s.info("[CircuitCallControlSvc]: Received new TURN credentials"),g=g[0],Gb=g,y());c&&h&&c.setCallIdForTelephony(h),e(Gb)})})})}function B(a){if(a){if(a.startsWith("res_"))return a;if(a===d.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(a===d.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(a===d.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(a===d.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return a}return"res_JoinRTCSessionFailed"}function C(){if(l.randomBoolean()){var a=pb.participants.filter(function(a){return a.pcState===e.ParticipantState.Active});if(!(a.length<2)){a.push(b.localUser);var c={sessionId:pb.callId},d=["first","second","third"],f=l.randomNumber(0,3),g=a.randomCopy(f);g.indexOf(a[0])===-1&&l.randomBoolean()&&(g.unshift(a[0]),f<3&&f++);for(var h=0;h<f;h++)c[d[h]]=g[h].userId;if(s.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",c),Ia(c),!(pb.sessionCtrl.getNumberOfExtraVideoChannels()>0||pb.hasRemoteScreenShare())){var i=g[0];i&&i.userId!==b.localUser.userId&&i.mediaType.video&&!i.streamId&&Ja({sessionId:pb.callId,userId:i.userId,videoStreamId:"mock"})}}}}function D(){return pb&&pb.isMocked&&!pb.isDirect&&pb.participants.length>1}function E(){!xb&&D()&&(xb=p(function(){s.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),D()?pb.isEstablished()&&C():(s.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),p.cancel(xb),xb=null)},2e3,0,!1))}function F(a,b){if(!a.checkState(e.CallState.Ringing)||(wb.push(a),!b)){for(var c=0;c<ob.length;c++)if(a.sameAs(ob[c]))return s.debug("[CircuitCallControlSvc]: Updating call with callId = "+a.callId),void(ob[c]=a);ob.push(a),a===pb&&E(),sb=null}}function G(a){var b;for(b=0;b<ob.length;b++)if(a.sameAs(ob[b])){ob.splice(b,1);break}for(b=0;b<wb.length;b++)if(a.sameAs(wb[b])&&!a.isHandoverInProgress){wb.splice(b,1);break}for(b=0;b<rb.length;b++)if(a.sameAs(rb[b])){rb.splice(b,1);break}a.isRemote?sb=null:(sb=a,tb=a.sessionCtrl&&a.sessionCtrl.isMuted())}function H(a){a&&a.state!==e.CallState.Terminated&&(s.debug("[CircuitCallControlSvc]: Publish /call/state event. state = ",a.state.name),t.publish("/call/state",[a]))}function I(a){if(pb&&pb.sameAs(a)){var b=lb.getIncomingCall();return!!(b&&b.replaces&&b.replaces.sameAs(a))}return!!(pb&&pb.replaces&&pb.replaces.sameAs(a))}function J(a,b,c){s.info("[CircuitCallControlSvc]: Terminating call...");var d=I(a);Wa(a),a.isRemote||(b&&(a.terminateReason=b),ja(a)),a.isRemote||ja(a),ya(a),G(a),a.terminate(),pb&&pb.sameAs(a)?(o.cancel(pb.terminateTimer),pb=N(!0),pb?qb=O(!0):(pb=O(!0),qb=null)):qb&&qb.sameAs(a)&&(o.cancel(qb.terminateTimer),qb=null);var e=v.getConversationFromCache(a.convId);if(e&&e.call&&e.call.sameAs(a)&&!a.isHandoverInProgress){if(a.isTelephonyCall){var f=N()||O();e.call=f||null}else e.call=null;v.updateLastCallTime(e),s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[e])}xb&&!pb&&(p.cancel(xb),xb=null),c||(s.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced:",d),t.publish("/call/ended",[a,d]))}function K(a){return pb&&pb.callId===a?pb:qb&&qb.callId===a?qb:null}function L(a){for(var b=0;b<ob.length;b++)if(ob[b].callId===a)return ob[b];for(b=0;b<wb.length;b++)if(wb[b].callId===a)return wb[b];var c=v.getConversationByRtcSession(a);return c&&c.call&&!c.call.isAtcRemote&&c.call.state.established&&c.call.callId===a?(ob.push(c.call),c.call):K(a)}function M(a,b){if(a.participantType===d.RTCParticipantType.TELEPHONY&&a.phoneNumber){var c=pb.getParticipant(a.userId);if(c&&c.phoneNumber&&c.phoneNumber===a.phoneNumber)return;u.startReverseLookUp(a.phoneNumber,function(c){if(b.isPresent()&&c){var d=pb.getParticipant(a.userId);d&&(d.firstName=c.firstName,d.lastName=c.lastName,d.resolvedUserId=c.userId,sa(b,d))}})}}function N(a){return ob.find(function(b){return b.isTelephonyCall&&b.state.established&&!b.isHolding()&&(!a||!b.isRemote)})||null}function O(a){return ob.find(function(b){return b.isTelephonyCall&&b.state.established&&b.isHolding()&&(!a||!b.isRemote)})||null}function P(a,b,c,d,e){if(e=e||function(){H(a)},a.setPeerUser(b,c,d),!d){var f=o(function(){f=null,a.isPresent()&&(e(),e=null)},kb,!1);u.startReverseLookUp(b,function(c){o.cancel(f),a.isPresent()&&(c?(a.setPeerUser(b,c.displayName,c.userId),e?e():H(a)):e&&e())})}}function Q(a,c){var f,h=(!a.participantType||a.participantType===d.RTCParticipantType.USER||a.participantType===d.RTCParticipantType.MEETING_POINT)&&a.userId!=="echo_"+b.localUser.userId;if(a.userId===b.localUser.userId?f=b.localUser:h&&(f=u.getUserFromCache(a.userId)),!f){a.userDisplayName=a.userDisplayName||a.phoneNumber||b.i18n.map.res_Unknown;var j=a.userDisplayName.split(" ");a.participantType===d.RTCParticipantType.MEETING_POINT?(a.lastName=j[0],a.location=j.splice(1).join(" ")):(a.firstName=j[0],a.lastName=j.splice(1).join(" ")),h?(f=bb.extend({userId:a.userId,firstName:a.firstName,lastName:a.lastName,displayName:a.displayName,location:a.location,userType:a.participantType===d.RTCParticipantType.MEETING_POINT?d.UserType.MEETING_POINT:d.UserType.REGULAR}),f.noData=!0,u.addUsersToCache(f,!0,!1)):(a.participantType===d.RTCParticipantType.SESSION_GUEST&&(a.userType=d.UserType.SESSION_GUEST),f=bb.extend(a),f.isSessionGuest&&(f.initials=((f.firstName[0]||"")+(f.lastName[0]||"")).toUpperCase()));
}var k=i.createFromUser(f,e.ParticipantState.Active);return k.streamId=a.videoStreamId||"",k.screenStreamId=a.screenStreamId||"",k.mediaType=g.getMediaType(a.mediaTypes||c),k.muted=a.muted||!k.mediaType.audio,k.participantType=a.participantType,k.screenSharePointerSupported=!!a.screenSharePointerSupported,k}function R(a,b){if(b&&b.length){var c=vb[a];c?c.turnServers=b:vb[a]={turnServers:b}}}function S(a){var b=vb[a];return b&&b.turnServers&&b.turnServers.length?b.turnServers:null}function T(a,c,d,g){if(d.callOut=!!d.callOut,d.handover=!!d.handover,!a)return s.warn("[CircuitCallControlSvc]: joinSession invoked without a valid conversation"),void g("Missing conversation");if(wb.length>=1)return void g("res_CannotJoinMultipleSessions");if(pb&&!d.replaces&&pb.isPresent()&&(!a.isTelephonyConv||ob.length>2))return void(pb.convId===a.convId?(s.warn("[CircuitCallControlSvc]: joinSession call already present for this conversation"),g("Call already present")):g("res_CannotJoinMultipleSessions"));if(a.isTelephonyConv){if(!d.handover&&(d.dialedDn=d.dialedDn?d.dialedDn.trim():null,!d.dialedDn))return void g("Missing Dialed DN");if(!b.localUser.callerId)return void g("Missing Caller ID")}s.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId:",d.callId||a.rtcSessionId);var h=new f(a);if(pb=h,pb.setCallIdForTelephony(d.callId),pb.setTransactionId(),pb.sessionCtrl.enableTrickleIce(),!b.isSessionGuest&&!b.localUser.isCMP||a.testCall||pb.sessionCtrl.useMaxNumberOfExtraVideoChannels(),(ub||a.isTelephonyConv)&&(s.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),pb.disableRemoteVideo()),pb.setState(e.CallState.Initiated),pb.direction=e.CallDirection.OUTGOING,pb.mediaType=c,d.replaces&&(pb.replaces=d.replaces),d.joiningGroupCall&&(pb.isJoiningGroupCall=!0),d.callOut&&(pb.setPeerUsersAsParticipants(),pb.isCallOut=!0),pb.isTelephonyCall)if(d.handover){var i=la(pb.callId);i&&!i.isAtcConferenceCall()&&(pb.atcCallInfo=i.atcCallInfo,P(pb,i.peerUser.phoneNumber,i.peerUser.displayName)),pb.handover=!0}else P(pb,d.dialedDn,d.toName,d.userId);var j,k=pb.sessionCtrl,m=function(c){k.onSessionDescription=null,pb.mediaType=k.getMediaConstraints();var f={convId:a.convId,rtcSessionId:pb.callId||a.rtcSessionId,ownerId:a.creatorId,sdp:c.sdp,mediaType:pb.mediaType,callOut:d.callOut,handover:d.handover,sendInviteCancel:!d.callOut,replaces:d.replaces&&d.replaces.callId,isTelephonyConversation:pb.isTelephonyCall,displayName:b.localUser.displayName,transactionId:pb.transactionId,screenSharePointerSupported:!(!pb.pointer||!pb.pointer.isEnabled)};pb.isTelephonyCall&&(f.fromDn=l.cleanPhoneNumber(b.localUser.callerId),f.fromName=b.localUser.displayName,f.fromUserId=b.localUser.userId,f.dialedDn=l.cleanPhoneNumber(d.dialedDn),f.toName=d.toName,f.toUserId=d.userId),b.localUser.hasTelephonyRole&&(f.fromName="Gru",f.fromDn="+19998455246"),mb.joinRtcCall(f,function(c){b.$apply(function(){if(c){var b=pb.replaces;J(pb,e.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED),b&&(pb=b),g(B(c))}else{if(s.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),a.call!==pb){var f=a.call;f&&f.isRemote&&!f.isAtcRemote&&(s.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),d.handover&&(pb.activeClient=f.activeClient,f.isTelephonyCall&&(pb.activeClient=f.activeClient,pb.atcCallInfo=f.atcCallInfo,P(pb,f.peerUser.phoneNumber,f.peerUser.displayName),pb.participants=f.participants)),J(f)),F(pb),a.call=pb,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[a]),H(pb),pb.conferenceCall&&(s.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),t.publish("/conference/participant/joining",[pb]))}g(null,d.warning,pb)}})})},n=function(a){if(a=B(a),s.warn("[CircuitCallControlSvc]: Failed to initiate call. ",a),pb===h){if(!d.handover){var b=pb.isDirect?"terminateRtcCall":"leaveRtcCall";mb[b](pb.callId,function(a){a&&s.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",a)})}pb.terminate(),pb=null}g(a)};j=!a.call||a.call!==pb&&!d.handover?A(a,pb):z(pb.callId),j.then(function(e){e&&(R(a.rtcSessionId,e.turnServer),k.setTurnUris(e.turnServer),k.setTurnCredentials(e)),k.warmup(c,null,function(){return pb?void b.$apply(function(){s.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),a.call&&(a.call.isRemote||d.handover)||(F(pb),a.call=pb,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[a]),H(pb)),k.onSessionDescription=m,xa(pb),k.start(c,null)}):void s.debug("[CircuitCallControlSvc]: Call has already been terminated")},function(a){b.$apply(n.bind(null,a))},d.screenConstraint)},n)}function U(a,c,d,e,f,g,h){var i=L(a);if(!i)return s.warn("[CircuitCallControlSvc]: changeMediaType - There is no local call"),void g("No active call");if(a!==i.callId)return s.info("[CircuitCallControlSvc]: changeMediaType - The given call ID does not match the local call"),void g("Invalid callId");if(!i.isEstablished())return s.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void g("Call not established");var j=i.sessionCtrl;if(!j.isConnStable())return void g("Connection not stable");var k=function(a){j.onSessionDescription=null,i.setTransactionId(c);var e={rtcSessionId:i.callId,sdp:a.sdp,mediaType:d,transactionId:i.transactionId,screenSharePointerSupported:!(!i.pointer||!i.pointer.isEnabled)};mb.changeMediaType(e,function(a){b.$apply(function(){a?(j.renegotiationFailed(),g(a)):s.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")})})};ja(i);var l=i.localMediaType.desktop;z(i.callId).then(function(a){j.setTurnCredentials(a),j.onSessionDescription=k;var c=f?j.holdCall:j.retrieveCall;null===f||c(function(a){ia(),a?g():(s.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),j.onSessionDescription=null,j.renegotiationFailed(),g("Error in hold/retrieve media"))})?null===f&&(j.changeMediaType(d,e,function(a,c){ia(),a?(l&&!i.localMediaType.desktop&&(s.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),t.publish("/screenshare/ended")),i.updateMediaDevices(),g()):b.$apply(function(){s.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",c),j.onSessionDescription=null,j.renegotiationFailed(),g(c||"Error changing media")})},h)||(g("Error changing media"),ia())):(g("Error in hold/retrieve media"),ia())})}function V(a,c,d,f){var g=pb.sessionCtrl;d=d||{};var h=function(h){function i(a){b.$apply(function(){a?(J(pb,e.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED),f(B(a))):(s.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),f(null,d.warning))})}g.onSessionDescription=null;var j={convId:a.convId,rtcSessionId:pb.callId||a.rtcSessionId,ownerId:a.creatorId,sdp:h.sdp,mediaType:c,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:a.isTelephonyConv,displayName:b.localUser.displayName,transactionId:pb.transactionId};j.sdp&&"offer"===j.sdp.type?mb.joinRtcCall(j,i):mb.answerRtcCall(j,i)};g.onSessionDescription=h,g.start(c,null)||(J(pb,e.CallClientTerminatedReason.RTC_SESSION_START_FAILED),f(B()))}function W(a,b){var c=null;return a&&(c=new h(a),c.setState(e.CallState.Started),F(c),a.call=c,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[a]),c.conferenceCall&&(s.debug("[CircuitCallControlSvc]: Publish /conference/started event"),t.publish("/conference/started",[c])),b||H(c)),c}function X(a){mb.declineRtcCall({convId:a.convId,rtcSessionId:a.sessionId,cause:d.InviteRejectCause.BUSY,transactionId:a.transactionId})}function Y(a,b){var c=new f(a,b.sessionId);c.setInstanceId(b.instanceId),c.setTransactionId(b.transactionId),s.debug("[CircuitCallControlSvc]: Publish /atccall/secondcall event."),t.publish("/atccall/secondcall",[c])}function Z(a,c,d,f){if(f=f||function(){},a=a||pb,G(a),!a||a.state!==e.CallState.Ringing&&a.state!==e.CallState.Answering)return s.debug("[CircuitCallControlSvc]: call invalid to be declined"),void f("Call Invalid");s.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",a.callId);var g={convId:a.convId,rtcSessionId:a.callId,cause:c.type,transactionId:a.transactionId},i=[a];if(c.err&&i.push(c.err),mb.declineRtcCall(g,function(a){b.$apply(function(){a?(s.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",a),f(a)):f()})}),!a.isDirect){var j=v.getConversationFromCache(a.convId);if(j){var k=new h(j);k.setState(e.CallState.Started),F(k),j.call=k,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[j]),H(k)}}s.debug("[CircuitCallControlSvc]: Publish /call/declining event"),t.publish("/call/declining",i),J(a,e.CallClientTerminatedReason.CLIENT_ENDED_PRFX+c.type,d)}function $(a,c,f,g,i){if(i=i||function(){},a=a||pb,!a)return s.debug("[CircuitCallControlSvc]: There is no local call"),void(i&&o(i));if(a.terminateTimer)return s.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(i&&o(i));if(a.checkState([e.CallState.Ringing,e.CallState.Answering]))return void Z(a,{type:c||d.InviteRejectCause.DECLINE},!1,i);s.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId:",a.callId);var j,k;return a.clearAtcHandoverInProgress(),a.activeClient?(j=v.getConversationFromCache(a.convId),j&&(k=new h(j),F(k),k.activeClient=a.activeClient,k.setState(e.CallState.ActiveRemote),pb.isTelephonyCall&&(k.atcCallInfo=pb.atcCallInfo,k.peerUser=pb.peerUser),na(k),j.call=k,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[j]),H(k)),void J(a,f)):(a.isDirect?mb.terminateRtcCall(a.callId,function(a){b.$apply(function(){a&&s.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",a),i&&i(a)})}):(j=v.getConversationFromCache(a.convId),j&&(k=new h(j),k.setState(e.CallState.Started),F(k),j.call=k,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[j]),H(k)),mb.leaveRtcCall(a.callId,function(a){b.$apply(function(){a&&s.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",a),i&&i(a)})})),g||(a.directCall?(s.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),t.publish("/call/terminating",[pb])):a.conferenceCall?(s.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),t.publish("/conference/leaving",[a])):(s.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),t.publish("/group/leaving",[a]))),void(a.outgoingFailed()?(a.terminateTimer=o(function(){a.terminateTimer=null,J(a,f)},gb),a.terminateReason=f):J(a,f)))}function _(a,c){return c=c||function(){},a.isDirect?(s.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),void o(c)):(s.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId:",a.callId),mb.terminateRtcCall(a.callId,function(d){b.$apply(function(){if(d&&(s.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",d),a===pb)){var b=v.getConversationFromCache(a.convId);if(b&&a.isEstablished()){var f=new h(b);f.setState(e.CallState.Started),F(f),b.call=f,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[b]),H(f)}}c&&c(d)})}),void(a===pb&&J(a,e.CallClientTerminatedReason.USER_ENDED)))}function aa(a,c){s.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId:",a.callId),a.isDirect?mb.terminateRtcCall(a.callId,function(a){b.$apply(function(){a&&s.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",a),c(a)})}):mb.leaveRtcCall(a.callId,function(a){b.$apply(function(){a&&s.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",a),c(a)})})}function ba(a,b,c){var d=a[b.StatText]||{};c===-1?d.reported?d.counter=++d.counter:d.counter&&(delete a[b.StatText],s.debug("[CircuitCallControlSvc]: issueCounter cleared:",b.StatText)):d.reported?(d.counter=0,d.value=c):d.counter?(d.counter=++d.counter,d.value=c):a[b.StatText]={statObj:b,counter:1,value:c}}function ca(a){var b=null,c=Object.keys(a);return c.forEach(function(c){var d=a[c];d.counter>=d.statObj.RecurrenceThreshold?d.reported?(delete a[c],s.debug("[CircuitCallControlSvc]: issueCounter cleared:",c)):(d.reported=!0,d.counter=0,b=b||{},b[c]=!0):d.reported&&(b=b||{},b[c]=!0)}),b}function da(a,b){var c=0,d=0;return b&&b.pl&&b.ps&&(c=b.pl,d=b.ps),(a.pl-c)/(a.ps-d||-1)}function ea(a,b){var c=0,d=0;return b&&b.pl&&b.pr&&(c=b.pl,d=b.pr),(a.pl-c)/(a.pr-d+a.pl-c||-1)}function fa(a,b){var c,d="[CircuitCallControlSvc]: statsReport: audioRtt="+(a.audio&&a.audio.rtt||"n/a")+" videoRtt="+((a.video.receive||a.video.transmit)&&a.video&&a.video.rtt||"n/a");a.audio&&(c=a.audio.receive,c&&(d+="\n audioReceive:  id="+c.id+" pl="+c.pl+" pr="+c.pr+" jr="+c.jr),c=a.audio.transmit,c&&(d+="\n audioTransmit: id="+c.id+" pl="+c.pl+" ps="+c.ps+" os="+c.os)),a.video&&(c=a.video.receive,c&&(d+="\n videoReceive:  id="+c.id+" pl="+c.pl+" pr="+c.pr),c=a.video.transmit,c&&(d+="\n videoTransmit: id="+c.id+" pl="+c.pl+" ps="+c.ps+" frs="+c.frs+" os="+c.os)),s.debug(d);var e;d="[CircuitCallControlSvc]: statsReport:\n",b.forEach(function(a,b){d+=0===b?" Audio issues:":"\n Video issues:";var c=Object.keys(a);c.length?(e=!0,c.forEach(function(b){d+=" "+b+"="+a[b].value+" count="+a[b].counter})):d+=" none"}),e&&s.info(d)}function ga(a){if(pb&&0!==a.length){pb.savedRTPStats||(pb.savedRTPStats=[],pb.audioIssues=[],pb.videoIssues=[]);var b=!1;a.forEach(function(a,c){var d,e=a.audio&&a.audio.transmit,f=a.audio&&a.audio.receive,g=pb.audioIssues[c]||{},h=pb.videoIssues[c]||{},i=pb.savedRTPStats[c]||{};i.audio&&i.audio.receive&&!pb.isVoicemail&&ba(g,db.NO_PACKETS_RECV,!(f.pr>i.audio.receive.pr)||-1);var j=db.GOOG_JITTER_RECEIVED,k=e&&e[j.StatName];ba(g,j,k&&k>=j.Threshold?k:-1),k=f&&f[j.StatName],ba(g,j,k&&k>=j.Threshold?k:-1),j=db.PACKET_LOSS_SEND,e&&e.pl&&e.ps&&(d=da(e,i.audio&&i.audio.transmit),ba(g,j,d>=j.Threshold?d:-1)),j=db.PACKET_LOSS_RECV,f&&f.pl&&f.pr&&(d=ea(f,i.audio&&i.audio.receive),ba(g,j,d>=j.Threshold?d:-1)),Ab>fb.DELAY_RTT_PROCESSING&&(j=db.GOOG_RTT,ba(g,j,a.audio&&a.audio.rtt>=j.Threshold?a.audio.rtt:-1)),e=a.video&&a.video.transmit,f=a.video&&a.video.receive,j=eb.PACKET_LOSS_SEND,e&&e.pl&&e.ps&&(d=da(e,i.video&&i.video.transmit),ba(h,j,d>=j.Threshold?d:-1)),j=eb.PACKET_LOSS_RECV,f&&f.pl&&f.pr&&(d=ea(f,i.video&&i.video.receive),ba(h,j,d>=j.Threshold?d:-1)),(e||f)&&Ab>fb.DELAY_RTT_PROCESSING&&(j=eb.GOOG_RTT,ba(h,j,a.video&&a.video.rtt>=j.Threshold?a.video.rtt:-1)),pb.savedRTPStats[c]=a,pb.audioIssues[c]=g,pb.videoIssues[c]=h;var l=ca(g),m=ca(h);(l||m)&&(b=!0,pb.qualityIssueDetected||(l=l||"none",m=m||"none",pb.qualityIssueDetected=!0,l.noPacketsReceived?(s.warn("[CircuitCallControlSvc]: processRTPStats - No packets received from remote peer"),Bb||t.publish("/call/rtp/noIncomingPackets",[pb.callId])):(s.warn("[CircuitCallControlSvc]: processRTPStats - Quality issues detected",[{audio:l},{video:m}]),Bb||t.publish("/call/rtp/threshholdExceeded/detected",[pb.callId]))))}),!b&&pb.qualityIssueDetected&&(s.debug("[CircuitCallControlSvc]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),pb.qualityIssueDetected=!1,Bb||t.publish("/call/rtp/threshholdExceeded/cleared",[pb.callId])),(pb.qualityIssueDetected||Ab%hb===0)&&pb.savedRTPStats.forEach(function(a,b){fa(a,[pb.audioIssues[b],pb.videoIssues[b]])}),Ab++}}function ha(){pb&&pb.sessionCtrl?pb.sessionCtrl.getRTPStatsForClientDiagnostics(!1,function(a,b){a?s.error("[CircuitCallControlSvc]: getStats error= ",a):ga(b)}):s.error("[CircuitCallControlSvc]:getFormattedRTPStats sessionCtrl error")}function ia(){null===yb&&null===zb&&(s.debug("[CircuitCallControlSvc]: waiting to start collecting RTPstats"),yb=o(function(){s.debug("[CircuitCallControlSvc]: start Collecting RTPStats"),yb=null,Ab=0,ha(),zb=q.setInterval(function(){ha()},fb.COLLECTION_INTERVAL)},fb.DELAY_UPON_ANSWER))}function ja(a){var b=a.mediaType;if(a)if(a.sessionCtrl){if(!yb&&!zb&&!a.terminateReason)return void s.info("[CircuitCallControlSvc]: Non established local call terminated. No QoS report generated because no disconnect reason was specified. CallId =",a.callId);a.sessionCtrl.isQosDataCollected()||a.sessionCtrl.getRTPStatsForClientDiagnostics(!0,function(c,d){c?s.warn("[CircuitCallControlSvc]: getStats for QoS error= ",c):x.sendQOSData(a,b,d)})}else s.warn("[CircuitCallControlSvc]:getFormattedRTPStats no sessionCtrl error");yb?(s.debug("[CircuitCallControlSvc]: cancel collecting RTPStats "),o.cancel(yb),yb=null):zb&&(s.debug("[CircuitCallControlSvc]: stop collecting RTPStats"),q.clearInterval(zb),zb=null,pb&&(pb.savedRTPStats&&s.debug("[CircuitCallControlSvc]: savedRTPStats =",pb.savedRTPStats),Bb||t.publish("/call/rtp/threshholdExceeded/cleared",[pb.callId]),pb.qualityIssueDetected=!1,pb.savedRTPStats=null))}function ka(a){if(!pb.isDirect){if(pb.sessionCtrl.hasMaxExtraVideoChannels())return void s.debug("[CircuitCallControlSvc]: We already have max number of extra video channels");var b=a&&a.participants.length;b||(b=pb.sessionCtrl.getNumberOfExtraVideoChannels()+2);var c=Math.max(pb.participants.length+1,b),d=pb.sessionCtrl.setExtraVideoChannelsForParticipants(c);d&&pb.isEstablished()&&(s.debug("[CircuitCallControlSvc]: The number of extra channels has increased. Trigger a media renegotiation."),U(pb.callId,null,pb.localMediaType,!1,null,function(a){a&&s.warn("[CircuitCallControlSvc]: Failed to renegotiate the media. Error: ",a)}))}}function la(a){var b=null;return rb.some(function(c){if(c.callId===a)return b=c,!0}),b}function ma(a){var b=null;return wb.some(function(c){if(c.callId===a)return b=c,!0}),b}function na(a){var b=rb.some(function(b,c){return b===a||b.callId===a.callId&&(rb[c]=a,!0)});b||rb.push(a)}function oa(a,c){if(c=c||function(){},pb){var d=pb.getParticipant(a);if(d)if(i.isActive(d)){var e={rtcSessionId:pb.callId,userId:a};mb.removeSessionParticipant(e,function(a){b.$apply(function(){a?(s.warn("[CircuitCallControlSvc]: Failed to remove participant"),c("res_RemoveParticipantFailed")):c()})})}else s.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",d.pcState.name),c("Participant not active");else s.error("[CircuitCallControlSvc]: call participant not found: ",a),c("Participant not found")}else c("No active call")}function pa(a,b){if(b.streamId){var c=0===a.sessionCtrl.getNumberOfExtraVideoChannels();a.isMocked&&!c||a.participants.forEach(function(c){c.streamId===b.streamId&&c.userId!==b.userId&&(c.streamId="",s.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[c.userId,b.streamId]),pb.setParticipantRemoteVideoURL(c),s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",c.userId),t.publish("/call/participant/updated",[a.callId,c,"mediaUpdate"]))})}}function qa(a,c){if(!b.isSessionGuest){var d=v.getConversationFromCache(a.convId);c.setActions(d,b.localUser),s.debug("[CircuitCallControlSvc]: Set participant actions. userId: "+c.userId+", actions: ",c.actions)}}function ra(a,b,c,d){var e=a.addParticipant(b,c,d);return e&&(pa(a,e),qa(a,e),b.noData&&!b.reqPending&&(s.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",b.userId),u.getUserById(b.userId,function(c,d){d&&(s.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",b.userId),a.isPresent()&&a.hasParticipant(b.userId)&&(b.firstName=d.firstName,b.lastName=d.lastName,s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",b.userId),t.publish("/call/participant/updated",[a.callId,b])))}))),e}function sa(a,b,c){var d=a.updateParticipant(b,c);return d&&(pa(a,d),qa(a,d)),d}function ta(a,b,c){var f=e.ParticipantState.Terminated;switch(c){case d.RTCSessionParticipantLeftCause.CONNECTION_LOST:f=e.ParticipantState.ConnectionLost;break;case d.RTCSessionParticipantLeftCause.REMOVED:f=e.ParticipantState.Removed;break;case d.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:f=e.ParticipantState.OffStage}a.setParticipantState(b,f);var g=a.removeParticipant(b);if(!a.hasOtherParticipants()){if(!a.conferenceCall)return s.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),t.publish("/group/terminated",[a]),void $(a,null,e.CallClientTerminatedReason.NO_USERS_LEFT,!0);a.setState(e.CallState.Waiting)}if(g){a.updateMediaType(),!a.isRemote&&g.isCMP&&g.isMeetingPointInvitee&&(a.setMeetingPointInviteState(!1),lb.enableRemoteAudio(a.callId)),a.conferenceCall&&(s.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),t.publish("/conference/participant/left",[a,c]));var h=c?{leftCause:c}:null;s.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),t.publish("/call/participant/removed",[a.callId,g,h])}H(a)}function ua(a,c){if(!a||!c||!c.state)return null;var e=a.recording;return e.state!==c.state?(e.notifyByCurtain=c.state===d.RecordingInfoState.START_PENDING||c.state===d.RecordingInfoState.STARTED&&e.state===d.RecordingInfoState.START_PENDING,e.notifyByUser=!e.notifyByCurtain||c.state===d.RecordingInfoState.START_PENDING&&e.state!==d.RecordingInfoState.STARTED):(e.notifyByCurtain=!1,e.notifyByUser=!1),e.state=c.state,e.duration=c.duration||e.duration,e.reason=c.reason,c.state===d.RecordingInfoState.STARTED&&(e.resumeTime=Date.now()),c.starter&&c.starter.userId&&c.starter.userId!==e.starter.userId&&(e.starter=c.starter,e.starter.userId===b.localUser.userId?e.starter.res="res_StartedRecording_You":(e.starter.name=e.starter.firstName||e.starter.displayName,e.starter.res=e.starter.name?"res_StartedRecording_Other":"res_StartedRecording")),e}function va(a,c,e,f,g,h,i){if(!a)return null;var j=a.recording;if(h===d.RecordingTriggerReason.CURTAIN?(j.notifyByUser=!1,j.notifyByCurtain=e,j.state=c?d.RecordingInfoState.STARTED:d.RecordingInfoState.START_PENDING):(j.notifyByUser=e,j.notifyByCurtain=!1,j.state=c?d.RecordingInfoState.STARTED:d.RecordingInfoState.STOPPED),j.duration=f||j.duration,j.reason=i,j.state===d.RecordingInfoState.STARTED&&(j.resumeTime=Date.now()),g&&g!==j.starter.userId)if(j.starter.userId=g,j.starter.name="",pb.isTestCall||g===b.localUser.userId)j.starter.res="res_StartedRecording_You";else{var k=pb.getParticipant(g)||u.getUserFromCache(g);j.starter.name=k?k.firstName:null,j.starter.res=j.starter.name?"res_StartedRecording_Other":"res_StartedRecording"}return j}function wa(a){pb&&void 0!==a&&pb.participantCount!==a&&(pb.participantCount=a,pb.updateCallState(),s.debug("[CircuitCallControlSvc]: Publish /call/participantCountChanged"),t.publish("/call/participantCountChanged",[pb.callId,pb.participantCount]))}function xa(a){var b=a&&a.sessionCtrl;return b?(b.onIceCandidate=za.bind(null,a),b.onSdpConnected=Aa.bind(null,a),b.onRemoteVideoAdded=Ba.bind(null,a),b.onRemoteVideoRemoved=Ca.bind(null,a),b.onRemoteStreamUpdated=Da.bind(null,a),b.onDTMFToneChange=Ea.bind(null,a),b.onRtcError=Fa.bind(null,a),b.onRtcWarning=Ga.bind(null,a),void(b.onLocalStreamEnded=Ha.bind(null,a))):void s.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",a)}function ya(a){var b=a&&a.sessionCtrl;b&&(b.onIceCandidate=null,b.onSessionDescription=null,b.onSdpConnected=null,b.onRemoteVideoAdded=null,b.onRemoteVideoRemoved=null,b.onRemoteStreamUpdated=null,b.onDTMFToneChange=null,b.onRtcError=null,b.onRtcWarning=null,b.onLocalStreamEnded=null)}function za(a,c){s.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var d={rtcSessionId:a.callId,userId:b.localUser.userId,origin:c.origin,candidates:c.candidates.map(JSON.stringify.bind(JSON))};mb.sendIceCandidates(d,function(a){a&&s.warn("Failed to sent ICE candidate: ",a)})}function Aa(a){s.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),t.publish("/call/sdpConnected",[a]),a.isTelephonyCall&&(a.checkState([e.CallState.Holding,e.CallState.HoldOnHold])||(a.setState(e.CallState.Active),H(a))),ia()})}function Ba(){s.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}function Ca(){s.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}function Da(a){s.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),t.publish("/call/remoteStreamUpdated",[a])})}function Ea(a,b){s.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),b.tone?(s.debug("[CircuitCallControlSvc]: Sent DTMF Digit: "+b.tone),t.publish("/call/singleDigitSent",[a,b.tone])):""===b.tone&&(s.info("[CircuitCallControlSvc]: Digits played completely"),t.publish("/call/digitsSent",[a]))}function Fa(a,b){return s.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcError"),t.publish("/call/rtcError",[a,b.error]),a.checkState([e.CallState.Ringing,e.CallState.Answering])?void Z(a,{type:d.InviteRejectCause.BUSY}):void(a.sameAs(pb)&&(a.isEstablished()?ia():lb.endCall(a.callId)))}function Ga(a,b){s.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),t.publish("/call/rtcWarning",[a,b.warning])}function Ha(a,b){s.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),b.isDesktop&&pb.hasLocalScreenShare()?(s.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),pb.isEstablished()?lb.removeScreenShare(pb.callId):lb.endCall(pb.callId)):(s.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),t.publish("/call/localStreamEnded",[pb]))}function Ia(a){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(c.isDirect||c.participants.length<2)return void s.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var d=[];a.first&&d.push(a.first),a.second&&d.push(a.second),a.third&&d.push(a.third);var e=c.setActiveSpeakers(d);if(!e)return;b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/participant/activeSpeakers event"),t.publish("/call/participants/activeSpeakers",[c.callId,d])})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",a)}}function Ja(a){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var d=c.getParticipant(a.userId);if(!d)return void s.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",a.userId);if(d.streamId===a.videoStreamId)return void s.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");b.$apply(function(){d.streamId=a.videoStreamId,pa(c,d),c.setParticipantRemoteVideoURL(d),c.checkForActiveRemoteVideo(),s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",d.userId),t.publish("/call/participant/updated",[c.callId,d,"mediaUpdate"])})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",a)}}function Ka(a){if(s.debug("[CircuitCallControlSvc]: Processing active session for convId = ",a.convId),!a.participants||0===a.participants.length)return void s.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",a.rtcSessionId);var c=v.getConversationByRtcSession(a.rtcSessionId);if(c){if(c.call)return void s.debug("[CircuitCallControlSvc]: Conversation already has an associated call");if(a.turnServers&&R(a.rtcSessionId,a.turnServers),!ma(a.rtcSessionId)){var f,h=!1;if(a.participants.some(function(a){if(a.userId===b.localUser.userId)return f=a,a.clientId===mb.clientId&&(h=!0),!0}),c.type!==d.ConversationType.DIRECT||f){if(h){var i=function(b){b&&s.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id:",a.rtcSessionId)};if(c.type===d.ConversationType.DIRECT)return void mb.terminateRtcCall(a.rtcSessionId,i);mb.leaveRtcCall(a.rtcSessionId,i)}var j=W(c,!0);j&&(j.setCallIdForTelephony(a.rtcSessionId),f&&(j.setActiveClient(f),1===a.participants.length&&a.callOut&&(j.pullNotAllowed=!0),j.setState(e.CallState.ActiveRemote),j.mediaType=g.getMediaType(a.mediaTypes),La(j,a),na(j)),H(j))}}}}function La(a,b){a&&a.isTelephonyCall&&b&&b.participants&&b.participants.length<=2&&b.participants.some(function(b){if(b.participantType===d.RTCParticipantType.TELEPHONY)return P(a,b.phoneNumber,b.userDisplayName),!0})}function Ma(a){var c=!1,d=K(a.rtcSessionId);return d&&a.participants&&(c=a.participants.some(function(a){return a.userId===b.localUser.userId&&a.clientId===mb.clientId})),c}function Na(){return new r(function(a,c){return Cb&&Db?(Cb=!1,void mb.getActiveSessions(function(c,d){b.$apply(function(){c&&s.error("[CircuitCallControlSvc]: Error getting active sessions: ",c),d=d||[];for(var f=ob.length-1;f>=0;f--)ob[f].isRemote&&J(ob[f]);rb.empty();var g=null,h=!1,i=[];d.forEach(function(a){var b=K(a.rtcSessionId);if(!h&&b){if(h=Ma(a))return s.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void lb.renegotiateMedia(b.callId);J(b,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}return(g=v.getConversationByRtcSession(a.rtcSessionId))?void Ka(a):(s.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),void i.push(v.getConversationPromise(a.convId)))}),pb&&!h&&J(pb,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),i.length>0?(s.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),r.all(i).then(function(c){var d=c.map(function(a){return a.convId});s.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",d),s.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),mb.getActiveSessions(function(c,e){b.$apply(function(){c&&(s.error("[CircuitCallControlSvc]: Error getting active sessions: ",c),e=[]),e.forEach(function(a){d.indexOf(a.convId)!==-1&&(Ma(a)||Ka(a))}),a()})})})):a()})})):void c("Not ready to initialize active sessions")})}function Oa(a,b,c){var d;d=c.isRemote?new h(b):new f(b),b.call=d,d.terminate(),s.debug("[CircuitCallControlSvc]: Publish /call/ended event"),t.publish("/call/ended",[d,!0]),b.call=null,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[b]),c.updateCall(a),a.call=c,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[a]),H(c),s.debug("[CircuitCallControlSvc]: Publish /call/moved event"),t.publish("/call/moved",[d.callId,c.callId])}function Pa(a,b){var c={rtcSessionId:a,transactionId:b};mb.changeMediaReject(c,function(a){a?s.error("[CircuitCallControlSvc]: changeMediaReject sending error"):s.debug("[CircuitCallControlSvc]: changeMediaReject sent")})}function Qa(a,b){if(s.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),t.publish("/call/incoming",[a.call]),!a.muted&&w){var c=a.call.mediaType.video?e.NotificationType.INCOMING_VIDEO_CALL:e.NotificationType.INCOMING_VOICE_CALL,f={type:c,userId:b,extras:{conversation:a,call:a.call}};a.isTelephonyConv&&(f.user=a.call.peerUser),w.show(f)}a.call.startRingingTimer(function(){Z(a.call,{type:d.InviteRejectCause.TIMEOUT},!1)})}function Ra(a,c){if(!a||!c)return void s.error("[CircuitCallControlSvc]: processInvite called without evt or conversation");var d=null,h=!1,i=!1,j=!1;if(a.replaces&&la(a.replaces))h=!0;else if(pb)if(pb.callId===a.replaces)i=pb.sessionCtrl&&pb.sessionCtrl.isMuted(),d=pb;else if(pb.terminateTimer){if(pb.callId===a.sessionId)return void X(a);J(pb);
}else{if(pb.callId===a.sessionId)return void(pb.isDirect?X(a):s.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."));if(!pb.isEstablished())return void X(a)}c.isTelephonyConv?a.to&&a.to.displayName&&a.to.displayName.startsWith("handover-from")&&(s.debug("[CircuitCallControlSvc]: Received handover call"),Fb?(j=!0,o.cancel(Fb),Fb=null):(s.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),h=!0)):sb&&sb.callId===a.replaces&&(i=tb,d=sb);var k=ma(a.sessionId);if(k)return void s.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");if(!h&&!d&&wb.length>=1&&!j)return void X(a);if(c.isTelephonyConv&&!j&&!h)if(b.localUser.selectedBusyHandlingOption&&b.localUser.selectedBusyHandlingOption!==n.DefaultRouting.name){if(pb&&pb.isEstablished()||!rb.isEmpty()||c.call&&c.call.isAtcRemote)return void Y(c,a)}else if(ob.length>1)return void X(a);var l=new f(c,{isAtcPullCall:c.isTelephonyConv&&j&&"offer"===a.sdp.type});l.setCallIdForTelephony(a.sessionId),l.setInstanceId(a.instanceId),l.setTransactionId(a.transactionId),l.sessionCtrl.enableTrickleIce(),d&&(l.replaces=d),ub&&(s.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),l.disableRemoteVideo()),l.setState(e.CallState.Ringing),l.direction=e.CallDirection.INCOMING,ra(l,Q({userId:a.userId},a.mediaType),e.ParticipantState.Calling),l.ringingTimeout=a.ringingTimeout||l.ringingTimeout;var p=g.getMediaType(a.mediaType);if(l.mediaType=p,p.desktop&&s.debug("[CircuitCallControlSvc]: INVITE for a Screen Share"),h)return void F(l,!0);var q=function(){b.$apply(function(){if(l.state===e.CallState.Terminated)return void s.debug("[CircuitCallControlSvc]: New alerting call has been terminated already");xa(l),s.debug("[CircuitCallControlSvc]: New alerting call: ",l.callId),c.call&&!c.isTelephonyConv&&(s.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),J(c.call));var f=null;return c.call&&c.call.isAtcRemote&&(f=c.call.callId),c.call=l,c.isTelephonyConv&&j?(s.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),t.publish("/atccall/replace",[l,f])):(s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[c])),d?void lb.answerCall(l.callId,d.localMediaType,function(a){a||i&&pb.sessionCtrl&&pb.sessionCtrl.mute()}):(b.localUser.isCMP&&(j=!0,p.video=!0,p.desktop=!1),j?(l.isTelephonyCall&&a.from&&P(l,a.from.phoneNumber,a.from.displayName),void lb.answerCall(l.callId,p)):(mb.sendProgress(l.callId,a.userId,b.localUser.userId,function(a){a&&s.error("[CircuitCallControlSvc]: sendProgress error",a)}),l.isTelephonyCall&&a.from?void P(l,a.from.phoneNumber,a.from.displayName,null,function(){c.call===l&&Qa(c,a.userId)}):void Qa(c,a.userId)))})},r=l.sessionCtrl,u=S(c.rtcSessionId);b.localUser.isCMP&&r.useMaxNumberOfExtraVideoChannels(),F(l),z(l.callId).then(function(b){u?(s.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",u),r.setTurnUris(u)):(s.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),r.setTurnUris(b.turnServer)),r.setTurnCredentials(b),s.debug("[CircuitCallControlSvc]: Set TURN credentials");var c;if(l.replaces)c=l.replaces.localMediaType;else{var d="firefox"===m.browser,e="android"===m.browser;c={audio:!d&&!e,video:!1}}Va(c,function(b){r.warmup(b,a.sdp,q,function(a){s.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call, ",a),t.publish("/call/warmupFailed",[a,l])})})})}function Sa(a,c){a&&c&&c.some(function(c){if(a.rtcSessionId===c.rtcSessionId){if(s.debug("[CircuitCallControlSvc]: Processing active session for convId = ",a.convId),!c.participants||0===c.participants.length)return s.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",c.rtcSessionId),!0;var f;if(c.participants.some(function(a){if(a.userId===b.localUser.userId)return f=a,!0}),a.type===d.ConversationType.DIRECT&&!f)return!0;if(a.call)return s.debug("[CircuitCallControlSvc]: Conversation already has an associated call"),!0;var h=W(a,!0);return h&&(f&&(h.setActiveClient(f),1===c.participants.length&&c.callOut&&(h.pullNotAllowed=!0),h.setState(e.CallState.ActiveRemote),h.mediaType=g.getMediaType(c.mediaTypes),La(h,c),na(h)),H(h)),!0}})}function Ta(a,b,c){var d=K(a);return d?d.isEstablished()?(s.info("[CircuitCallControlSvc]: Sending DTMF Digits:",b),void(d.sessionCtrl.sendDTMFDigits(b)||(s.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),c("res_CannotSendDTMF")))):(s.info("[CircuitCallControlSvc]: sendDTMFDigits - The local call is not established"),void c("Call not established")):(s.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),void c("Invalid callId"))}function Ua(a,c,e,f){a.type===d.ConversationType.LARGE&&b.isSessionGuest&&(c.audio=!1,s.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",c)),Va(c,function(b,c){e.warning=c,T(a,b,e,f)})}function Va(a,c){if(s.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",a),b.browser.msie&&!b.isSessionGuest&&!b.localUser.hasPermission(d.SystemPermission.IE_PLUGIN_SUPPORT))return s.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void t.publish("/iePlugin/permissionDenied");var e;return a=a||{audio:!0,video:!1},cb||!a.audio&&!a.video?(s.debug("[CircuitCallControlSvc]: Normalized mediaType = ",a),void c(a)):(s.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void m.getMediaSources(function(b,d){a.video&&(!d||d.length<1)&&(a.video=!1,e="res_AnswerWarnNoCamera"),a.audio&&(!b||b.length<1)&&(a.audio=!1,e="res_AnswerWarnNoCamera"===e?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed"),s.debug("[CircuitCallControlSvc]: Normalized mediaType = ",a),c(a,e)}))}function Wa(a){a&&a.activeNotification&&!a.isHandoverInProgress&&(w&&w.dismiss(a.activeNotification),a.activeNotification=null)}function Xa(a,c,d){var e={content:{type:"PARTICIPANT_POINTER",x:c,y:d,userId:b.localUser.userId},destUserId:a};nb.sendDesktopAppRequest(e,function(a){a?s.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",a):s.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")})}function Ya(a,c,d){var e={content:{type:"PARTICIPANT_DRAWING",points:c,options:d||{},userId:b.localUser.userId},destUserId:a};nb.sendDesktopAppRequest(e,function(a){a?s.error("[CircuitCallControlSvc]: Error sending participant drawing coordinates: ",a):s.info("[CircuitCallControlSvc]: Successfully sent participant drawing coordinates.")})}function Za(a,c){if(a&&a.hasLocalScreenShare()&&a.checkState([e.CallState.Active,e.CallState.Waiting])){var d=c&&a.getParticipant(c),f=d&&d.displayName;s.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),t.publish("/screenshare/forceStop/started",[c]),lb.removeScreenShare(a.callId,function(a){s.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),t.publish("/screenshare/forceStop/ended",[a])}),w.show({type:e.NotificationType.HIGH_PRIORITY,user:b.localUser,extras:{title:b.i18n.map.res_ScreenShareRemotelyDisabledTitle,text:f?b.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[f]):b.i18n.map.res_ScreenShareRemotelyDisabled}})}}function $a(a){lb.mute(a),lb.disableRemoteAudio(a)}function _a(a,c,f){if(f=f||function(){},!a||!c)return s.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void f("Invalid arguments");var g=c.dialOutPhoneNumber,h=g?{userId:"gtc-callout-"+g.replace(/[+ ]+/g,""),phoneNumber:l.cleanPhoneNumber(g),displayName:c.displayName,resolvedUserId:c.userId,isExternal:!0,pstnDialIn:!1}:c;if(!h.userId)return s.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void f("Missing userId");if(a.hasParticipant(h.userId)||h.resolvedUserId&&a.hasParticipant(h.resolvedUserId))return s.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void f("Participant exists");s.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",h.userId);var i={rtcSessionId:a.callId,userId:h.userId,mediaType:a.mediaType};g&&(i.from={phoneNumber:l.cleanPhoneNumber(b.localUser.callerId),displayName:b.localUser.displayName},i.to={phoneNumber:h.phoneNumber,displayName:h.displayName,resolvedUserId:h.resolvedUserId}),mb.addParticipantToRtcSession(i,function(c){b.$apply(function(){if(c){if(c===d.ErrorCode.PERMISSION_DENIED)return s.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void f("res_MaxConversationParticipantsLimit");s.warn("[CircuitCallControlSvc]: Failed to add participant"),f("res_AddParticipantToRtcSessionFailed")}else{if(s.debug("[CircuitCallControlSvc]: Add participant request was successful"),a.direction=e.CallDirection.OUTGOING,!a.isRemote){var b=Q(h,["AUDIO"]),g=b.muted?e.ParticipantState.Muted:e.ParticipantState.Initiated,i=ra(a,b,g);i&&(i.isCMP&&(i.isMeetingPointInvitee=!0,a.setMeetingPointInviteState(!0),$a(a.callId)),s.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),t.publish("/call/participant/added",[a.callId,i]))}f()}})})}var ab=a.Conversation,bb=a.UserProfile;s.debug("New Service: CircuitCallControlSvc (NEW)");var cb=l.isMobile(),db=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:cb?2:3},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:cb?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:cb?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:cb?0:3},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:cb?2:3}}),eb=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:cb?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:cb?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:cb?0:3}}),fb=Object.freeze({COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:cb?0:5e3,DELAY_RTT_PROCESSING:3}),gb=3200,hb=6,ib=6e4,jb=6e3,kb=2e3,lb=this,mb=c.getInstance(),nb=k.getInstance(),ob=[],pb=null,qb=null,rb=[],sb=null,tb=!1,ub=!1,vb={},wb=[],xb=null,yb=null,zb=null,Ab=0,Bb=!1,Cb=!1,Db=!1,Eb={},Fb=null,Gb=null;return t.subscribe("/conversation/update",function(a){var c=K(a.rtcSessionId);c&&!c.isDirect&&(s.debug("[CircuitCallControlSvc]: Received /conversation/update event. convId: ",a.convId),ka(a),c.participants.forEach(function(c){c.setActions(a,b.localUser),s.debug("[CircuitCallControlSvc]: Set participant actions. userId: "+c.userId+", actions: ",c.actions)}))}),t.subscribe("/conversation/upgrade",function(a,b){if(s.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+a.convId+". New convId = ",b.convId),a.call&&b.convId!==a.convId&&a.call.checkState(e.CallState.Active))if(s.debug("[CircuitCallControlSvc]: Move Session"),a.type===d.ConversationType.DIRECT&&b.type===d.ConversationType.GROUP)T(b,a.call.localMediaType,{callOut:!0,handover:!1,replaces:a.call},function(c){c||a.call.sessionCtrl&&a.call.sessionCtrl.isMuted()&&b.call.sessionCtrl&&b.call.sessionCtrl.mute()});else{var c={sessionId:a.rtcSessionId,conversationId:a.convId,newSessionId:b.rtcSessionId,newConversationId:b.convId};mb.moveRtcSession(c,function(a){a&&s.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",a)})}}),t.subscribe("/conversation/left",function(a){s.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = "+a.convId),a&&a.call&&lb.hideRemoteCall(a.call.callId)}),t.subscribe("/conversation/participants/add",function(a,b){s.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),a&&b&&b.forEach(function(b){_a(a,b)})}),t.subscribe("/csta/handover",function(){s.debug("[CircuitCallControlSvc]: Received /csta/handover event."),Fb=o(function(){Fb=null},jb)}),t.subscribe("/conversations/loadComplete",function(){s.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),Db=!0,Na()}),t.subscribe("/registration/state",function(a){s.debug("[CircuitCallControlSvc]: Received /registration/state event"),a===RegistrationState.Registered?(Cb=!0,Na()):Cb=!1,a===RegistrationState.Connecting&&pb&&b.isSessionGuest&&J(pb,e.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION,!0)}),t.subscribe("/conversation/re-added",function(a){s.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",a.convId),mb.getSession(a.rtcSessionId,function(c,d){c?s.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",c):d.participants&&d.participants.length>0&&b.$apply(function(){Sa(a,[d])})})}),t.subscribe("/call/meetingPointInvitee",function(a){if(s.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),a){var b=K(a);b&&(b.setMeetingPointInviteState(!0),$a(a))}}),a.isElectron&&(nb.on("DESKTOP_APP.PARTICIPANT_POINTER",function(a,b){try{s.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),a.userId=b.srcUserId,u.getUserById(a.userId,function(b,c){return b?void s.error("[CircuitCallControlSvc]: User not found.",a.userId):void(pb.hasLocalScreenShare()&&(a.name=c.displayName,require("electron").ipcRenderer.send("participant-pointer",a)))})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",a)}}),nb.on("DESKTOP_APP.PARTICIPANT_DRAWING",function(a,c){try{s.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_DRAWING"),b.circuitLabs.PARTICIPANT_DRAWING&&(a.userId=c.srcUserId,u.getUserById(a.userId,function(b,c){return b?void s.error("[CircuitCallControlSvc]: User not found.",a.userId):void(pb.hasLocalScreenShare()&&(a.name=c.displayName,require("electron").ipcRenderer.send("participant-drawing",a)))}))}catch(a){s.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",a)}})),mb.on("RTCCall.SDP_ANSWER",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(mb.clientId!==a.clientID)return void s.debug("[CircuitCallControlSvc]: Event is not for this client: ",mb.clientId);b.$apply(function(){var b=a.sdp;b&&(b.sdp&&"sdp"!==b.sdp&&"data"!==b.sdp||(b.sdp="sdp",s.debug("[CircuitCallControlSvc]: This is a mocked call"),c.setMockedCall()),c.setInstanceId(a.instanceId),c.sessionCtrl.setRemoteDescription(b)||$(c,null,e.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",a)}}),mb.on("RTCCall.ICE_CANDIDATES",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES",a);var b=K(a.sessionId);if(!b)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(mb.clientId!==a.clientId)return void s.debug("[CircuitCallControlSvc]: Event is not for this client: ",mb.clientId);b.sessionCtrl.addIceCandidates(a.origin,a.candidates)}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",a)}}),mb.on("RTCSession.SESSION_UPDATED",function(a){b.$apply(function(){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED");var c;a.session.participants.some(function(a){if(a.userId===b.localUser.userId)return c=a,!0});var f,h,i=K(a.sessionId);if(c){var j=la(a.sessionId);if(j)return s.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),j.mediaType=g.getMediaType(a.session.mediaTypes),j.setActiveClient(c),void H(j);var k=ma(a.sessionId);if(k)return void s.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!i||i.callId!==a.sessionId&&!N(!0))return(h=v.getConversationByRtcSession(a.sessionId))?c.clientId===mb.clientId?void s.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event."):(f=W(h,!0),void(f&&(f.setCallIdForTelephony(a.sessionId),f.mediaType=g.getMediaType(a.session.mediaTypes),f.setActiveClient(c),f.setState(e.CallState.ActiveRemote),f.mediaType=g.getMediaType(a.session.mediaTypes),La(f,a.session),na(f),H(f)))):void s.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");if(c.clientId!==mb.clientId){h=v.getConversationFromCache(i.convId);var l=null,m=null,n=null;i.isTelephonyCall&&(l=i.peerUser.phoneNumber,m=i.peerUser.displayName,n=i.participants);var o=i.atcCallInfo;return J(i,e.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),f=W(h,!0),void(f&&(f.setCallIdForTelephony(a.sessionId),f.atcCallInfo=o,f.isTelephonyCall&&(P(f,l,m),f.participants=n),f.setActiveClient(c),f.mediaType=g.getMediaType(a.session.mediaTypes),f.setState(e.CallState.ActiveRemote),na(f),H(f)))}i.remotelyMuted!==c.muted&&(i.remotelyMuted=c.muted,s.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),t.publish("/call/localUser/muted",[i.callId,i.remotelyMuted,i.locallyMuted]))}else if(!i||!i.isLarge)return void s.debug("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event. ");a.session.muted!==i.sessionMuted&&(i.sessionMuted=a.session.muted,s.debug("[CircuitCallControlSvc]: Publish /call/muted event"),t.publish("/call/muted",[i])),a.session.locked!==i.sessionLocked&&(i.sessionLocked=a.session.locked,s.debug("[CircuitCallControlSvc]: Publish /call/locked event"),t.publish("/call/locked",[i])),a.stageAction&&(s.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),t.publish("/call/raiseHand/stageAction",[a.stageAction])),a.session.curtain&&(i.curtain=a.session.curtain,s.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),t.publish("/call/curtain",[i.curtain]));var p=[],q=[],r=a.session.participants||[];if(b.localUser.isCMP||r.some(function(a,c){if(a.userId===b.localUser.userId)return r.splice(c,1),!0}),r.length>0||i.conferenceCall){var u=g.getMediaType(a.session.mediaTypes);if(u.audio=u.audio||i.localMediaType.audio,u.video=u.video||i.localMediaType.video,u.desktop=u.desktop||i.localMediaType.desktop,i.mediaType=u,i.activeClient=null,i.replaces){var w=L(i.replaces.callId);w&&$(w,null,e.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),s.debug("[CircuitCallControlSvc]: Publish /call/moved event"),t.publish("/call/moved",[i.replaces.callId,i.callId]),i.replaces=null}ia(),r.forEach(function(a){if(!i.isAtcConferenceCall()){var b=!1,c=Q(a),d=c.muted?e.ParticipantState.Muted:e.ParticipantState.Active,f=i.getParticipant(a.userId);if(M(c,i),f){var g=f.pcState,h=f.videoUrl;f.streamId===c.streamId&&f.hasSameMediaType(c)||(b=!0);var j=sa(i,c,d);j&&j.pcState!==g&&q.push(j),j&&(b||j.videoUrl!==h)&&(s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),t.publish("/call/participant/updated",[i.callId,j,"mediaUpdate"]))}else{var k=ra(i,c,d);k&&p.push(k)}}})}if(wa(a.session.participantCount),(r.length>0||i.conferenceCall)&&!i.isTelephonyCall&&i.setState(i.hasOtherParticipants()?e.CallState.Active:e.CallState.Waiting),H(i),h=b.isSessionGuest?null:v.getConversationFromCache(i.convId),ka(h),i.conferenceCall&&!i.hasOtherParticipants()&&(s.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),t.publish("/conference/starting",[i])),q.length>0&&(s.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),t.publish("/call/participants/updated",[i.callId,q])),p.length>0&&(s.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),t.publish("/call/participants/added",[i.callId,p])),!i.isTestCall){var x=null;if(mb.isNewRecordingEventingSupported())a.session.recordingInfo&&a.session.recordingInfo.state!==d.RecordingInfoState.INITIAL&&(x=ua(i,a.session.recordingInfo));else if(a.session.isRecordingActive||a.session.recordingDuration>0||a.session.recordingTriggeredBy===d.RecordingTriggerReason.CURTAIN){var y=i.isJoiningGroupCall;x=va(i,a.session.isRecordingActive,y,a.session.recordingDuration,a.session.recordingStarterId,a.session.recordingTriggeredBy)}x&&(s.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),t.publish("/call/recording/info",[i]))}i.isJoiningGroupCall=!1,E()}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",a)}})}),mb.on("RTCSession.SESSION_STARTED",function(a){if(!Db)return void s.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.");try{s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var c=K(a.sessionId);if(c&&c.isTestCall)return void s.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");a.session.turnServers&&R(a.sessionId,a.session.turnServers);var f=v.getConversationFromCache(a.convId);if(!f){if(s.info("[CircuitCallControlSvc]: Could not find corresponding conversation"),a.callOut)return;return s.info("[CircuitCallControlSvc]: Get the conversation from the server"),void v.getConversationById(a.convId,{randomLoaded:!0},function(a,c){a?s.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(s.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),mb.getActiveSessions(function(a,d){b.$apply(function(){a&&(s.error("[CircuitCallControlSvc]: Error getting active sessions: ",a),d=[]),Sa(c,d)})}))})}b.$apply(function(){if(c)s.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),c.checkState(e.CallState.Initiated)?(c.setState(e.CallState.Delivered),H(c)):s.info("[CircuitCallControlSvc]: Unexpected state for local call. Ignore SESSION_STARTED. State =",c.state.name);else if(a.callOut)a.session.participants.some(function(c){if(c.userId===b.localUser.userId&&c.clientId!==mb.clientId){var d=W(f,!0);return d.setCallIdForTelephony(a.sessionId),d&&(d.setActiveClient(c),d.pullNotAllowed=!0,d.setState(e.CallState.ActiveRemote),H(d),na(d)),!0}});else if(f.type===d.ConversationType.GROUP||f.type===d.ConversationType.LARGE){var g=W(f,!0);g.setCallIdForTelephony(a.sessionId),g&&(a.session.participants.some(function(a){if(a.userId===b.localUser.userId&&a.clientId!==mb.clientId)return g.setActiveClient(a),g.setState(e.CallState.ActiveRemote),H(g),na(g),!0}),H(g))}wa(a.session.participantCount)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",a)}}),mb.on("RTCSession.PARTICIPANT_JOINED",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var c=a.participant.userId;if(b.localUser.userId===c)return void s.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var d=la(a.sessionId);if(d)return void b.$apply(function(){d.pullNotAllowed&&(d.pullNotAllowed=!1),d.isTelephonyCall&&!d.atcCallInfo&&P(d,a.participant.phoneNumber,a.participant.userDisplayName)});var f=K(a.sessionId);if(!f)return void s.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!f.isEstablished()&&f.direction===e.CallDirection.INCOMING)return void s.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");b.$apply(function(){if(f.isVoicemail=!!a.participant.userDisplayName&&a.participant.userDisplayName.startsWith("VoiceMail of"),f.isTelephonyCall&&!f.atcCallInfo&&P(f,a.participant.phoneNumber,a.participant.userDisplayName),f.checkState([e.CallState.Delivered,e.CallState.Waiting])&&(f.isTelephonyCall||f.setState(e.CallState.Active),f.activeClient=null,f.replaces)){var b=L(f.replaces.callId);b&&$(b,null,e.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),s.debug("[CircuitCallControlSvc]: Publish /call/moved event"),t.publish("/call/moved",[f.replaces.callId,f.callId]),f.replaces=null}var d=Q(a.participant),g=d.muted?e.ParticipantState.Muted:e.ParticipantState.Active;if(M(d,f),f.hasParticipant(c)){var h=sa(f,d,g);h&&(s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),t.publish("/call/participant/updated",[f.callId,h]))}else{var i=ra(f,d,g);i&&(s.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),t.publish("/call/participant/added",[f.callId,i]))}var j=a.userEnteredStage?{userEnteredStage:a.userEnteredStage}:null;s.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),t.publish("/call/participant/joined",[f,f.getParticipant(d.userId),j]),E(),f.updateMediaType(),H(f),ka()})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",a)}}),mb.on("RTCSession.SESSION_MOVED",function(a){try{if(s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),Eb[a.oldRtcSessionId])return s.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Eb[a.oldRtcSessionId];var c=L(a.oldRtcSessionId);if(!c)return void s.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var d=v.getConversationFromCache(a.oldConversationId),e=v.getConversationFromCache(a.newConversationId);if(!d||!e)return void s.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");b.$apply(function(){if(Oa(e,d,c),c.isRemote)return void s.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");if("iOS"!==q.navigator.platform&&ka(e),e.creatorId===b.localUser.userId){var a={};d.participants.forEach(function(b){a[b.userId]=!0}),e.participants.forEach(function(b){a[b.userId]||_a(c,b)})}})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",a)}}),mb.on("RTCCall.INVITE",function(a){if(!Db)return void s.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.");if(b.localUser.isCMP&&b.localUser.userPresenceState.state===d.PresenceState.UPDATE)return s.info("[CircuitCallControlSvc]: CMP is updating its software. Reject the INVITE with cause BUSY."),void X(a);try{s.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE");var c=v.getConversationFromCache(a.convId);if(!c){s.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var e=a.sessionId;return Eb[e]=a,void v.getConversationById(a.convId,{randomLoaded:!0},function(a,c){a?s.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):Eb[e]?(s.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),Ra(Eb[e],c)):(s.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),mb.getActiveSessions(function(a,d){b.$apply(function(){a&&(s.error("[CircuitCallControlSvc]: Error getting active sessions: ",a),d=[]),Sa(c,d)})})),delete Eb[e]})}b.$apply(function(){Ra(a,c)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",a)}}),mb.on("RTCSession.PARTICIPANT_LEFT",function(a){b.$apply(function(){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var c=la(a.sessionId);if(c)return s.info("[CircuitCallControlSvc]: Event is for active remote call."),void(b.localUser.userId===a.userId&&(c.setState(e.CallState.Started),c.activeClient=null,H(c),rb.some(function(a,b){if(a.callId===c.callId)return rb.splice(b,1),!0})));var f=K(a.sessionId);if(!f){var g=ma(a.sessionId);if(g&&!g.isDirect&&g.hasParticipant(a.userId)){s.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),ta(g,a.userId,a.cause);var h=v.getConversationFromCache(g.convId);return void(h&&(W(h,!1),J(g,e.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE)))}}if(!f)return void s.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(f.isTestCall)return void s.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(f.isDirect)return void(b.localUser.userId!==a.userId&&a.cause===d.RTCSessionParticipantLeftCause.CONNECTION_LOST?f.setParticipantState(a.userId,e.ParticipantState.ConnectionLost):s.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"));var i=a.userId,j=v.getConversationFromCache(f.convId);if(b.localUser.userId!==i){if(a.cause===d.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var k=j.participants.some(function(a){return a.userId===i}),l=function(a,b){a||(s.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),t.publish("/call/participant/rejected",[f.callId,b]))};return void(k?u.getUserById(i,l):l())}ta(f,i,a.cause)}else{if(W(j,!1),a.cause===d.RTCSessionParticipantLeftCause.REMOVED){var m=f.getParticipant(a.requesterId);t.publish("/call/droppedRemotely",[f,m])}J(f,e.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER)}}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",a)}})}),mb.on("RTCCall.SDP_FAILED",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",a.cause);var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(mb.clientId!==a.clientID)return void s.debug("[CircuitCallControlSvc]: Event is not for this client");if(a.cause===d.SdpFailedCause.SESSION_TERMINATED)return void s.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");b.$apply(function(){c.isEstablished()?c.sessionCtrl.renegotiationFailed():c.isDirect&&c.isCallOut||$(c,null,e.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",a)}}),mb.on("RTCSession.SESSION_TERMINATED",function(a){try{if(s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),vb[a.sessionId]&&delete vb[a.sessionId],Eb[a.sessionId])return s.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Eb[a.sessionId];var c=L(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",a.sessionId);if(c.terminateTimer)return void s.debug("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");c.isTelephonyCall&&Fb&&(s.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),c.setAtcHandoverInProgress(),o.cancel(Fb),Fb=null),b.$apply(function(){var b=a.cause;s.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",b),t.publish("/call/terminated",[c,b]),J(c,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+b)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",a)}}),mb.on("RTCCall.INVITE_CANCEL",function(a){try{if(mb.clientId===a.clientID)return void s.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(Eb[a.sessionId])return s.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete Eb[a.sessionId];b.$apply(function(){s.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",a.cause);var b=ma(a.sessionId);if(b){if(!b.isDirect||a.cause===d.InviteCancelCause.ACCEPT){var c=v.getConversationFromCache(b.convId),f=W(c,!0);f.setCallIdForTelephony(a.sessionId),f&&(a.cause===d.InviteCancelCause.ACCEPT&&(f.activeClient={clientId:a.clientID},f.setState(e.CallState.ActiveRemote),f.isTelephonyCall&&P(f,b.peerUser.phoneNumber,b.peerUser.displayName),na(f)),H(f))}var g=a.cause===d.InviteCancelCause.ACCEPT?e.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:e.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;J(b,g)}else if(s.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),a.cause===d.InviteCancelCause.ACCEPT){var h=L(a.sessionId);h&&h.isRemote&&(s.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),
h.activeClient={clientId:a.clientID},h.setState(e.CallState.ActiveRemote),na(h),H(h))}})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",a)}}),mb.on("RTCCall.INVITE_FAILED",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!c.isDirect){var f=c.getParticipant(a.userId);if(f&&f.isActive())return void s.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",a.userId)}if(a.clientID&&mb.clientId!==a.clientID)return void s.debug("[CircuitCallControlSvc]: Event is not for this client: ",mb.clientId);b.$apply(function(){var b,f=c,g=a.cause,h=a.userId;switch(g){case d.InviteFailedCause.NOT_REACHABLE:b=e.ParticipantState.Offline,f.isDirect&&f.setState(e.CallState.Failed);break;case d.InviteFailedCause.BUSY:b=e.ParticipantState.Busy,f.isDirect&&f.setState(e.CallState.Busy);break;case d.InviteFailedCause.DECLINE:b=e.ParticipantState.Declined,f.isDirect&&f.setState(e.CallState.Declined);break;case d.InviteFailedCause.TIMEOUT:b=e.ParticipantState.Timeout,f.isDirect&&f.setState(e.CallState.NotAnswered);break;case d.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case d.InviteFailedCause.INVALID_NUMBER:b=e.ParticipantState.Busy,f.isDirect&&f.setState(e.CallState.Failed);break;default:s.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",a.cause),b=e.ParticipantState.Busy,f.isDirect&&f.setState(e.CallState.Failed)}if(f.isDirect)f.setParticipantState(h,b),H(f),f.hasVideo()&&f.removeParticipant(h),$(f,null,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+g,!0);else{f.setParticipantState(h,b);var i=f.removeParticipant(h);i&&(s.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),t.publish("/call/participant/removed",[f.callId,i]),f.participants.isEmpty()&&(f.conferenceCall?f.checkState(e.CallState.Waiting)||(f.setState(e.CallState.Waiting),H(f)):(f.setState(e.CallState.NotAnswered),H(f),$(null,null,e.CallServerTerminatedReason.SERVER_ENDED_PRFX+g,!0))))}})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",a)}}),mb.on("RTCSession.ACTIVE_SPEAKER",Ia),mb.on("RTCSession.VIDEO_ACTIVE_SPEAKER",Ja),mb.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED");var c=ma(a.sessionId);if(c)return void Pa(a.sessionId,a.transactionId);var d=K(a.sessionId);if(!d||d.isRemote)return void s.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(a.clientID&&mb.clientId!==a.clientID)return void s.debug("[CircuitCallControlSvc]: Event is not for this client: ",mb.clientId);if(d.activeClient)return void s.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!d.isEstablished()&&d.direction===e.CallDirection.INCOMING||!d.isDirect)return void Pa(d.callId,a.transactionId);b.$apply(function(){if(a.sdp){var c=d.sessionCtrl;if(!c.isConnStable())return void Pa(d.callId,a.transactionId);if(d.setTransactionId(a.transactionId),d.isTelephonyCall&&c.getSdpStatus()===e.SdpStatus.PrAnswerReceived&&"answer"===j.getSessionInformation(a.sdp.sdp)){if(c.setRemoteDescription(a.sdp)){a.sdp.type="answer";var f={rtcSessionId:d.callId,sdp:a.sdp,transactionId:d.transactionId};mb.changeMediaAccept(f,function(a){a?s.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):s.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})}return}var g=function(a){c.onSessionDescription=null,ia();var e={rtcSessionId:d.callId,sdp:a.sdp,transactionId:d.transactionId};mb.changeMediaAccept(e,function(a){b.$apply(function(){a?s.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):s.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})})};ja(d),z(d.callId).then(function(b){c.setTurnCredentials(b),j.isNoOfferSdp(a.sdp)?U(d.callId,d.transactionId,d.localMediaType,!1,null,function(a){a&&s.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")}):(c.onSessionDescription=g,c.setRemoteDescription(a.sdp)||(c.onSessionDescription=null,Pa(d.callId,a.transactionId),ia()))})}else Pa(d.callId,a.transactionId)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTTED event. ",a)}}),mb.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var c=K(a.sessionId);if(!c)return void s.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(c.isDirect)return void s.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(a.clientID&&mb.clientId!==a.clientID)return void s.debug("[CircuitCallControlSvc]: Event is not for this client: ",mb.clientId);if(c.activeClient)return void s.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");a.removeMediaTypes&&(c.localMediaType.desktop&&a.removeMediaTypes.contains(d.RealtimeMediaType.DESKTOP_SHARING)&&b.$apply(function(){Za(c,a.userId)}),a.removeMediaTypes.contains(d.RealtimeMediaType.AUDIO)&&b.$apply(function(){lb.removeAudio(c.callId)}))}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",a)}}),mb.on("RTCSession.PARTICIPANT_UPDATED",function(a){try{s.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var c=K(a.sessionId),d=la(a.sessionId)||c;if(d&&d.callId===a.sessionId&&d.isTelephonyCall&&!d.atcCallInfo&&b.localUser.userId!==a.participant.userId&&P(d,a.participant.phoneNumber,a.participant.userDisplayName),!c)return void s.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");b.$apply(function(){var d=a.participant.userId,f=a.participant.muted;if(b.localUser.userId===d)return void(c.remotelyMuted!==f&&(c.remotelyMuted=f,s.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),t.publish("/call/localUser/muted",[c.callId,f,c.locallyMuted])));if(!c.isEstablished()&&c.direction===e.CallDirection.INCOMING)return void s.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");var g=c.getParticipant(a.participant.userId);if(!g)return void s.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",d);var h=Q(a.participant),i=h.muted?e.ParticipantState.Muted:e.ParticipantState.Active,j=g.muted!==h.muted,k=!g.hasSameMediaType(h)||g.streamId!==h.streamId,l=sa(c,h,i);l&&(M(l,c),k&&(c.updateMediaType(),s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),t.publish("/call/participant/updated",[c.callId,l,"mediaUpdate"])),j&&(s.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),t.publish("/call/participant/updated",[c.callId,l]))),H(c)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",a)}}),mb.on("RTCSession.SESSION_RECORDING_INFO",function(a){if(s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO"),mb.isNewRecordingEventingSupported()){var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");b.$apply(function(){var b=ua(c,a.recordingInfo);b&&(s.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),t.publish("/call/recording/info",[c]))})}else s.debug("[CircuitCallControlSvc]: Ignoring new recording event")}),mb.on("RTCSession.SESSION_RECORDING_STARTED",function(a){if(s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_STARTED"),mb.isNewRecordingEventingSupported())s.debug("[CircuitCallControlSvc]: Ignoring old recording events");else{var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");b.$apply(function(){var b=va(c,!0,!0,a.duration,a.session.recordingStarterId,a.triggeredBy);b&&(s.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),t.publish("/call/recording/info",[c]))})}}),mb.on("RTCSession.SESSION_RECORDING_STOPPED",function(a){if(s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_STOPPED"),mb.isNewRecordingEventingSupported())s.debug("[CircuitCallControlSvc]: Ignoring old recording events");else{var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");b.$apply(function(){var b=a.reason===d.RecordingStoppedReason.NO_INPUT?d.RecordingInfoReason.NO_INPUT_TIMEOUT:a.reason,e=va(c,!1,!0,a.duration,a.session.recordingStarterId,a.triggeredBy,b);e&&(s.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),t.publish("/call/recording/info",[c]))})}}),mb.on("RTCSession.SESSION_RECORDING_FAILED",function(a){if(s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_FAILED"),mb.isNewRecordingEventingSupported())s.debug("[CircuitCallControlSvc]: Ignoring old recording events");else{var c=K(a.sessionId);if(!c)return void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!c.recording)return;b.$apply(function(){pb.recording.reason=a.failureReason,s.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),t.publish("/call/recording/info",[c])})}}),mb.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",function(a){s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var c=K(a.sessionId);return c?void b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),t.publish("/call/sessionTerminateTimerChanged",[c.callId,a.endTime])}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),mb.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",function(a){s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var c=K(a.sessionId);return c?void b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),t.publish("/call/sessionTerminateTimerChanged",[c.callId,null])}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),mb.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",function(a){s.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var c=K(a.sessionId);return c?void 0===a.participantCount||c.participantCount===a.participantCount?void s.debug("[CircuitCallControlSvc]: No changes"):void b.$apply(function(){wa(a.participantCount)}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),mb.on("RTCCall.PROGRESS",function(a){s.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var c=K(a.sessionId),f=K(a.sessionId);if(!c)return void s.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");if(c.receivedAlerting=a.progressType===d.RTCProgressType.ALERTING,c.sameAs(f)&&!f.checkState([e.CallState.Initiated,e.CallState.Delivered]))return void s.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",f.state.name);try{b.$apply(function(){if(a.sdp&&("answer"===a.sdp.type||"pranswer"===a.sdp.type)){if(f.isTelephonyCall)if(a.progressType===d.RTCProgressType.EARLY_CONNECT)f.isEarlyConnect=!0;else{var b=j.parse(a.sdp.sdp);f.isEarlyConnect="earlyconnect"===b.i,f.isEarlyConnect&&(delete b.i,a.sdp.sdp=j.stringify(b))}if(c.sameAs(f)){if(a.sdp.type="pranswer",!f.sessionCtrl.setRemoteDescription(a.sdp))return void $(f,null,e.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED);f.isPranswer=!0}}c.setState(e.CallState.Delivered),H(c)})}catch(a){s.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",a)}}),mb.on("RTCSession.INVITE_TO_STAGE_EVENT",function(a){return s.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT"),K(a.sessionId)?void b.$apply(function(){var b={invitedByUserId:a.invitedByUserId,allowedMediaTypes:a.allowedMediaTypes,expirationTime:l.delayOrTimestamp(a.expirationDelay,a.expirationTime)};s.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",a.questionNumber),t.publish("/call/raiseHand/invite",[a.questionNumber,b])}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),mb.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",function(a){return s.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),K(a.sessionId)?void b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",a.questionNumber),t.publish("/call/raiseHand/invite",[a.questionNumber,null])}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),mb.on("RTCSession.QUESTION_EVENT",function(a){return s.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),K(a.sessionId)?void b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",a.question.questionNumber),t.publish("/call/raiseHand/question",[a.question,a.subType])}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),mb.on("RTCSession.CURTAIN_EVENT",function(a){return s.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),K(a.sessionId)?void b.$apply(function(){pb.curtain=a.curtain,s.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),t.publish("/call/curtain",[pb.curtain])}):void s.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),this.initActiveSessionsForSdk=function(){return Cb=!0,Db=!0,Na()},this.setDisableRemoteVideoByDefault=function(a){s.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!a),ub=!!a},this.getDisableRemoteVideoByDefault=function(){return ub},this.setClientDiagnosticsDisabled=function(a){Bb=a},this.getCalls=function(){return ob},this.getPhoneCalls=function(a){return ob.filter(function(b){return b.isTelephonyCall&&(!a||!b.isRemote)})},this.getEstablishedLocalPhoneCalls=function(){return ob.filter(function(a){return a.isTelephonyCall&&a.state.established&&!a.isRemote})},this.getActiveCall=function(a){return a?K(a):pb&&pb.replaces?pb.replaces:pb||null},this.getIncomingCall=function(){return wb[0]||null},this.getActiveRemoteCall=function(){return rb},this.joinGroupCall=function(a,b,c){if(c=c||function(){},!a)return s.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void c("Missing callId");var d=L(a);if(!d||!d.isRemote||d.state.name!==e.CallState.Started.name||d.activeClient)return s.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void c("Invalid call");var f=v.getConversationFromCache(d.convId);if(!f||!f.call||f.call.callId!==d.callId)return s.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void c("Invalid conversation");var g={callOut:!1,handover:!1,joiningGroupCall:!0};Ua(f,b,g,c)},this.makeCall=function(a,b,c){if(c=c||function(){},!a)return s.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void c("Missing convId");var d=v.getConversationFromCache(a);return d?void Ua(d,b,{callOut:!0,handover:!1},c):(s.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",a),void c("Conversation not found"))},this.makeEchoTestCall=function(a,c,d){c=c||function(){},d=d||function(){};var e=b.isSessionGuest&&b.localUser.conversationId||"echo_"+b.localUser.clientId,f={creatorId:b.localUser.userId,convId:e,rtcSessionId:"echo_"+b.localUser.clientId,participants:[{userId:b.localUser.userId}],testCall:!0};f=ab.extend(f),c(f.rtcSessionId),o(function(){T(f,a,{callOut:!1,handover:!1},d)},200)},this.dialNumber=function(a,b,c,d){d=d||function(){},v.getTelephonyConversation(function(e,f){e||!f?d(e):Ua(f,c,{callOut:!0,handover:!1,dialedDn:a,toName:b},d)})},this.dialPhoneNumber=function(a,c){c=c||function(){},a=a||{},v.getTelephonyConversation(function(d,e){if(d||!e)c(d);else{if(pb&&!pb.isTelephonyCall)return void c("res_CannotJoinMultipleSessions");if(pb&&qb)return void c("res_CannotInitiateThirdPhoneCall");if((pb||qb)&&!b.localUser.isATC)return void c("res_CannotJoinMultipleSessions");for(var f=0;f<ob.length;f++)if(!ob[f].state.established&&ob[f].isTelephonyCall)return void c("Cannot initiate a second call in this state");if(pb&&pb.isTelephonyCall&&!pb.isHolding())return void lb.holdCall(pb.callId,function(){qb=O(!0),Ua(e,a.mediaType,{callOut:!0,handover:!1,dialedDn:a.dialedDn,toName:a.toName,userId:a.userId},c)});Ua(e,a.mediaType,{callOut:!0,handover:!1,dialedDn:a.dialedDn,toName:a.toName,userId:a.userId},c)}})},this.startConference=function(a,b,c){if(c=c||function(){},!a)return s.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void c("Missing convId");var e=v.getConversationFromCache(a);return e?e.type!==d.ConversationType.GROUP&&e.type!==d.ConversationType.LARGE?(s.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void c("Invalid conversation type")):void Ua(e,b,{callOut:!1,handover:!1},c):(s.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",a),void c("Conversation not found"))},this.answerCall=function(a,c,f){function g(){pb=i,E(),wb.splice(h,1),Wa(pb),pb.stopRingingTimer(),pb.setState(e.CallState.Answering);var a=v.getConversationFromCache(pb.convId);return a&&a.call&&a.call.callId===pb.callId?(H(pb),void Va(c,function(b,c){V(a,b,{warning:c},f)})):(s.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),Z(pb,{type:d.InviteRejectCause.BUSY},!1),void f("Conversation not found"))}f=f||function(){};var h,i=null;if(wb.some(function(b,c){if(a===b.callId)return i=b,h=c,!0}),!i)return s.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void f("No alerting call");if((!pb||!pb.isPresent()||pb.isTelephonyCall&&i.isTelephonyCall&&!cb||i.replaces)&&b.localUser.isATC){if(pb&&pb.isTelephonyCall&&b.localUser.isATC&&!pb.isHolding())return void lb.holdCall(pb.callId,function(){qb=O(!0),g()})}else $(pb,null,e.CallClientTerminatedReason.USER_ENDED),qb&&$(qb,null,e.CallClientTerminatedReason.USER_ENDED);g()},this.endCall=function(a,b){var c=d.InviteRejectCause.DECLINE,f=lb.getActiveCall();f&&f.callId===a&&(f.isEstablished()||f.direction===e.CallDirection.OUTGOING)&&(c=null),lb.endCallWithCauseCode(a,c,b)},this.endCallWithCauseCode=function(a,b,c){var f;f=b?e.CallClientTerminatedReason.CLIENT_ENDED_PRFX+b:e.CallClientTerminatedReason.USER_ENDED;var g=K(a);if(g)g.replaces&&g.checkState(e.CallState.Answering)?c("Auto answer in progress"):g.terminateTimer?(J(g,f),c&&o(c)):$(g,b,f,!1,c);else if(pb&&pb.replaces&&pb.replaces.callId===a)$(pb.replaces,b,f,!1,c);else{var h=L(a);if(h)return void(h.terminateTimer?(J(h),c&&o(c)):$(h,b,f,!1,c));var i=ma(a);if(i)Z(i,{type:b||d.InviteRejectCause.DECLINE},!1,c);else{s.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var j=v.getConversationByRtcSession(a);j&&j.call&&(j.call=null,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[j])),c&&c("Call not found")}}},this.endConference=function(a,c){if(b.isSessionGuest)return void(c&&c("Not allowed"));var d=L(a);d?_(d,c):c&&c("Call not found")},this.startScreenShare=function(a,b,c){if(c=c||function(){},!a)return s.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void c("Invalid convId");var d=v.getConversationFromCache(a);if(!d)return s.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",a),void c("Conversation not found");var e={audio:!0,video:!1,desktop:!0},f={callOut:!0,handover:!1,screenConstraint:b};T(d,e,f,function(a){a||(s.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),t.publish("/screenshare/started")),c(a)})},this.addScreenShare=function(a,b,c){c=c||function(){};var d=K(a);if(!d)return s.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void c("No active call");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};U(a,null,e,!1,null,function(a){a||(s.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),t.publish("/screenshare/started")),c(a)},b)},this.addMediaStream=function(a,b,c){c=c||function(){};var d=K(a);if(!d)return s.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void c("No active call");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};U(a,null,e,!1,null,function(a){a?c("res_AddMediaStreamFailed"):c()},{mediaStream:b})},this.removeMediaStream=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: removeMediaStream - There is no local call"),void b("No active call");s.debug("[CircuitCallControlSvc]: removeMediaStream...");var d={audio:c.localMediaType.audio,video:c.localMediaType.video,desktop:!1};U(a,null,d,!1,null,function(a){a?b("res_RemoveMediaStreamFailed"):b()})},this.selectMediaToShare=function(a,b,c){c=c||function(){};var d=K(a);if(!d)return s.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void c("No active call");s.debug("[CircuitCallControlSvc]: selectMediaToShare...");var e={audio:d.localMediaType.audio,video:!1,desktop:!0};U(a,null,e,!0,null,c,b),t.publish("/screenshare/changed")},this.removeScreenShare=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: removeScreenShare - There is no local call"),void b("No active call");s.debug("[CircuitCallControlSvc]: removeScreenShare...");var d={audio:c.localMediaType.audio,video:c.localMediaType.video,desktop:!1};U(a,null,d,!1,null,function(a){a?b("res_RemoveScreenShareFailed"):b()})},this.addAudio=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: addAudio - There is no local call"),void b("No active call");var d={audio:!0,video:c.localMediaType.video,desktop:c.localMediaType.desktop};U(a,null,d,!1,null,function(a){a?(s.warn("[CircuitCallControlSvc]: addAudio -> Failed to renegotiate the media. ",a),b("Renegotiate for receive-only media failed")):(s.debug("[CircuitCallControlSvc]: addAudio -> Media renegotiation was successful"),b())})},this.removeAudio=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: removeAudio - There is no local call"),void b("No active call");s.debug("[CircuitCallControlSvc]: removeAudio...");var d={audio:!1,video:c.localMediaType.video,desktop:c.localMediaType.desktop};U(a,null,d,!1,null,function(a){a?(s.warn("[CircuitCallControlSvc]: removeAudio -> Failed to renegotiate the media. ",a),b("Renegotiate for receive-only media failed")):(s.debug("[CircuitCallControlSvc]: removeAudio -> Media renegotiation was successful"),b())})},this.enableRemoteAudio=function(a){var b=K(a);return b?void(b.remoteAudioDisabled&&(b.enableRemoteAudio(),s.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),t.publish("/call/remoteStreamUpdated",[b]))):void s.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(a){var b=K(a);return b?void(b.remoteAudioDisabled||(b.disableRemoteAudio(),s.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),t.publish("/call/remoteStreamUpdated",[b]))):void s.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: addVideo - There is no local call"),void b("No active call");var d={audio:c.localMediaType.audio,video:!0,desktop:!1};U(a,null,d,!1,null,function(a){a?b("res_AddVideoFailed"):b()})},this.removeVideo=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: removeVideo - There is no local call"),void b("No active call");s.debug("[CircuitCallControlSvc]: removeVideo...");var d={audio:c.localMediaType.audio,video:!1,desktop:c.localMediaType.desktop};U(a,null,d,!1,null,function(a){a?b("res_RemoveVideoFailed"):b()})},this.toggleRemoteVideo=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void b("No active call");s.debug("[CircuitCallControlSvc]: toggleRemoteVideo...");var d=c.sessionCtrl;return d.isConnStable()?(c.remoteVideoDisabled?c.enableRemoteVideo():c.disableRemoteVideo(),void U(a,null,c.localMediaType,!1,null,function(a){a?(c.remoteVideoDisabled?c.enableRemoteVideo():c.disableRemoteVideo(),s.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),b("res_ToggleVideoFailed")):b()})):void b("Connection not stable")},this.changeHDVideo=function(a,b,c){c=c||function(){};var d=K(a);if(!d)return s.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void c("No active call");if(!d.mediaType.video)return s.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void c("No video");if(b=!!b,d.localMediaType.hdVideo===b)return void c();s.debug("[CircuitCallControlSvc]: changeHDVideo...");var e={audio:pb.localMediaType.audio,video:!0,hdVideo:b,desktop:!1};U(a,null,e,!1,null,function(a){a?c("Error changing media"===a?"res_ToggleVideoFailed":a):c()})},this.toggleVideo=function(a,b){b=b||function(){};var c=K(a);if(!c)return s.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void b("No active call");s.debug("[CircuitCallControlSvc]: toggleVideo...");var d={audio:c.localMediaType.audio,video:!c.localMediaType.video,desktop:c.localMediaType.desktop};d.video&&(d.desktop=!1),U(a,null,d,!1,null,function(a){a?b("Error changing media"===a?"res_ToggleVideoFailed":a):b()})},this.renegotiateMedia=function(a,b){b=b||function(){};var c=K(a);return c?(c.sessionCtrl.enableTrickleIce(),s.debug("[CircuitCallControlSvc]: renegotiateMedia..."),void U(a,null,c.localMediaType,!1,null,function(a){a?(s.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),b("Renegotiate media failed")):b()})):(s.warn("[CircuitCallControlSvc]: renegotiateMedia - There is no local call"),void b("No active call"))},this.holdCall=function(a,b){b=b||function(){};var c=K(a);return c?(s.debug("[CircuitCallControlSvc]: holdCall..."),c.setHoldInProgress(),void U(a,null,c.localMediaType,!1,!0,function(a){c.clearHoldInProgress(),a?(s.warn("[CircuitCallControlSvc]: Failed to hold the call"),b("res_HoldCallFailed")):(pb=N(!0)||wb[0]||c,b())})):(s.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void b("No active call"))},this.retrieveCall=function(a,b){b=b||function(){};var c=K(a);return c.isHolding()?(s.debug("[CircuitCallControlSvc]: retrieveCall..."),c.setRetrieveInProgress(),void U(a,null,c.localMediaType,!1,!1,function(a){if(c.clearRetrieveInProgress(),a)s.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),b("res_RetrieveCallFailed");else{pb=c||N(!0),qb=O(!0);var d=v.getConversationFromCache(pb.convId);d.call=pb,s.debug("[CircuitCallControlSvc]: Publish /conversation/update event"),t.publish("/conversation/update",[d]),b()}})):(s.warn("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void b("No active call"))},this.swapCall=function(a,b){if(b=b||function(){},qb=lb.getPhoneCalls(!0).length>1?O(!0):null,!qb||!pb)return s.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void b("No calls to swap");if(qb&&qb.callId!==a)return s.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void b("Wrong callId");var c=qb.callId,d=pb.callId;lb.holdCall(d,function(){lb.retrieveCall(c,b)})},this.pullRemoteCall=function(a,b,c){function d(){var d=e.activeClient||{},g={audio:!0,video:!(!d.mediaType||!d.mediaType.video)};b&&(g.video=!1),Ua(f,g,{callOut:!1,handover:!0,callId:a},c)}c=c||function(){};var e=la(a);if(!e)return s.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void c("No active remote call");if(e.pullNotAllowed)return void c("res_PullCallNotAllowed");var f=v.getConversationFromCache(e.convId);return f&&f.call.callId===a?pb&&pb.isTelephonyCall?void lb.holdCall(pb.callId,function(){qb=O(!0),d()}):void d():(s.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void c("Conversation not found"))},this.endRemoteCall=function(a,b){b=b||function(){};var c=la(a);if(!c)return s.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void b("No active remote call");var d=v.getConversationFromCache(c.convId);return d&&d.call.callId===a?void aa(c,function(d){d?b("res_EndRemoteCallFailed"):(c.setState(e.CallState.Started),c.activeClient=null,H(c),rb.some(function(b,c){if(b.callId===a)return rb.splice(c,1),!0}),b())}):(s.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void b("Conversation not found"))},this.hideRemoteCall=function(a){var b=L(a);return b?void J(b):void s.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(a,b,c){c=c||function(){};var d=K(a);return!d||d.isDirect?(s.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void c("Call invalid")):b&&b.userId?(b.isCMP&&b.isMeetingPointInvitee&&(d.setMeetingPointInviteState(!1),lb.enableRemoteAudio(a)),s.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",b.userId),void oa(b.userId,c)):(s.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void c("Participant invalid"))},this.addParticipantToCall=function(a,b,c){var d=K(a);d?_a(d,b,c):(s.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),c&&c("Invalid callId"))},this.addParticipantToRtcSession=function(a,b,c){var d=L(a);d?_a(d,b):(s.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),c&&c("Invalid callId"))},this.mute=function(a,c){c=c||function(){};var d=K(a);return d&&a===d.callId?void(d.locallyMuted?c("Call already muted"):(s.debug("[CircuitCallControlSvc]: Mute the local call"),d.mute(function(){b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),t.publish("/call/localUser/mutedSelf",[a,!0]),c()})}))):(s.warn("[CircuitCallControlSvc]: mute - There is no local call"),void c("Call not valid"))},this.unmuteLocally=function(a){pb&&pb.locallyMuted&&(s.debug("[CircuitCallControlSvc]: Unmute the local call"),pb.unmute(function(){b.$apply(function(){s.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),t.publish("/call/localUser/mutedSelf",[pb.callId,!1]),a&&a()})}))},this.unmute=function(a,c){c=c||function(){};var d=K(a);if(!d)return void s.warn("[CircuitCallControlSvc]: unmute - There is no local call");if(!d.isMuted())return void c("Call not muted");var e=d.remotelyMuted;lb.unmuteLocally(e?null:c),e&&lb.unmuteParticipant(d.callId,b.localUser,c)},this.toggleMute=function(a,b){b=b||function(){};var c=K(a);return c?c.isLocalMuteAllowed()?void(c.isMuted()?lb.unmute(c.callId,b):lb.mute(c.callId,b)):(s.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void b()):(s.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void b("Call not valid"))},this.muteParticipant=function(a,c,d){d=d||function(){};var e=K(a);if(!e)return s.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void d("Call invalid");var f=c&&c.userId;if(!f)return s.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void d("Participant invalid");s.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",f);var g={rtcSessionId:e.callId,usersIds:[f],muted:!0};mb.muteParticipant(g,function(a){b.$apply(function(){a?(s.warn("[CircuitCallControlSvc]: Failed to mute participant"),d("res_MuteParticipantFailed")):d()})})},this.hasUnmutedParticipants=function(a){var b=K(a);return b&&a===b.callId?b.hasUnmutedParticipants():(s.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),
!1)},this.muteRtcSession=function(a,c){c=c||function(){};var d=K(a);if(!d||a!==d.callId)return s.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void c("Call invalid");if(d.hasUnmutedParticipants()){s.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var e={rtcSessionId:d.callId,muted:!0,excludedUserIds:[b.localUser.userId]};mb.muteRtcSession(e,function(a){b.$apply(function(){a?(s.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),c("res_MuteAllOtherParticipantsFailed")):c()})})}},this.unmuteParticipant=function(a,c,d){d=d||function(){};var e=K(a);if(!e)return s.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void d("Call invalid");var f=c&&c.userId;if(!f)return s.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void d("Participant invalid");if(f!==b.localUser.userId)return s.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void d("Cannot unmute others");s.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",f);var g={rtcSessionId:e.callId,usersIds:[f],muted:!1};mb.muteParticipant(g,function(a){b.$apply(function(){a?(s.warn("[CircuitCallControlSvc]: Failed to unmute participant"),d("res_UnmuteParticipantFailed")):d()})})},this.toggleMuteParticipant=function(a,b,c){c=c||function(){};var d=K(a);return d?b&&b.userId?b.muted?lb.unmuteParticipant(a,b,c):lb.muteParticipant(a,b,c):(s.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void c("Participant invalid")):(s.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void c("Call invalid"))},this.stopRingingTone=function(a){var b=ma(a);return b?(b.ringToneStopped=!0,s.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",a),void t.publish("/call/ringingTone/stop",[a])):void s.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",a)},this.endActiveCall=function(a){a=a||function(){},pb?lb.endCall(pb.callId,a):a("No active call")},this.startRecording=function(a,c){if(!pb)return s.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void a("No active call");var d={audio:!0,video:!1,desktop:!!c},e={convId:pb.convId,rtcSessionId:pb.callId,mediaTypes:d};mb.startRecording(e,function(c){b.$apply(function(){a&&a(c)})})},this.stopRecording=function(a){if(!pb)return s.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void a("No active call");var c={convId:pb.convId,rtcSessionId:pb.callId};mb.stopRecording(c,function(c){b.$apply(function(){a&&a(c)})})},this.raiseQuestion=function(a,c,d){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void d("No active event");var e={convId:pb.convId,rtcSessionId:pb.callId,question:a,displayName:b.localUser.displayName,isAnonymous:!!c};mb.raiseQuestion(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.inviteToStage=function(a,c){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void c("No active event");var d={convId:pb.convId,rtcSessionId:pb.callId,questionNumber:a};mb.inviteToStage(d,function(a){b.$apply(function(){c&&c(a)})})},this.inviteToStageAnswer=function(a,c,d){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void d("No active event");var e={convId:pb.convId,rtcSessionId:pb.callId,questionNumber:a,isAccepted:!!c};mb.inviteToStageAnswer(e,function(a){b.$apply(function(){!a&&c?lb.addAudio(pb.callId,function(a){a||lb.unmuteLocally(),d&&d(a)}):d&&d(a)})})},this.inviteToStageCancel=function(a,c){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void c("No active event");var d={convId:pb.convId,rtcSessionId:pb.callId,questionNumber:a};mb.inviteToStageCancel(d,function(a){b.$apply(function(){c&&c(a)})})},this.removeFromStage=function(a,c){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void c("No active event");var d={convId:pb.convId,rtcSessionId:pb.callId,userToRemoveId:a||b.localUser.userId};mb.removeFromStage(d,function(a){b.$apply(function(){c&&c(a)})})},this.getQuestions=function(a,c,d){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void d("No active event");var e={convId:pb.convId,rtcSessionId:pb.callId,startQuestionNumber:a,numberOfQuestions:c};mb.getQuestions(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.updateQuestionState=function(a,c,d){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void d("No active event");var e={convId:pb.convId,rtcSessionId:pb.callId,questionNumber:a,newQuestionState:c};mb.updateQuestionState(e,function(a,c){b.$apply(function(){d&&d(a,c)})})},this.openCurtain=function(a){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void a("No active event");var c={convId:pb.convId,rtcSessionId:pb.callId};mb.openCurtain(c,function(c){b.$apply(function(){a&&a(c)})})},this.closeCurtain=function(a,c,d,e){if(!pb||!pb.isLarge)return s.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void e("No active event");var f={curtainState:a};c&&(f.message=c),d&&(f.pauseDuration=d);var g={convId:pb.convId,rtcSessionId:pb.callId,curtain:f};mb.closeCurtain(g,function(a){b.$apply(function(){e&&e(a)})})},this.getNodeState=function(a,c,d){var e={convId:"noCall",nodeType:a,tenantId:c||""};mb.getNodeState(e,function(a,c){b.$apply(function(){a&&s.error("[CircuitCallControlSvc]: Failed to get node(s). ",a),d&&d(a,c)})})},this.canSendWebRTCDigits=function(){return pb&&pb.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(a,b,c){c=c||function(){};var d=K(a);return d?b?/^[\d#\*,]+$/.exec(b)?void Ta(a,b,c):(s.error("[CircuitCallControlSvc]: Digits cannot be sent: "+b+" (Allowed: 0-9,#,*)"),void c("res_InvalidDtmf")):void c("res_InvalidDtmf"):(s.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void c("Call not valid"))},this.disableIncomingVideo=function(a){pb&&pb.sameAs(a)&&(s.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID:",pb.callId),pb.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(a){pb&&pb.sameAs(a)&&(s.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID:",pb.callId),pb.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(a){var b=K(a);return b?b.pointer&&b.pointer.isSupported?(b.pointer.isEnabled=!b.pointer.isEnabled,void U(b.callId,b.transactionId,b.localMediaType,!1,null,null,null)):void s.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):void s.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=L,this.findActivePhoneCall=N,this.findHeldPhoneCall=O,this.sendParticipantPointer=Xa,this.sendParticipantDrawing=Ya,this.removeCallFromList=G,this.isSecondCall=function(){return pb||wb.length>=1||!rb.isEmpty()},this.updateActiveCallMediaDevices=function(){pb&&pb.updateMediaDevices()},this.addSimulatedParticipants=function(){var a=20,b=5e4,c=2500,f=12e4,g=2500,h=lb.getActiveCall();if(h&&!h.isDirect&&h.isMocked&&!(h.participants.length>0)){var i=function(){h.isPresent()&&0!==h.participants.length&&(ta(h,h.participants[0].userId),h.participants.length>0&&o(i,g))},j=function(g){var k={userId:(b+g).toString(),mediaTypes:[d.RealtimeMediaType.AUDIO],muted:!1,participantType:d.RTCParticipantType.SESSION_GUEST,userDisplayName:[Math.floor(g/10),g%10].join(" ")},l=Q(k),m=ra(h,l,e.ParticipantState.Active);t.publish("/call/participant/added",[h.callId,m]),t.publish("/call/participant/joined",[h,m]),E(),g<a-1?o(function(){h.isPresent()&&j(g+1)},c):o(i,f)};j(0),h.setState(e.CallState.Active),H(h)}},this}var c=a.ClientApiHandlerSingleton,d=a.Constants,e=a.Enums,f=a.LocalCall,g=a.Proto,h=a.RemoteCall,i=a.RtcParticipant,j=a.sdpParser,k=a.UserToUserHandlerSingleton,l=a.Utils,m=a.WebRTCAdapter,n=a.BusyHandlingOptions;return a.CircuitCallControlSvcImpl=b,a}(Circuit),Circuit=function(a){"use strict";function b(a,b){if(!a||!a.localUser)return f.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!b||b.isExtended)return b;var c=Object.create(b);c.isExtended=!0,c.moderators=c.moderators||[];var d=b.participants.map(function(a){return"string"==typeof a?{userId:a}:a}).filter(function(b){return b.userId!==a.localUser.userId});return c.peerUsers=d,b.type===e.ConversationType.DIRECT&&(c.peerUser=d[0]),c.userIsModerator=function(a){return!!a&&c.moderators.some(function(b){return b.userId===a.userId})},c}function c(a){if(!a||a.isExtended)return a;var b=Object.create(a);return b.isExtended=!0,b}function d(d,e){j=d,k=e,this.rootScope={localUser:null,clientVersion:"",browser:g.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(a){a&&a()},$digest:function(){},i18n:{localize:function(a){return a},map:{res_Unknown:"Unknown"}},localize:function(a){return a}},a.Conversation={extend:b.bind(null,this.rootScope)},a.UserProfile={extend:c.bind(null)},this.PubSubSvc=new a.PubSubSvcImpl(f),this.ExtensionSvc=new a.ExtensionSvcImpl(this.rootScope,h,window,Promise,f,this.PubSubSvc,null),this.SdkHelperSvc=new a.SdkHelperSvcImpl(this.rootScope,Promise,f),this.CallControlSvc=new a.CircuitCallControlSvcImpl(this.rootScope,h,i,window,Promise,f,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc),a.Conversation=null,a.UserProfile=null,j=null,k=null}var e=a.Constants,f=a.logger,g=a.Utils,h=function(a,b){return window.setTimeout(a,b)};h.cancel=function(a){a&&window.clearTimeout(a)};var i=function(a,b,c){if(void 0===c)return window.setInterval(a,b);if(c<=0)return null;var d=0,e=null,f=function(){a(),d++,d>=c&&window.clearInterval(e)};return e=window.setInterval(f,b)};i.cancel=function(a){a&&window.clearInterval(a)};var j=null;a.ClientApiHandlerSingleton.getInstance=function(){return j};var k=null;return a.UserToUserHandlerSingleton.getInstance=function(){return k},a.SdkServices=d,a}(Circuit),Circuit=function(a){"use strict";var b={};return a.Injectors=b,a}(Circuit||{}),Circuit=function(a){"use strict";function b(){if(window.frameElement&&window.parent)window.parent.document.body.removeChild(window.frameElement);else try{window.close()}catch(a){}}function c(a,c){if(a.location.hash||a.location.search){var d=Object.assign({},i.parseQS(a.location.hash),i.parseQS(a.location.search));if(d.state)try{Object.assign(d,JSON.parse(d.state))}catch(a){g.error("Could not decode state parameter")}if(d.display&&"popup"===d.display&&d.redirect_uri===a.location.origin+a.location.pathname&&a.document.addEventListener("DOMContentLoaded",function(){a.document.body.innerHTML="Redirecting, please wait..."}),d.callback){var e=d.callback;if(e in c)try{delete d.callback,c[e](d)}catch(a){}}d.display&&"popup"===d.display&&b()}}var d=a.Enums.ConnectionState,e=a.Enums.ConversationType,f=a.Constants,g=a.logger,h=a.PrivateData,i=a.Utils;c(window,window.opener||window.parent);var j=i.getBrowserInfo();return a.ExtensionConnHandlerSingleton.getInstance(),a.Client=function(b){function c(a,b,c,d){if(a===f.ReturnCode.NO_RESULT&&c)return!1;if(a){var e=Db.getLastError();return d&&d(e),e&&delete e.errObj,b(e),!0}return!1}function j(a,b){return!!a&&(b(new Circuit.Error(f.ReturnCode.SDK_ERROR,a)),!0)}function k(){return"https://"+rb.domain+"/"}function l(a,b,c){var d,e={};return e.location=1,e.width=b,e.height=c,e.left=window.screenX+(window.outerWidth-b)/2,e.top=window.screenY+(window.outerHeight-c)/2,e.toolbar="no",e.scrollbars="yes",d=Object.keys(e).map(function(a){return a+"="+e[a]}).join(", "),window.open(a,e.name,d)}function m(a){return sb.scope.split(",").indexOf(a)>=0||sb.scope.split(",").indexOf("ALL")>=0}function n(a){a=a||{},sb.client_id=a.client_id,sb.client_secret=a.client_secret,sb.redirect_uri=a.redirect_uri||window.location.origin+window.location.pathname,sb.scope=(a.scope?a.scope.replace(/\s+/g,""):"")||"ALL",m(f.OAuthScope.READ_USER_PROFILE)||(sb.scope=f.OAuthScope.READ_USER_PROFILE+","+a.scope),m(f.OAuthScope.ALL)&&(sb.scope=f.OAuthScope.ALL)}function o(a){return new Promise(function(b,c){var d=zb?new XMLHttpRequest(sb):new XMLHttpRequest;if(d.open(a.type||a.dataType||"GET",a.url,!0),d.withCredentials=a.xhrFields&&a.xhrFields.withCredentials,!vb||a.headers&&a.headers.Authorization||d.setRequestHeader("Authorization","Bearer "+vb),a.headers)for(var e in a.headers)a.headers.hasOwnProperty(e)&&d.setRequestHeader(e,a.headers[e]);d.onload=function(){if(200===d.status)a.success&&a.success(d.responseText),b(d.responseText);else{var e=new Circuit.Error(d.status+" "+d.statusText,d.responseText||d.statusText);a.error&&a.error(e),c(e)}},d.onerror=function(){var b=new Circuit.Error(f.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");a.error&&a.error(b),c(b)};var g;a.data&&(g=i.toQS(a.data),d.setRequestHeader("Content-type","application/x-www-form-urlencoded")),d.send(g)})}function p(a,b){return new Promise(function(c,d){b=b||{};var e="/sdklogin";o({type:"POST",url:"https://"+rb.domain+e,data:{username:a.email||a.username||void 0,password:a.password||void 0,token:a.token||void 0,accessToken:a.accessToken||void 0,persistent:!!b.persistent},xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){a.accessToken&&(vb=a.accessToken),c()}).catch(d)})}function q(){return o({url:"https://"+rb.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0})}function r(){return new Promise(function(a,b){Cb&&(window.clearInterval(Cb),Cb=null,Db.disconnect()),Db.setToken(vb),Db.connect(function(){g.info("[SDK]: Successfully connected to access server."),Cb=window.setInterval(qb,50),a()},function(a){g.error("[SDK]: Failed to connect: ",a),Db.disconnect(),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))},rb.domain)})}function s(){return new Promise(function(a,b){if(!sb.client_id)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id missing in client object"));if(!window.localStorage)return void a();var c=window.localStorage.getItem("oauth");try{c=JSON.parse(c)}catch(a){return window.localStorage.removeItem("oauth"),void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}c&&"object"==typeof c||(c={}),c[sb.client_id]={access_token:vb,domain:rb.domain,expires_at:wb},window.localStorage.setItem("oauth",JSON.stringify(c)),g.debug("[SDK]: Stored access_token for client_id: "+sb.client_id),a()})}function t(){return new Promise(function(a,b){var c=window.localStorage.getItem("oauth");if(!c)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id not found in store"));try{c=JSON.parse(c)}catch(a){return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"!=typeof c)return void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"invalid data in localStorage"));var d=c[sb.client_id];d&&d.access_token?(vb=d.access_token,wb=d.expires_at,g.debug("[SDK]: Retrieved access_token for client_id: "+sb.client_id),a(vb)):b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))})}function u(a){var b="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return window[b]=function(){try{a.apply(this,arguments)&&delete window[b]}catch(a){g.error(a)}},b}function v(){return new Promise(function(a,b){var c=null;if(!sb.client_id)return rb.oauthwin&&(rb.oauthwin.close(),rb.oauthwin=null),void b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"client_id missing in client object"));vb=void 0;var d=u(function(d){if(c&&window.clearInterval(c),!d||d.error){vb=void 0;var e=d?d.error:"The authentication was not completed";b(new Circuit.Error(f.ReturnCode.SDK_ERROR,e))}else vb=d.access_token,wb=d.expires_in&&Date.now()+1e3*d.expires_in,s().catch(function(a){g.error("[SDK]: Failed to store the OAuth access token.",a)}).then(function(){a({username:d.username,accessToken:d.access_token})})}),e={client_id:sb.client_id,redirect_uri:sb.redirect_uri,response_type:"token",scope:sb.scope||""};e.state=JSON.stringify({callback:d,display:"popup",redirect_uri:e.redirect_uri});var h="https://"+sb.domain+"/oauth/authorize?"+i.toQS(e),j=rb.oauthwin||l(h,450,500);rb.oauthwin=null,j.location.href=h,c=window.setInterval(function(){j&&!j.closed||(c&&window.clearInterval(c),b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})}function w(a){return a=a||vb,o({type:"GET",url:"https://"+rb.domain+"/oauth/token/"+a,crossDomain:!0})}function x(){if(sb.autoRenewToken&&wb){xb&&window.clearTimeout(xb);var a=wb-Date.now()-6e4;a>0&&(xb=window.setTimeout(y,a))}}function y(){return new Promise(function(a,b){var c={type:"POST",url:"https://"+rb.domain+"/oauth/token",data:{scope:sb.scope,grant_type:"implicit"}};sb.client_secret&&(c.headers={Authorization:"Basic "+window.btoa(sb.client_id+":"+sb.client_secret)},c.data.grant_type="client_credentials"),o(c).then(function(c){var d=JSON.parse(c);if(d&&d.access_token&&"Bearer"===d.token_type)vb=d.access_token,Db.setToken(vb),wb=d.expires_in&&Date.now()+1e3*d.expires_in,x(),pb({type:"accessTokenRenewed"}),a(vb);else{vb=null,wb=null;var e=new Circuit.Error(f.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");pb({type:"renewAccessTokenFailed",error:e}),b(e)}}).catch(b)})}function z(){return m(f.OAuthScope.READ_USER_PROFILE)?G():Promise.resolve()}function A(){return m(f.OAuthScope.CALLS)?Gb.CallControlSvc.initActiveSessionsForSdk():Promise.resolve()}function B(){return r().then(F).then(z).then(A).then(function(){return rb.loggedOnUser})}function C(){return new Promise(function(a,b){o({type:"POST",url:"https://"+rb.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(sb.client_id+":"+sb.client_secret)},data:{grant_type:"client_credentials",scope:sb.scope}}).then(function(c){var d=JSON.parse(c);d&&d.access_token&&"Bearer"===d.token_type?(vb=d.access_token,wb=d.expires_in&&Date.now()+1e3*d.expires_in,x(),a()):(vb=null,wb=null,b(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(b)})}function D(a){return a?new Promise(function(a){var b=function(){vb=null,wb=null,Db.disconnect(),window.clearInterval(Cb),rb.dispatch({type:"connectionStateChanged",state:d.Disconnected}),a()},c=window.setTimeout(function(){c=null,b()},2e3);Db.logout(function(){c&&(window.clearTimeout(c),b())})}):(vb=null,wb=null,Db.disconnect(),Promise.resolve())}function E(a){return new Promise(function(b,d){a=a||vb,vb=null,wb=null,s(),Db.revokeAccessToken(a,function(a){c(a,d)||b()})})}function F(){return new Promise(function(a,b){Db.getUserData(function(d,e){if(!c(d,b)){var f=e.getUserData,g=f.clientSettings;void 0!==g.allowAllIceCandidatesScreenShare&&(Fb.allowAllIceCandidatesScreenShare=!!g.allowAllIceCandidatesScreenShare),void 0!==g.disableTrickleIce&&(Fb.disableTrickleIce=!!g.disableTrickleIce),a(f)}})})}function G(){return new Promise(function(a,b){Db.getLoggedOnUser(function(d,e){if(!c(d,b)){var f=e.user;jb(f).then(function(b){rb.loggedOnUser=b,Gb.SdkHelperSvc.setLocalUser(b),a(b)})}})})}function H(a){return new Promise(function(b,d){a=a||{},a.pageSize=a.pageSize||25,a.sorting=a.sorting||f.GetAccountsSorting.BY_FIRST_NAME,Db.getAccounts(a,function(a,e){c(a,d)||Promise.all(e.accounts.map(function(a){return jb(a.user)})).then(b).catch(d)})})}function I(a){return new Promise(function(b,d){a=a||{},a.numberOfConversations=a.numberOfConversations||25,Db.getConversations(rb.loggedOnUser.userId,a.timestamp,a.direction,a.numberOfConversations,f.ConversationFilter.ALL,function(a,e){c(a,d)||Promise.all(e.map(nb)).then(b).catch(d)})})}function J(){return new Promise(function(a,b){Db.getMarkedConversationsList(function(d,e){c(d,b,!0)||a(e||[])})})}function K(a){return new Promise(function(b,d){Db.getConversationById(a,function(a,e){c(a,d)||nb(e).then(b).catch(d)})})}function L(a,b){return new Promise(function(d,e){b=b||{},Db.getConversationParticipants(a,b,function(a,b){c(a,e)||Promise.all(b.participants.map(ob)).then(function(a){b.participants=a,d(b)}).catch(e)})})}function M(a){return new Promise(function(b,d){Db.getItemById(a,function(a,e){c(a,d)||kb(e).then(b).catch(d)})})}function N(a,b){return new Promise(function(d,e){b=b||{},b.modificationDate=b.modificationDate||void 0,b.creationDate=b.creationDate||b.creationTime||void 0,b.direction=b.direction||f.SearchDirection.BEFORE,b.numberOfItems=b.numberOfItems||25,Db.getConversationItems(a,b.modificationDate,b.creationDate,b.direction,b.numberOfItems,function(a,b){c(a,e)||Promise.all(b.map(kb)).then(d).catch(e)})})}function O(a,b){return new Promise(function(d,e){b=b||{},Db.getConversationFeed(a,b.timestamp,b.minTotalItems,b.maxTotalUnread,b.commentsPerThread,b.maxUnreadPerThread,function(a,b,f){c(a,e)||Promise.all(b.map(mb)).then(function(a){d({threads:a,hasOlderThreads:f})}).catch(e)})})}function P(a,b,d){return new Promise(function(e,g){var h=d.modificationDate||d.creationDate,i=d.modificationDate?f.TimestampFilter.MODIFICATION:f.TimestampFilter.CREATION;Db.getThreadComments(a,b,h,i,d.direction,d.number,function(a,b,d){c(a,g)||Promise.all(b.map(kb)).then(function(a){e({items:a,hasMore:d})}).catch(g)})})}function Q(a){return new Promise(function(b,d){Db.getUserByEmail(a,function(a,e){c(a,d,null,function(a){a&&a.code===f.ReturnCode.NO_RESULT&&(a.info="User does not exist")})||jb(e).then(b).catch(d)})})}function R(a){return new Promise(function(b,d){return a?a.length?void Db.getUsersByEmails(a,function(a,e){c(a,d)||Promise.all(e.map(jb)).then(b).catch(d)}):b([]):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"))})}function S(a){return new Promise(function(b,d){return a?void Db.getUser(a,function(a,e){c(a,d)||jb(e).then(b).catch(d)}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))})}function T(a,b){return new Promise(function(d,e){if(!a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"));if(!a.length)return d([]);var g=b?Db.getPartialUsersByIds:Db.getUsersByIds;g(a,function(a,b){c(a,e)||Promise.all(b.map(jb)).then(d).catch(e)})})}function U(){return new Promise(function(a,b){Db.getDevices(function(d,e){c(d,b,!0)||a(e||[])})})}function V(){return new Promise(function(a,b){Db.getTelephonyConversationId(function(d,e){c(d,b)||(tb=e,a(e))})})}function W(){return new Promise(function(a,b){Db.getSupportConversationId(function(d,e){c(d,b)||(ub=e,a(e))})})}function X(a){return"string"==typeof a&&(a={userId:a,createIfNotExists:!1}),new Promise(function(b,d){return a.userId?void Db.getConversationByUser(a.userId,function(e,g){return e?void(e===f.ReturnCode.NO_RESULT?a.createIfNotExists?_(a.userId).then(function(a){b(a&&a.conversation)}):b():c(e,d)):void nb(g).then(b).catch(d)}):void d(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))})}function Y(a,b){return"string"!=typeof a?Promise.reject(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):a.match(i.EMAIL_ADDRESS_PATTERN)?Q(a).then(function(a){return{userId:a.userId,createIfNotExists:b}}).then(X):X({userId:a,createIfNotExists:b})}function Z(b,d){return new Promise(function(e,h){function i(a){Db.addTextItem(a,function(a,b){c(a,h)||kb(b).then(e).catch(h)})}if(!b)return void h(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"));if(!d)return void h(new Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));if("string"==typeof d)i({convId:b,content:d,contentType:"RICH"});else if("object"==typeof d){var j={convId:b,parentId:d.parentId,contentType:d.contentType||f.TextItemContentType.RICH,subject:d.subject,content:d.content,externalAttachmentMetaData:d.externalAttachments};if(d.attachments&&d.attachments.length>0){var k=new a.FileUpload(sb);k.uploadFiles(d.attachments,rb.domain).then(function(a){j.attachmentMetaData=[],a.forEach(function(a){j.attachmentMetaData.push(a)}),i(j)}).catch(function(a){g.error("[SDK]: Fileupload error.",a),h(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))})}else i(j)}else h(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid content"))})}function $(b){return new Promise(function(d,e){function h(a){Db.updateTextItem(a,function(a,b){c(a,e)||kb(b).then(d).catch(e)})}if(!b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"));if(!b.itemId)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required"));if("object"==typeof b)if(b.attachments&&b.attachments.length>0){var i=new a.FileUpload(sb);i.uploadFiles(b.attachments,rb.domain).then(function(a){b.attachmentMetaData=[],a.forEach(function(a){b.attachmentMetaData.push(a)}),h(b)}).catch(function(a){g.error("[SDK]: Fileupload error.",a),e(new Circuit.Error(f.ReturnCode.SDK_ERROR,a))})}else h(b);else e(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid content"))})}function _(a){return new Promise(function(b,d){var e={type:f.ConversationType.DIRECT,participants:[{userId:a}]};Db.createConversation(e,function(a,e,f){c(a,d)||nb(e).then(function(a){b({conversation:a,alreadyExists:f})})})})}function aa(a){return a&&"string"==typeof a?a.match(i.EMAIL_ADDRESS_PATTERN)?Q(a).then(function(a){return a.userId}).then(_):_(a):Promise.reject(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))}function ba(a,b){return new Promise(function(d,e){a&&a.length||(a=[rb.loggedOnUser.userId]),a=a.map(function(a){return{userId:a}});var g={type:f.ConversationType.GROUP,participants:a,topic:b};Db.createConversation(g,function(a,b){c(a,e)||nb(b).then(d).catch(e)})})}function ca(a){return a?ba(null,a):Promise.reject(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"))}function da(a,b,d){return new Promise(function(e,g){a&&a.length||(a=[rb.loggedOnUser.userId]),a=a.map(function(a){return{userId:a}});var h={type:f.ConversationType.OPEN,participants:a,topic:b,description:d};Db.createConversation(h,function(a,b){c(a,g)||nb(b).then(e).catch(g)})})}function ea(a,b){return new Promise(function(d,e){var f={convId:a,userId:b};Db.addParticipant(f,function(a){c(a,e)||d()})})}function fa(a,b){return new Promise(function(d,e){Db.removeParticipant(a,b,function(a){c(a,e)||d()})})}function ga(){return new Promise(function(a,b){Db.getFlaggedItems(function(d,e){c(d,b,!0)||a(e||[])})})}function ha(a,b){return new Promise(function(d,e){Db.setFlagItem({convId:a,itemId:b},function(a){c(a,e)||d()})})}function ia(a,b){return new Promise(function(d,e){Db.clearFlagItem(a,b,function(a){c(a,e)||d()})})}function ja(a){return new Promise(function(b,d){Db.likeTextItem(a,rb.loggedOnUser.userId,function(a){c(a,d)||b()})})}function ka(a){return new Promise(function(b,d){Db.unlikeTextItem(a,rb.loggedOnUser.userId,function(a){c(a,d)||b()})})}function la(a,b){return new Promise(function(d,e){b=b||Date.now(),Db.setReadPointer(a,b,function(a){c(a,e)||d()})})}function ma(a){return new Promise(function(b,d){Db.updateUser(a,function(a){c(a,d)||b()})})}function na(a,b){return new Promise(function(d,e){Db.changePassword(a,b,function(a){c(a,e)||d()})})}function oa(a){var b={};return a&&a.forEach(function(a){switch(a.key){case f.UserSettingKey.OPT_OUT_PRESENCE:b.presenceOptOut=a.booleanValue;break;case f.UserSettingKey.SHARE_LOCATION:b.shareLocation=a.booleanValue}}),b}function pa(a){return new Promise(function(b,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"));var e=[];void 0!==a.presenceOptOut&&e.push({key:f.UserSettingKey.OPT_OUT_PRESENCE,dataType:f.UserSettingDataType.BOOLEAN,booleanValue:!!a.presenceOptOut}),void 0!==a.shareLocation&&e.push({key:f.UserSettingKey.SHARE_LOCATION,dataType:f.UserSettingDataType.BOOLEAN,booleanValue:!!a.shareLocation}),Db.setUserSettings(e,function(a){c(a,d)||b()})})}function qa(){return new Promise(function(a,b){Db.getUserSettings([f.UserSettingArea.ALL],function(d,e){c(d,b)||a(oa(e))})})}function ra(a){return new Promise(function(b,d){Db.setPresence(a,function(a){c(a,d)||b()})})}function sa(a,b){return new Promise(function(d,e){Db.getPresence(a,b,function(a,b){c(a,e)||d(b)})})}function ta(a){return new Promise(function(b,d){a=a||"",Db.setUserSettings({key:f.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:f.UserSettingDataType.STRING,stringValue:a},function(e){c(e,d)||sa([rb.loggedOnUser.userId]).then(function(b){return ra({state:b.length&&b[0].state,statusMessage:a})}).then(b).catch(d)})})}function ua(){return new Promise(function(a,b){Db.getUserSettings([f.UserSettingArea.ALL],function(d,e){if(!c(d,b)){var g="";e&&e.some(function(a){if(a.key===f.UserSettingKey.STATUS_MESSAGE_TEXT)return g=a.stringValue,!0}),a(g)}})})}function va(a){return new Promise(function(b,d){Db.subscribePresence(a,function(a){c(a,d)||b()})})}function wa(a){return new Promise(function(b,d){Db.unsubscribePresence(a,function(a){c(a,d)||b()})})}function xa(){return new Promise(function(a,b){Db.renewToken(rb.loggedOnUser.userId,function(d,e){return c(d,b)?void pb({type:"renewSessionTokenFailed",error:d}):(g.debug("[SDK]: Session token renewed"),pb({type:"sessionTokenRenewed"}),void a(e))})})}function ya(a){return"string"==typeof a&&(a={query:a}),new Promise(function(b,c){Db.startUserSearch(a,function(a,d){a?c(a):b(d)})})}function za(a){return U().then(function(b){return b.some(function(b){return a?b.clientId===a:b.clientId!==rb.loggedOnUser.clientId&&b.clientInfo.deviceType===f.DeviceType.WEB})})}function Aa(a){return U().then(function(b){return b.some(function(b){return b.clientId===a})})}function Ba(a,b,c,d){return new Promise(function(e,g){function h(){var c=rb.domain.startsWith("sdk.")?rb.domain.substr(4):rb.domain,d="https://"+c+"/#/call?user="+a+"&media="+b,h=window.open(d,"_blank");return h?(h.focus(),void e({type:"CALL_VIA_URL",win:h})):void g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}function i(c){var d={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:b,contact:{email:a}},destUserId:rb.loggedOnUser.userId};c&&(d.destClientId=c),Eb.sendContactCardRequest(d,function(a){a?g(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):e({type:"CALL_VIA_OTHER_CLIENT"})})}b=b||"audio",c?Aa(c).then(function(a){a?i(c):g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):za().then(function(a){a?i():d?g(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):h()})})}function Ca(a,b,c){return new Promise(function(d,e){return a?(c=c||{},void 0===c.mic&&(c.mic=!0),void 0===c.speaker&&(c.speaker=!0),void za(b).then(function(g){if(g){var h={content:{type:"MUTE_DEVICE_REQUEST",callId:a,option:c},destUserId:rb.loggedOnUser.userId,destClientId:b};Eb.sendContactCardRequest(h,function(a,b){return a?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):b&&b.response?b.response.code&&"OK"!==b.response.code?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,b.response.code)):void d():void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))})}else e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Device not found"))})):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Da(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));if(!b.userId&&!b.email&&!b.number)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));var e={userId:b.userId||void 0,dialOutPhoneNumber:b.number||void 0,displayName:b.displayName||void 0};!b.userId&&b.email&&b.email.match(i.EMAIL_ADDRESS_PATTERN)?Q(b.email).then(function(b){
e.userId=b.userId,Gb.CallControlSvc.addParticipantToCall(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})}).catch(d):Gb.CallControlSvc.addParticipantToCall(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})})}function Ea(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));if(!b)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));if(!b.userId&&!b.email&&!b.number)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));var e={userId:b.userId||void 0,dialOutPhoneNumber:b.number||void 0,displayName:b.displayName||void 0};!b.userId&&b.email&&b.email.match(i.EMAIL_ADDRESS_PATTERN)&&(Q(b.email).then(function(b){e.userId=b.userId,Gb.CallControlSvc.addParticipantToRtcSession(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()})}).catch(d),Gb.CallControlSvc.addParticipantToRtcSession(a,e,function(a){a?d(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):c()}))})}function Fa(a){var b=Gb.CallControlSvc.findCall(a);return b?b:(b=Gb.CallControlSvc.getActiveCall(a),b||null)}function Ga(){return Promise.all(Gb.CallControlSvc.getCalls().map(ib))}function Ha(){return Promise.resolve(ib(Gb.CallControlSvc.getActiveCall()))}function Ia(){return Promise.all(Gb.CallControlSvc.getActiveRemoteCall().map(ib))}function Ja(){return Promise.all(Gb.CallControlSvc.getCalls().filter(function(a){return a.state.name===Circuit.Enums.CallState.Started.name}).map(ib))}function Ka(a,b){return K(a).then(function(a){return new Promise(function(c,d){return a?(Gb.SdkHelperSvc.addConversationToCache(a),void Gb.CallControlSvc.startConference(a.convId,b,function(a,b,e){j(a,d)||ib(e).then(c).catch(d)})):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))})})}function La(a){return a.pin=a.tenantPIN+a.sessionPIN,a.link&&(a.link="https://"+rb.domain+a.link),delete a.tenantPIN,delete a.sessionPIN,delete a.conversationId,a}function Ma(a){return new Promise(function(b,d){Db.getJoinDetails(a,!1,function(a,e){c(a,d)||b(La(e))})})}function Na(a){return new Promise(function(b,d){Db.getJoinDetails(a,!0,function(a,e){c(a,d)||b(La(e))})})}function Oa(a,b,c){return new Promise(function(d,e){return a?void(c&&c!==rb.loggedOnUser.clientId?Aa(c).then(function(g){if(g){var h={content:{type:"JOIN_CONFERENCE_REQUEST",callId:a,mediaType:b},destUserId:rb.loggedOnUser.userId,destClientId:c};Eb.sendContactCardRequest(h,function(a,b){return a?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):b&&b.response?b.response.code&&"OK"!==b.response.code?void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,b.response.code)):void d():void e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))})}else e(new Circuit.Error(f.ErrorCode.SDK_ERROR,"No client found for clientId "+c))}):Gb.CallControlSvc.joinGroupCall(a,b,function(b){j(b,e)||d(a)})):void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Pa(a,b){return new Promise(function(c,d){return a?void Gb.CallControlSvc.pullRemoteCall(a,b,function(a){j(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Qa(a,b,c){return Y(a,c).then(function(a){return new Promise(function(c,d){return a?(Gb.SdkHelperSvc.addConversationToCache(a),void Gb.CallControlSvc.makeCall(a.convId,b,function(a,b,e){j(a,d)||ib(e).then(c).catch(d)})):void d(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Conversation does not exist"))})})}function Ra(a,b){return new Promise(function(c,d){return i.PHONE_PATTERN.test(a||null)?void Gb.CallControlSvc.dialNumber(a,b,{audio:!0,video:!1},function(a,b,e){j(a||b,d)||ib(e).then(c).catch(d)}):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid number"))})}function Sa(a,b){return new Promise(function(c,d){return/^[\d#\*,]+$/.exec(b)?void Gb.CallControlSvc.sendDigits(a,b,function(a){j(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))})}function Ta(a,b){return new Promise(function(c,d){return a?void Gb.CallControlSvc.answerCall(a,b,function(a){j(a,d)||c()}):void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Ua(a){return new Promise(function(b,c){return a?void Gb.CallControlSvc.endCall(a,function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Va(a){return new Promise(function(b,c){return a?void Gb.CallControlSvc.endConference(a,function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Wa(a){return new Promise(function(b,c){return a?void Gb.CallControlSvc.toggleVideo(a,function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Xa(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Fa(a);return d?(d.remoteAudioDisabled?Gb.CallControlSvc.enableRemoteAudio(a):Gb.CallControlSvc.disableRemoteAudio(a),void b(a)):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"))})}function Ya(a){return new Promise(function(b,c){return a?void Gb.CallControlSvc.toggleRemoteVideo(a,function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Za(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Fa(a);return d?void(d.hasLocalScreenShare()?Gb.CallControlSvc.removeScreenShare(a,function(a){j(a,c)||b()}):Gb.CallControlSvc.addScreenShare(a,null,function(a){j(a,c)||b()})):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"))})}function $a(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e=Fa(a);if(!e)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No call found"));if(e.hasLocalScreenShare())Gb.CallControlSvc.removeMediaStream(a,function(a){j(a,d)||c()});else{if(!b)return void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Missing MediaStream"));Gb.CallControlSvc.addMediaStream(a,b,function(a){j(a,d)||c()})}})}function _a(a,b){return new Promise(function(c,d){if(!a)return void d(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var e=Gb.CallControlSvc.getActiveCall();return e?a!==e.callId?void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Call ID is not for active call")):void Gb.CallControlSvc.startRecording(function(a){j(a,d)||c()},b):void d(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No active call found"))})}function ab(a){return new Promise(function(b,c){if(!a)return void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"));var d=Gb.CallControlSvc.getActiveCall();return d?a!==d.callId?void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"Call ID is not for active call")):void Gb.CallControlSvc.stopRecording(function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.SDK_ERROR,"No active call found"))})}function bb(a){return new Promise(function(b,d){Db.deleteRecording(a,function(a){c(a,d)||b()})})}function cb(a){return new Promise(function(b,c){return a?void Gb.CallControlSvc.mute(a,function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function db(a){return new Promise(function(b,c){return a?void Gb.CallControlSvc.unmute(a,function(a){j(a,c)||b()}):void c(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function eb(a,b,c){return new Promise(function(d,e){if(!a||"string"!=typeof a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"));if(!b||"string"!=typeof b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));if(!c||"object"!=typeof c)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));var g={content:{type:a,message:c},destUserId:b};Eb.sendSdkRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d()})})}function fb(a,b,c){return new Promise(function(d,e){if(!a||"string"!=typeof a)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"));if(!b||"string"!=typeof b)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));if(!c||"object"!=typeof c)return void e(new Circuit.Error(f.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));var g={content:{type:a,message:c},destUserId:rb.loggedOnUser.userId,destClientId:b};Eb.sendSdkRequest(g,function(a){a?e(new Circuit.Error(f.ErrorCode.SDK_ERROR,a)):d()})})}function gb(a){var b=0;if(a)for(var c=0;c<a.length;c++)b+=a.charCodeAt(c);return Lb[b%Lb.length]}function hb(a,b){if("function"==typeof a)try{var c=a(b);if(c&&"object"==typeof c)return"function"==typeof c.then?c:Promise.resolve(c)}catch(a){g.error("[SDK]: Error applying injector. ",a)}return Promise.resolve(b)}function ib(a){if(!a)return Promise.resolve();var b={};return Mb.forEach(function(c){b[c]=i.shallowCopy(a[c])}),b.state=a.state.name,b.isEstablished=a.state.established,hb(Circuit.Injectors.callInjector,b)}function jb(a){if(!a)return Promise.resolve();if(a.smallImageUri&&a.largeImageUri)a.avatar=k()+"fileapi/"+a.userId+"_s.jpg?fileid="+a.smallImageUri,a.avatarLarge=k()+"fileapi/"+a.userId+"_b.jpg?fileid="+a.largeImageUri,a.hasAvatar=!0;else{var b=gb(a.userId);a.avatar="https://"+rb.domain+Hb+b+".png",a.avatarLarge="https://"+rb.domain+Hb+b+"-XL.png"}return delete a.smallImageUri,delete a.largeImageUri,delete a.tenantId,delete a.roles,delete a.accountTemplateType,delete a.associatedGTCUserId,delete a.reroutingPhoneNumber,delete a.assignedPhoneNumbers,a.hasPermission=function(a){if(!this.accounts||!a)return!1;var b=this.accounts[0],c=b&&b.permissions;return!!c&&c.some(function(b){return b.systemPermission===a})},hb(Circuit.Injectors.userInjector,a)}function kb(a){if(!a)return Promise.resolve();switch(a.type){case f.ConversationItemType.TEXT:a.text.state===f.TextItemState.DELETED?a.text.content="":(a.attachments=a.attachments||[],a.externalAttachments=a.externalAttachments||[],"standard"===sb.emoticonMode&&(a.text.content=i.standardizeEmoticon(a.text.content)),h.retrievePrivateDataFromContent(a));break;case f.ConversationItemType.SYSTEM:a.system.affectedParticipants&&(a.system.affectedParticipants=a.system.affectedParticipants.map(function(a){return a.userId}))}return a.attachments&&a.attachments.forEach(function(a){a.url=k()+"fileapi/"+encodeURIComponent(a.fileName)+"?fileid="+a.fileId+"&itemid="+a.itemId}),hb(Circuit.Injectors.itemInjector,a)}function lb(a){return new Promise(function(b){return a&&a.topLevelItem?(g.debug("[SDK]: Publicize the topLevelItem. convId = ",a.convId),void kb(a.topLevelItem).then(function(){g.debug("[SDK]: Publicized topLevelItem. convId = ",a.convId),b(a)}).catch(function(c){g.error("[SDK]: Failed to publicize topLevelItem. ",c),b(a)})):void b(a)})}function mb(a){return new Promise(function(b){if(!a||!a.parentItem)return void b(a);g.debug("[SDK]: Publicize the thread. itemId = ",a.parentItem.intemId),a.comments=a.comments||[];var c=a.comments.slice(0);c.unshift(a.parentItem),Promise.all(c.map(kb)).then(function(){b(a)}).catch(function(c){g.error("[SDK]: Failed to publicize thread. ",c),b(a)})})}function nb(a){if(!a)return Promise.resolve();if(g.debug("[SDK]: Publicize conversation. convId = ",a.convId),a.participants=a.participants.map(function(a){return a.userId}),a.type!==f.ConversationType.DIRECT){if(a.conversationAvatar&&a.conversationAvatar.smallPictureId&&a.conversationAvatar.largePictureId)a.avatar=k()+"avatar?convId="+a.convId+"&type=small&fileid="+a.conversationAvatar.smallPictureId,a.avatarLarge=k()+"avatar?convId="+a.convId+"&type=large&fileid="+a.conversationAvatar.largePictureId,a.hasConversationAvatar=!0;else if(a.type===f.ConversationType.OPEN){var b=a.isDraft?"-grey":gb(a.convId);a.avatar="https://"+rb.domain+Ib+b+".png",a.avatarLarge="https://"+rb.domain+Ib+b+"-XL.png"}else a.type===f.ConversationType.LARGE?(a.avatar="https://"+rb.domain+Jb+".png",a.avatarLarge="https://"+rb.domain+Jb+"-XL.png"):(a.avatar="https://"+rb.domain+Kb+".png",a.avatarLarge="https://"+rb.domain+Kb+"-XL.png");a.type===f.ConversationType.OPEN&&(a.type=e.COMMUNITY)}var c=hb(Circuit.Injectors.conversationInjector,a);return c.then(lb)}function ob(a){if(!a)return Promise.resolve();if(a.smallImageUri&&a.largeImageUri)a.avatar=k()+"fileapi/"+a.userId+"_s.jpg?fileid="+a.smallImageUri,a.avatarLarge=k()+"fileapi/"+a.userId+"_b.jpg?fileid="+a.largeImageUri,a.hasAvatar=!0;else{var b=gb(a.userId);a.avatar="https://"+rb.domain+Hb+b+".png",a.avatarLarge="https://"+rb.domain+Hb+b+"-XL.png"}return delete a.smallImageUri,delete a.largeImageUri,hb(Circuit.Injectors.participantInjector,a)}function pb(a){g.debug("[SDK]: Enqueue "+a.type),Ab.push(a)}function qb(){if(!Bb&&Ab.length){Bb=!0;try{var a=Ab.shift();if(g.debug("[SDK]: Dequeue "+a.type+". Events left in the queue: "+Ab.length),!rb.hasEventListener(a.type))return void g.debug("[SDK]: There is no listener for this event");var b=[];b.push(a.user?jb(a.user):void 0),b.push(a.item?kb(a.item):void 0),b.push(a.conversation?nb(a.conversation):void 0),b.push(a.call?ib(a.call):void 0),Promise.all(b).then(function(b){b[0]&&(a.user=b[0]),b[1]&&(a.item=b[1]),b[2]&&(a.conversation=b[2]),b[3]&&(a.call=b[3]),g.debug("[SDK]: Dispatch ",a.type),rb.dispatch(a)})}catch(a){g.error("[SDK]: Error processing event queue. ",a)}finally{Bb=!1}}}a.BaseEventTarget.call(this,a.logger);var rb=this,sb=i.shallowCopy(b)||{};sb.domain=sb.domain||"circuitsandbox.net",sb.emoticonMode=sb.emoticonMode||"standard",n(b);var tb,ub,vb,wb,xb,yb,zb="node"===window.navigator.platform,Ab=[],Bb=!1,Cb=null,Db=new a.ClientApiHandler(sb),Eb=new a.UserToUserHandler(Db),Fb=a.RtcSessionController;rb._clientApiHandler=Db,rb._userToUserHandler=Eb,rb._rtcSessionController=Fb;var Gb=new a.SdkServices(Db,Eb),Hb="/content/images/icon-general-default-avatar",Ib="/content/images/icon-general-openconvo-avatar",Jb="/content/images/icon-general-large-conference",Kb="/content/images/icon-general-emptyconvo-avatar",Lb=["-blue","-green","-orange","-yellow"],Mb=["activeMediaType","callId","convId","convType","direction","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoUrl","mediaType","participants","remoteAudioDisabled","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","ringAllAllowed","ringAllMaxNumber"];return Object.defineProperty(rb,"domain",{get:function(){return sb.domain},set:function(a){sb.domain=a},enumerable:!0,configurable:!1}),Object.defineProperty(rb,"accessToken",{get:function(){return vb},set:function(a){vb=a},enumerable:!0,configurable:!0}),Object.defineProperty(rb,"expiresAt",{get:function(){return wb},enumerable:!0,configurable:!0}),rb.setOauthConfig=n,rb.logon=function(a,b){if(a&&"object"!=typeof a)return g.error("OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore."),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch"));if(a&&sb.client_id&&sb.client_secret)return g.error("Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API."),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch"));if(!sb.client_id&&a&&!a.token)return g.error("Circuit.Client is created with client_id, so no API token should be passed to the logon API."),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch"));if(!sb.client_id&&!a)return g.error("Login with a session cookie has been disabled. OAuth2 is the only supported authentication method."),Promise.reject(new Circuit.Error(f.ErrorCode.SDK_ERROR,"Credentials mismatch"));if(b=b||{},sb.client_id&&sb.client_secret)return C().then(function(){return p({accessToken:vb})}).then(B);if(sb.client_id&&a&&a.accessToken)return p(a,b).then(B);if(sb.client_id){if(rb.logonChecked||b.loginChecked)return B();var c="https://"+sb.domain+"/dist/oauthLoading.html";return rb.oauthwin=l(c,450,500),t().then(w).then(q).then(function(){rb.oauthwin.close(),rb.oauthwin=null}).catch(v).then(B)}return a&&a.token?p(a,b).then(B):Promise.reject(new Circuit.Error(f.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},rb.logonCheck=function(){return t().then(w).then(q).then(function(){rb.logonChecked=!0,yb&&window.clearTimeout(yb),yb=window.setTimeout(function(){yb=null,rb.logonChecked=!1},5e3)})},rb.logout=D,rb.revokeToken=E,rb.setCookie=function(a){sb.cookie=a},rb.getCookie=function(){return sb.cookie},rb.isAuthenticated=q,rb.validateToken=w,rb.getLoggedOnUser=G,rb.getTelephonyConversationId=V,rb.getSupportConversationId=W,rb.getTenantUsers=H,rb.subscribePresence=va,rb.unsubscribePresence=wa,rb.renewSessionToken=xa,rb.renewToken=y,rb.getUserById=S,rb.getUsersById=T,rb.getUserByEmail=Q,rb.getUsersByEmail=R,rb.updateUser=ma,rb.changePassword=na,rb.getPresence=sa,rb.setPresence=ra,rb.setStatusMessage=ta,rb.getStatusMessage=ua,rb.setUserSettings=pa,rb.getUserSettings=qa,rb.getDevices=U,rb.getConversations=I,rb.getMarkedConversations=J,rb.getConversationById=K,rb.getConversationParticipants=L,rb.getItemById=M,rb.getConversationItems=N,rb.getConversationFeed=O,rb.getItemsByThread=P,rb.addTextItem=Z,rb.updateTextItem=$,rb.getDirectConversationWithUser=Y,rb.addParticipant=ea,rb.removeParticipant=fa,rb.getFlaggedItems=ga,rb.flagItem=ha,rb.setFlagItem=ha,rb.unflagItem=ia,rb.clearFlagItem=ia,rb.likeItem=ja,rb.unlikeItem=ka,rb.markItemsAsRead=la,rb.createDirectConversation=aa,rb.createGroupConversation=ba,rb.createConferenceBridge=ca,rb.createCommunity=da,rb.findCall=Fa,rb.getCalls=Ga,rb.getActiveCall=Ha,rb.getActiveRemoteCalls=Ia,rb.getStartedCalls=Ja,rb.startConference=Ka,rb.getConversationDetails=Ma,rb.changeConversationPin=Na,rb.joinConference=Oa,rb.pullRemoteCall=Pa,rb.leaveConference=Ua,rb.endConference=Va,rb.makeCall=Qa,rb.dialNumber=Ra,rb.getTelephonyData=Gb.SdkHelperSvc.getTelephonyData,rb.sendDigits=Sa,rb.sendClickToCallRequest=Ba,rb.muteDevice=Ca,rb.addParticipantToCall=Da,rb.addParticipantToRtcSession=Ea,rb.answerCall=Ta,rb.endCall=Ua,rb.toggleVideo=Wa,rb.toggleRemoteAudio=Xa,rb.toggleRemoteVideo=Ya,rb.toggleScreenShare=Za,rb.toggleMediaStream=$a,rb.startRecording=_a,rb.stopRecording=ab,rb.deleteRecording=bb,rb.mute=cb,rb.unmute=db,rb.startUserSearch=ya,rb.sendAppMessageToUser=eb,rb.sendAppMessageToClient=fb,rb.addAppMessageListener=function(a,b){Eb.on("SDK."+a,b)},rb.removeAppMessageListener=Eb.off,Object.defineProperty(a,"supportedEvents",{get:function(){return["connectionStateChanged","reconnectFailed","sessionTokenRenewed","renewSessionTokenFailed","accessTokenRenewed","renewAccessTokenFailed","systemMaintenance","userPresenceChanged","userUpdated","userSettingsChanged","userDeleted","basicSearchResults","conversationCreated","conversationUpdated","conversationDeleted","itemAdded","itemUpdated","callIncoming","callStatus","callEnded"]},enumerable:!0,configurable:!0}),Db.on("Conversation.ADD_ITEM",function(a){pb({type:"itemAdded",item:a.item})}),Db.on("Conversation.UPDATE_ITEM",function(a){pb({type:"itemUpdated",item:a.item})}),Db.on("Conversation.CREATE",function(a){pb({type:"conversationCreated",conversation:a.conversation})}),Db.on("Conversation.UPDATE",function(a){pb({type:"conversationUpdated",conversation:a.conversation})}),Db.on("User.USER_PRESENCE_CHANGE",function(a){pb({type:"userPresenceChanged",presenceState:a.newState})}),Db.on("User.USER_UPDATED",function(a){pb({type:"userUpdated",user:a.user})}),Db.addEventListener("connectionStateChange",function(a){pb({type:"connectionStateChanged",state:a.newState})}),Db.addEventListener("reconnectFailed",function(){pb({type:"reconnectFailed"}),sb.client_secret&&C().then(function(){return p({accessToken:vb})}).then(B)}),Db.on("User.SESSION_EXPIRES",function(){rb.loggedOnUser&&xa()}),Db.on("User.USER_SETTING_UPDATED",function(a){var b=oa(a.settings);Object.keys(b).length>0&&pb({type:"userSettingsChanged",userSettings:b})}),Db.on("Search.BASIC_SEARCH_RESULT",function(a){pb({type:"basicSearchResults",data:a})}),Db.on("System.MAINTENANCE",function(a){pb({type:"systemMaintenance",data:a})}),Db.on("User.USER_DELETED",function(a){pb({type:"userDeleted",data:a})}),Db.on("Conversation.DELETE",function(a){pb({type:"conversationDeleted",convId:a.convId})}),Gb.PubSubSvc.subscribe("/call/incoming",function(a){pb({type:"callIncoming",call:a})}),zb&&Gb.PubSubSvc.subscribe("/call/warmupFailed",function(a,b){pb({type:"callIncoming",call:b})}),Gb.PubSubSvc.subscribe("/call/state",function(a){pb({type:"callStatus",call:a,reason:"callStateChanged"})}),Gb.PubSubSvc.subscribe("/call/remoteStreamUpdated",function(a){pb({type:"callStatus",call:a,reason:"remoteStreamUpdated"})}),Gb.PubSubSvc.subscribe("/call/localStreamEnded",function(a){pb({type:"callStatus",call:a,reason:"localStreamEnded"})}),Gb.PubSubSvc.subscribe("/call/muted",function(a){pb({type:"callStatus",call:a,reason:"callMuted"})}),Gb.PubSubSvc.subscribe("/call/localUser/muted",function(a){var b=Fa(a);pb({type:"callStatus",call:b,reason:"localUserMuted"})}),Gb.PubSubSvc.subscribe("/call/localUser/unmuted",function(a){var b=Fa(a);pb({type:"callStatus",call:b,reason:"localUserUnmuted"})}),Gb.PubSubSvc.subscribe("/call/localUser/mutedSelf",function(a,b){var c=Fa(a);pb(b?{type:"callStatus",call:c,reason:"localUserSelfMuted"}:{type:"callStatus",call:c,reason:"localUserSelfUnmuted"})}),Gb.PubSubSvc.subscribe("/call/locked",function(a){pb({type:"callStatus",call:a,reason:"callLocked"})}),Gb.PubSubSvc.subscribe("/call/moved",function(a,b){var c=Fa(b);pb({type:"callStatus",call:c,reason:"callMoved"})}),Gb.PubSubSvc.subscribe("/call/participant/updated",function(a){var b=Fa(a);pb({type:"callStatus",call:b,reason:"participantUpdated"})}),Gb.PubSubSvc.subscribe("/call/participant/added",function(a,b){var c=Fa(a);pb({type:"callStatus",call:c,participant:b,reason:"participantAdded"})}),Gb.PubSubSvc.subscribe("/call/participant/joined",function(a,b){pb({type:"callStatus",call:a,participant:b,reason:"participantJoined"})}),Gb.PubSubSvc.subscribe("/call/participant/removed",function(a){var b=Fa(a);pb({type:"callStatus",call:b,reason:"participantRemoved"})}),Gb.PubSubSvc.subscribe("/call/recording",function(a,b){var c=Fa(a.rtcSessionId);pb({type:"callStatus",call:c,reason:"callRecording",recordingState:b})}),Gb.PubSubSvc.subscribe("/call/droppedRemotely",function(a){pb({type:"callStatus",call:a,reason:"droppedRemotely"})}),Gb.PubSubSvc.subscribe("/call/ended",function(a){Fa(a.callId)||pb({type:"callEnded",call:a})}),rb},a.Client.prototype.name="Client",a.isCompatible=function(){var a=parseInt(j.version,10);return j.chrome&&a>=44||j.firefox&&a>=42||j.edge},a.supportedFeatures=function(){return a.isCompatible()?{text:!0,rtc:j.chrome||j.firefox}:{text:!1,rtc:!1}},a}(Circuit);
